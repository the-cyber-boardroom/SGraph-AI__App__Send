# OSBot-AWS: LLM Briefing Document

## Overview

OSBot-AWS is a Python library providing high-level, type-safe abstractions over AWS services via boto3. It follows the OSBot ecosystem patterns established in `osbot_utils`, emphasizing type safety, caching, and developer ergonomics.

## Core Design Principles

### Type Safety Pattern
All classes inherit from `Type_Safe` (or legacy `Kwargs_To_Self`) providing:
- Automatic type validation on `__init__`
- Clean attribute declaration with type hints
- JSON serialization via `.json()` method
- Constructor kwargs mapping to instance attributes

```python
from osbot_utils.type_safe.Type_Safe import Type_Safe

class EC2(Type_Safe):
    aws_config: AWS_Config              # Typed attribute, auto-initialized
```

### Session Management
The `Session` class (`osbot_aws.apis.Session`) is the central entry point for boto3 client/resource creation:

```python
from osbot_aws.apis.Session import Session

# Create clients
ec2_client    = Session().client('ec2')
s3_resource   = Session().resource('s3')
```

**Key Session Features:**
- Automatic profile detection from `~/.aws/credentials`
- Environment variable credential support
- LocalStack compatibility (`http://localhost:4566`)
- Configurable endpoint URLs for testing/mocking
- Retry configuration (default: 1 attempt, standard mode)

### Caching Decorators
Heavy use of caching to avoid redundant boto3 calls:

```python
from osbot_utils.decorators.methods.cache_on_self import cache_on_self

class S3(Type_Safe):
    @cache_on_self
    def client(self):                   # Cached per instance
        return Session().client('s3')
```

### Collection Decorators
Transform list returns into indexed/grouped dictionaries:

```python
from osbot_utils.decorators.lists.index_by import index_by
from osbot_utils.decorators.lists.group_by import group_by

@index_by                               # Returns dict keyed by specified field
@group_by                               # Groups items by specified field
def instances(self):
    return self.client().describe_instances()
```

**Usage:**
```python
ec2.instances(index_by='InstanceId')    # Dict keyed by InstanceId
ec2.instances(group_by='State')         # Dict grouped by State
```

## AWS Services Covered

| Service | Class | Location |
|---------|-------|----------|
| **EC2** | `EC2`, `EC2_Instance` | `osbot_aws.aws.ec2` |
| **ECS** | `ECS`, `ECS_Fargate_Task` | `osbot_aws.aws.ecs` |
| **IAM** | `IAM`, `IAM_Role`, `IAM_Policy`, `IAM_User` | `osbot_aws.aws.iam` |
| **Lambda** | `Lambda`, `Lambda_Layer` | `osbot_aws.aws.lambda_` |
| **S3** | `S3`, `S3__DB_Base` | `osbot_aws.aws.s3` |
| **STS** | `STS` | `osbot_aws.aws.sts` |
| **Route53** | `Route_53`, `Route_53__Hosted_Zone` | `osbot_aws.aws.route_53` |
| **CloudFront** | `Cloud_Front` | `osbot_aws.aws.cloud_front` |
| **CodeArtifact** | `Code_Artifact` | `osbot_aws.aws.code_artifact` |
| **Organizations** | `Organizations` | `osbot_aws.aws.organizations` |

## Configuration: AWS_Config

Global configuration via `AWS_Config` class and `aws_config` singleton:

```python
from osbot_aws.AWS_Config import aws_config

account_id  = aws_config.account_id()
region_name = aws_config.region_name()
```

**Environment Variables:**
- `AWS_DEFAULT_REGION` - AWS region
- `AWS_PROFILE` - Named profile from credentials file
- `AWS_ACCESS_KEY_ID` / `AWS_SECRET_ACCESS_KEY` - Direct credentials
- `AWS_ENDPOINT_URL` - Custom endpoint (LocalStack support)

## Temporary Role System

OSBot-AWS provides a powerful temporary role system for testing and isolated operations:

### IAM_Assume_Role
Create and assume temporary IAM roles with specific permissions:

```python
from osbot_aws.aws.iam.IAM_Assume_Role import IAM_Assume_Role

policies_to_add = [
    {'service': 's3', 'action': '*', 'resource': '*'},
    {'service': 'ec2', 'action': 'Describe*', 'resource': '*'}
]

with IAM_Assume_Role(role_name='temp-test-role', policies_to_add=policies_to_add) as role:
    role.create_role()
    s3_client = role.boto3_client('s3')     # Client using assumed role credentials
```

### Temp_Role__For_Service
Mixin for service classes to auto-create temp roles:

```python
from osbot_aws.aws.iam.utils.Temp_Role__For_Service import Temp_Role__For_Service
from osbot_aws.aws.ec2.EC2 import EC2

class EC2__with_temp_role(Temp_Role__For_Service, EC2):
    def __init__(self):
        super().__init__()
        self._temp_role_config.boto3_service_name = 'ec2'
        self._temp_role_config.required_services  = ['ec2']
```

## Error Handling

### Custom Exceptions
```python
from osbot_aws.exceptions.Session_Bad_Credentials      import Session_Bad_Credentials
from osbot_aws.exceptions.Session_No_Credentials       import Session_No_Credentials
from osbot_aws.exceptions.Session_Client_Creation_Fail import Session_Client_Creation_Fail
```

### Boto3 Error Capture
```python
from osbot_aws.aws.boto3.Capture_Boto3_Error import Capture_Boto3_Error

with Capture_Boto3_Error() as error_capture:
    # boto3 operations
    pass
if error_capture.error_details:
    print(error_capture.error_details)
```

## Debugging & Development Tools

### View_Boto3_Rest_Calls
Debug decorator showing all boto3 API calls:

```python
from osbot_aws.aws.boto3.View_Boto3_Rest_Calls import print_boto3_calls

@print_boto3_calls(show=True, show_args=True, show_return=True)
def my_function():
    # All boto3 calls will be logged with timing
    pass
```

### Cache_Boto3_Requests
SQLite-based request caching for testing:

```python
from osbot_aws.aws.boto3.Cache_Boto3_Requests import Cache_Boto3_Requests

with Cache_Boto3_Requests() as cache:
    # boto3 calls cached to SQLite for replay
    pass
```

## LocalStack & MinIO Support

### LocalStack
Set endpoint URL for local development:
```python
# Via environment
export AWS_ENDPOINT_URL=http://localhost:4566

# Supported services auto-detected: s3, lambda, logs, dynamodb, ec2, iam, sts
```

### MinIO (S3-compatible)
```python
from osbot_aws.aws.s3.S3__Minio import S3__Minio

s3_minio = S3__Minio().s3()             # S3 client pointing to MinIO
```

## Common Usage Patterns

### Context Managers
Many classes support context manager pattern:
```python
with ECS() as ecs:
    clusters = ecs.clusters()
```

### Method Chaining
Builder-style configuration:
```python
lambda_func = (Lambda('my-function')
               .set_role(role_arn)
               .set_s3_bucket(bucket)
               .set_s3_key(key)
               .set_memory(512)
               .set_timeout(60))
```

### Status Returns
Many methods return status dictionaries:
```python
result = s3.bucket_create(bucket='my-bucket', region='us-east-1')
# Returns: {'status': 'ok', 'data': location} or {'status': 'error', 'data': error_msg}
```

## Dependencies

- **boto3** - AWS SDK
- **botocore** - Low-level boto3 components
- **osbot_utils** - OSBot utilities (Type_Safe, decorators, helpers)

## File Structure Convention

```
osbot_aws/
├── AWS_Config.py                       # Global configuration
├── apis/
│   └── Session.py                      # boto3 session management
├── aws/
│   ├── ec2/
│   │   ├── EC2.py                      # Main EC2 class
│   │   ├── EC2_Instance.py             # Instance helper
│   │   └── utils/                      # EC2 utilities
│   ├── s3/
│   │   ├── S3.py                       # Main S3 class
│   │   └── S3__DB_Base.py              # S3-backed storage base
│   ├── lambda_/                        # Note underscore (lambda is reserved)
│   │   ├── Lambda.py
│   │   └── dependencies/               # Lambda dependency management
│   └── iam/
│       ├── IAM.py
│       ├── IAM_Role.py
│       └── utils/
└── exceptions/                         # Custom exceptions
```

## Key Imports Reference

```python
# Core
from osbot_aws.apis.Session      import Session
from osbot_aws.AWS_Config        import aws_config, AWS_Config

# Services
from osbot_aws.aws.s3.S3         import S3
from osbot_aws.aws.ec2.EC2       import EC2
from osbot_aws.aws.lambda_.Lambda import Lambda
from osbot_aws.aws.iam.IAM       import IAM
from osbot_aws.aws.iam.IAM_Role  import IAM_Role
from osbot_aws.aws.sts.STS       import STS
from osbot_aws.aws.ecs.ECS       import ECS

# Utilities
from osbot_aws.aws.iam.IAM_Assume_Role import IAM_Assume_Role
from osbot_aws.aws.boto3.View_Boto3_Rest_Calls import print_boto3_calls
```
