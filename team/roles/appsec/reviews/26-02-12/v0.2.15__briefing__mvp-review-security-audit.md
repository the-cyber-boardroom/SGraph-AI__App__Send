# AppSec Briefing — MVP Security Review

**From:** Conductor (on behalf of Dinis Cruz)
**To:** AppSec
**Date:** 12/02/2026
**Version:** v0.2.15
**Source:** `team/humans/dinis_cruz/briefs/02/12/v0.2.10__review-of-user-site-mvp.md`

---

## Context

The user-facing MVP is live on Lambda with working end-to-end encrypted file transfer. Dinis has explicitly requested a security review and has already identified at least one vulnerability (injection in `info__transfer_id`).

---

## Tasks Assigned by Review

### TASK-1: Full Security Review of Codebase

**Priority:** Critical
**Scope:** All application code in `sgraph_ai_app_send/` and frontend in `sgraph_ai_app_send__ui__user/`

Review areas:
- **Backend routes** (`Routes__Transfers.py`) — input validation, error handling, information leakage
- **Transfer service** (`Transfer__Service.py`) — state management, access control, data integrity
- **Frontend crypto** (`crypto.js`) — key generation, IV handling, encryption correctness
- **Frontend API client** (`api-client.js`) — error handling, data exposure
- **Web Components** (`send-upload.js`, `send-download.js`) — XSS, DOM manipulation safety
- **Lambda handlers** — request parsing, header handling

### TASK-2: Create Issues for All Vulnerabilities

**Priority:** Critical
**Known vulnerability:** Injection in `Routes__Transfers.info__transfer_id()` — the `transfer_id` parameter is reflected directly in the `HTTPException` detail string:

```python
# Routes__Transfers.py line 53-59
# todo: as it stand this function is vulnerable to injection attacks, since the transfer_id is returned inside the HTTPException detail
def info__transfer_id(self, transfer_id: str) -> dict:
    result = self.transfer_service.get_transfer_info(transfer_id)
    if result is None:
        raise HTTPException(status_code = 404,
                            detail      = f'Transfer {transfer_id} not found')
```

**Note:** This pattern exists in ALL error paths in `Routes__Transfers.py` (lines 39-40, 49-50, 58-59, 69-70). Each must be assessed.

For each vulnerability found:
1. Create an issue in `team/roles/appsec/.issues/` with:
   - Severity rating (Critical/High/Medium/Low)
   - OWASP category
   - Affected file and line numbers
   - Exploitation vector
   - Recommended fix
2. Link the issue to the class/module where it was discovered
3. Link to risk assessment and exploit vectors

### TASK-3: Threat Model

**Priority:** High

Create threat models covering:
- **Data flow**: Browser → Lambda URL → Memory-FS (and future S3)
- **Trust boundaries**: Client browser, Lambda function, AWS infrastructure, Memory-FS backend
- **Attack surfaces**: Public Lambda URLs (no API Gateway), file upload/download endpoints, static asset serving
- **Zero-knowledge claims**: Verify that the server truly cannot access plaintext (key never leaves browser, no server-side logging of keys)
- **Transparency model**: What the server stores vs. what it claims not to store

Key considerations:
- Lambda Function URLs are directly exposed (no WAF, no API Gateway rate limiting)
- No file size limits enforced server-side currently
- No rate limiting on create/upload/download endpoints
- IP hashing uses SHA-256 without salt (noted in `Transfer__Service.py` line 100)
- In-memory storage means no persistence security concerns now, but S3 backend will change this

### TASK-4: Map Vulnerabilities to Issues-FS

For each vulnerability:
1. Create issue in `team/roles/appsec/.issues/` (your role's issues database)
2. Use appropriate issue types (e.g., `vulnerability`, `security-risk`, `threat-model`)
3. Link to parent module/class issues
4. Include severity, OWASP category, and exploit vector as custom fields

---

## Deliverables

1. Security review document: `team/roles/appsec/reviews/26-02-12/v0.2.15__security-review__mvp-codebase.md`
2. Threat model document: `team/roles/appsec/reviews/26-02-12/v0.2.15__threat-model__sgraph-send.md`
3. All vulnerability issues in `team/roles/appsec/.issues/`
4. Summary of findings with severity ratings

---

## Files to Review

| File | Location | Focus |
|---|---|---|
| Transfer routes | `sgraph_ai_app_send/lambda__user/fast_api/routes/Routes__Transfers.py` | Injection, input validation |
| Transfer service | `sgraph_ai_app_send/lambda__user/service/Transfer__Service.py` | State management, IP hashing |
| Transfer schemas | `sgraph_ai_app_send/lambda__user/schemas/Schema__Transfer.py` | Type safety, validation |
| Crypto module | `sgraph_ai_app_send__ui__user/v0/v0.1/v0.1.0/js/crypto.js` | AES-GCM correctness |
| API client | `sgraph_ai_app_send__ui__user/v0/v0.1/v0.1.0/js/api-client.js` | Error handling |
| Upload component | `sgraph_ai_app_send__ui__user/v0/v0.1/v0.1.0/components/send-upload/send-upload.js` | XSS, DOM safety |
| Download component | `sgraph_ai_app_send__ui__user/v0/v0.1/v0.1.0/components/send-download/send-download.js` | XSS, DOM safety |
| Admin FastAPI | `sgraph_ai_app_send/lambda__admin/fast_api/Fast_API__SGraph__App__Send__Admin.py` | Auth config |
| User FastAPI | `sgraph_ai_app_send/lambda__user/fast_api/Fast_API__SGraph__App__Send__User.py` | Auth disabled |
