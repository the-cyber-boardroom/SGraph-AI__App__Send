# v0.5.0 — AppSec: What to Read Now (Key Discovery Build)

**Version:** v0.5.0
**Date:** 2026-02-21
**Role:** AppSec
**Team:** Explorer
**Context:** Extracted from [revised review](v0.5.0__review__pki-architecture-security-revised.md) for quick reading

---

## Summary

You're building key discovery on the Admin Lambda. Admin auth (Fast_API cookie) is already in place. **There are no critical or high-risk findings for this build.** Here's what matters:

---

## 3 Things to Address in the Build

### 1. Case-insensitive lookup codes — normalise consistently (Medium)

Lookup codes are case-insensitive (`DC-7X4F` = `dc-7x4f`). The implementation must:
- **Normalise to lowercase at the API boundary** — every endpoint does `code.lower()` before processing
- **Store only lowercase** — the server never stores mixed-case codes
- **Generate uppercase for display** — show `DC-7X4F` to users, store `dc-7x4f` internally
- **Hash the normalised form** — transparency log entries must use lowercase so hashes are deterministic
- **Test it** — publish a key, look it up with different capitalisations, verify they all resolve

### 2. Rate limiting — recommended, not blocking (Medium)

Admin auth bounds the attack surface, so rate limiting is defence-in-depth, not critical. Good practice to add:

| Endpoint | Suggested Limit |
|----------|----------------|
| `POST /keys/publish` | 10/hour |
| `GET /keys/lookup/{code}` | 60/minute |
| `GET /keys/list` | 10/minute |
| `DELETE /keys/unpublish/{code}` | 10/hour |

Can be deferred to a later iteration if it slows down the build.

### 3. Transparency log — Phase 1 only (Medium)

Implement as an append-only audit trail. The server computes the hash chain. Admins can inspect it. That's sufficient for now.

**Not needed now:** client-side verification, external witnesses, equivocation detection. Those are Phase 2/3 (future).

---

## 5 Things That Are Already Handled

| Finding | Why It's Fine |
|---------|---------------|
| Auth on POST /api/keys (was Critical) | Admin Lambda cookie auth already covers it |
| Auth on DELETE /api/keys (was High) | Same — admin auth already covers it |
| Lookup code enumeration (was Medium) | Admin-only access; 8-char codes = 2.82T combinations |
| Registry as membership oracle (was Medium) | Registry is admin-only; users already know each other |
| CORS restrictions (was Medium) | Admin Lambda handles CORS; cookie auth mitigates CSRF |

---

## 2 Things to Note (Not Act On)

1. **No challenge-response needed for now.** When we add the ability for the server to issue challenges to clients (needed for things like allowing users to delete their own keys), that's a new server capability that doesn't exist yet. It'll be built when needed.

2. **Many findings only become real when we expose endpoints on the User Lambda.** The current build is admin-only. When we decide what to expose publicly (unauthenticated or access-token-only paths), that's when a fresh AppSec review of those specific endpoints is needed.

---

## The One GRC Item

**Auth Model Transition Risk:** The current high-trust model (admin-only, access-token-controlled) masks risks that become critical when the platform widens. When any of these triggers occur, mandate a full AppSec review:

- Self-service user registration
- OAuth/OIDC integration
- Public key publishing opened to non-admin users
- Trust groups with admin delegation
- Any anonymous/unauthenticated endpoint

Full details: [GRC Risk: Auth Model Transition](v0.5.0__grc-risk__auth-model-transition.md)

---

## Cross-References

| Document | What It Contains |
|----------|-----------------|
| [Full revised review](v0.5.0__review__pki-architecture-security-revised.md) | All 23 findings, original + revised ratings, detailed analysis |
| [Future findings](v0.5.0__appsec__future-findings-catalogue.md) | All deferred findings for Chain of Trust and Secure Pod |
| [GRC risk](v0.5.0__grc-risk__auth-model-transition.md) | Auth model transition tracking item |
| [Original review](v0.5.0__review__pki-architecture-security.md) | Pre-revision review (preserved for audit trail) |
