# v0.3.12 -- QA Action Plan: Brief Response (15 Feb 2026)

**Version:** v0.3.12
**Date:** 2026-02-15
**Role:** QA (Explorer team)
**Brief:** `team/humans/dinis_cruz/briefs/02/15/v0.3.10__daily-brief__explorer-team-15-feb-2026.md`
**Previous QA review:** `team/roles/qa/reviews/26-02-14/v0.3.0__response-to-daily-brief__14-feb.md`
**Master index:** `team/roles/librarian/reviews/26-02-15/v0.3.10__master-index__daily-brief-15-feb.md`

---

## Executive Summary

The v0.3.10 brief introduces 7 P1 items (6 bug fixes + 1 SA foundation), 12 P2 items, and 3 P3 items. This action plan defines test strategies for each P1 bug fix, the SA dashboard, carryover status of the 46-test admin UI plan from v0.3.0, new test requirements introduced by this brief, and a recommended test priority order aligned with the Dev execution sequence.

The total new test requirement from this brief is **38 tests** (20 frontend QUnit, 6 backend pytest, 6 Playwright E2E, 6 smoke). Combined with the v0.3.0 carryover of 46 admin UI tests, the complete test backlog stands at **84 tests**.

---

## 1. Test Strategy for P1 Bug Fixes

Each P1 bug fix requires regression tests that verify both the broken behaviour is gone and the correct behaviour is present. Tests are organised by the brief's task numbering.

### 1.1 Download Page Loading State (Brief #1)

**Bug:** User sees the mailing list prompt first during JS load delay. Should see a loading indicator.

**Current state:** `download.html` (v0.1.4) renders the `<send-download>` component and the "Want to send files too?" section as sibling elements in the HTML. The mailing list section is static HTML -- it renders immediately, while the component waits for JS load. No loading indicator exists.

**Test approach:** The fix will either add a loading indicator that is visible before JS executes or restructure the page so the mailing list section is hidden by default (shown only after the download UI is ready). Tests must verify both states.

| ID | Test | Type | Layer | Assertion |
|----|------|------|-------|-----------|
| BF-01 | Loading indicator visible before component initialises | Playwright E2E | Browser | On page load, before JS executes, a loading indicator element is visible and the mailing list section is NOT visible |
| BF-02 | Loading indicator replaced by download UI after init | Playwright E2E | Browser | After full page load, the `<send-download>` component is rendered and the loading indicator is gone |
| BF-03 | Mailing list section appears only after download UI is ready | Playwright E2E | Browser | The `.launchlist-form` parent section is hidden while state is `loading`, visible only after state transitions to `ready` or `complete` |

**Testing notes:**
- These are inherently browser tests. QUnit cannot meaningfully test the JS load delay because QUnit itself requires JS to be loaded.
- Playwright should use `page.waitForSelector` with strict timing to verify the loading indicator appears before the component's `connectedCallback` completes.
- Consider a lightweight visual regression snapshot of the loading state.

---

### 1.2 Token Expiry Message (Brief #2)

**Bug:** Invalid/expired/used-up tokens cause a silent redirect to the first page. Should show a clear error message.

**Current state:** The `<send-access-gate>` component (v0.1.0) handles token validation. When a token is invalid, the `ACCESS_TOKEN_INVALID` custom event is dispatched (see `send-upload.js` line 409), but the access gate's response to this event is not surfacing a message. The `<send-download>` component does have `getTokenErrorMessage()` (line 138) that maps `not_found`, `exhausted`, and `revoked` to i18n messages -- but the upload-side access gate does not.

**Test approach:** Tests must verify that for each token failure reason, a user-visible message is displayed (not a redirect or blank page).

| ID | Test | Type | Layer | Assertion |
|----|------|------|-------|-----------|
| TE-01 | Expired token shows expiry message | QUnit | Component | When `access-token-invalid` event fires with reason `expired`, the access gate renders an error message containing "expired" |
| TE-02 | Exhausted token shows usage limit message | QUnit | Component | When token lookup returns `exhausted`, a message about usage limit is displayed |
| TE-03 | Revoked token shows revoked message | QUnit | Component | When token lookup returns `revoked`, a message about revocation is displayed |
| TE-04 | Invalid token shows generic not-valid message | QUnit | Component | When token lookup returns `not_found`, a "not valid" message is displayed |
| TE-05 | Error message includes guidance for next steps | QUnit | Component | Error message element contains guidance text (e.g., "request a new token") |
| TE-06 | No silent redirect on token failure | Playwright E2E | Browser | Navigate to upload page with an invalid token; page stays on upload URL and shows error; does NOT redirect to index |

**Testing notes:**
- TE-01 through TE-05 can be tested in QUnit by programmatically setting the access gate's state or dispatching the relevant events.
- TE-06 is a regression test -- it specifically verifies the original bug (silent redirect) does not recur.

---

### 1.3 Token-Aware Page State (Brief #3)

**Bug:** Download page shows "Want to send files too? Join the Early Access programme" even when the user has a valid token in `localStorage`.

**Current state:** The mailing list section in `download.html` (v0.1.4, lines 18-30) is unconditionally rendered. There is no conditional logic checking `localStorage` for an existing token.

**Test approach:** The fix will add conditional rendering based on `localStorage` token presence. Two distinct paths: (a) user HAS token -- show "Send a file" link, (b) user has NO token -- show the join prompt.

| ID | Test | Type | Layer | Assertion |
|----|------|------|-------|-----------|
| TA-01 | With token in localStorage: "Send a file" link visible | QUnit | Component | Set `localStorage` with a valid token, render the download page, verify "Send a file" (or "Send another file") link is present |
| TA-02 | With token in localStorage: join prompt hidden | QUnit | Component | Set `localStorage` with a valid token, render the download page, verify `.launchlist-form` parent is NOT in the DOM or is hidden |
| TA-03 | Without token: join prompt visible | QUnit | Component | Clear `localStorage`, render the download page, verify the join/waitlist form is visible |
| TA-04 | Without token: "Send a file" link not shown | QUnit | Component | Clear `localStorage`, verify no "Send a file" link pointing to the upload page |
| TA-05 | Token detection uses correct localStorage key | QUnit | Unit | Verify the component reads from the same key that the access gate writes to (currently inspecting `send-access-gate.js` for the key name) |

**Testing notes:**
- QUnit `afterEach` must clean up `localStorage` to prevent test pollution.
- The localStorage key name must be confirmed from the `send-access-gate` component (likely `sgraph-send-token` or similar).

---

### 1.4 Analytics Pulse Not Working (Brief #4)

**Bug:** The Analytics Pulse feature on the admin Lambda is not functioning.

**Current state:** Backend tests exist (`test_Routes__Analytics.py` -- 3 tests, all verify the pulse endpoint returns 200 and correct structure). The `<analytics-dashboard>` component exists at `v0.1.0/components/analytics-dashboard/`. The admin shell mounts it with `data-panel="analytics"`. The backend tests pass, so the issue is likely in the frontend's connection to the backend or in the component's data rendering.

**Test approach:** Need both backend verification (confirm the endpoint works in deployed state) and frontend verification (confirm the component fetches and renders correctly).

| ID | Test | Type | Layer | Assertion |
|----|------|------|-------|-----------|
| AP-01 | Analytics Pulse smoke test -- deployed endpoint returns 200 | Smoke (pytest) | API | GET `/health/pulse` returns 200 with valid JSON containing all 4 expected fields |
| AP-02 | Analytics dashboard component fetches pulse data on activation | QUnit | Component | When `onActivated()` is called, the component makes a fetch to `/health/pulse` |
| AP-03 | Analytics dashboard renders non-zero pulse data | QUnit | Component | Given mock pulse response `{active_requests: 5, ...}`, the component renders the values visually |
| AP-04 | Analytics dashboard handles API error gracefully | QUnit | Component | When fetch returns 500, the component shows an error state, does not crash |

**Testing notes:**
- The smoke test AP-01 is critical -- it tells us whether the issue is backend or frontend.
- If backend smoke test passes, the bug is in the frontend component or its wiring to `adminAPI`.

---

### 1.5 Upload Progress Granularity (Brief #5)

**Bug:** Upload progress bar stalls -- only two states (33% encrypting, 66% uploading) with no granular events.

**Current state:** `send-upload.js` (v0.1.4) has `renderProgress()` at lines 127-140. It shows a hardcoded `33%` for `encrypting` and `66%` for `uploading`. The `startUpload()` method transitions through `idle -> encrypting -> uploading -> complete` with no intermediate progress events. The progress bar is purely state-driven, not event-driven.

**Test approach:** The fix will add granular progress events for each stage. Tests must verify that each stage produces a visible progress update and that the progress bar reflects the current stage.

| ID | Test | Type | Layer | Assertion |
|----|------|------|-------|-----------|
| UP-01 | Progress bar shows "File selected" state | QUnit | Component | After file selection, a "File selected" status is shown |
| UP-02 | Progress bar shows encryption progress percentage | QUnit | Component | During encryption, progress updates with percentage (not fixed 33%) |
| UP-03 | Progress bar shows "Encryption complete" state | QUnit | Component | After encryption finishes but before upload starts, a brief "Encryption complete" status appears |
| UP-04 | Progress bar shows upload progress percentage | QUnit | Component | During upload, progress updates with actual upload percentage (not fixed 66%) |
| UP-05 | Progress bar shows "Upload complete" state | QUnit | Component | After upload finishes, "Upload complete" status appears before link generation |
| UP-06 | All progress stages fire custom events | QUnit | Unit | The component dispatches `upload-progress` events with `{stage, percentage}` for each stage |
| UP-07 | Progress bar reaches 100% on completion | QUnit | Component | When state becomes `complete`, progress bar is at 100% |

**Testing notes:**
- Encryption progress is hard to test without real Web Crypto API. The test environment (QUnit in browser) supports Web Crypto, so real encryption can be used with small test payloads.
- Upload progress depends on `XMLHttpRequest` or `fetch` with upload progress events. The Dev may need to switch from `fetch` to `XMLHttpRequest` for `upload.onprogress` support, or use the `ReadableStream` approach.
- For QUnit tests, mock the API client to simulate slow responses and verify intermediate progress updates.

---

### 1.6 Navigation Guards (Brief #6)

**Bug:** User can navigate away during upload/download with no warning, losing the transfer.

**Current state:** Neither `send-upload.js` nor `send-download.js` registers a `beforeunload` event handler. No navigation guard exists.

**Test approach:** The `beforeunload` event is browser-native and behaves differently across browsers. Testing it requires Playwright because QUnit cannot meaningfully simulate browser-level navigation.

| ID | Test | Type | Layer | Assertion |
|----|------|------|-------|-----------|
| NG-01 | `beforeunload` handler registered during upload | Playwright E2E | Browser | Start an upload, attempt to close tab -- browser shows native "leave?" dialog (Playwright can detect the `dialog` event) |
| NG-02 | `beforeunload` handler registered during download | Playwright E2E | Browser | Start a download/decryption, attempt to navigate away -- browser shows warning |
| NG-03 | `beforeunload` handler removed after transfer completes | Playwright E2E | Browser | After successful upload, navigate away -- no warning dialog |
| NG-04 | On-page links show confirmation during active transfer | QUnit | Component | During upload state (`encrypting` or `uploading`), clicking an on-page link dispatches a confirmation prompt rather than navigating |
| NG-05 | On-page links work normally when no transfer active | QUnit | Component | In `idle` or `complete` state, on-page links navigate without interception |

**Testing notes:**
- `beforeunload` testing is browser-specific. Chromium-based browsers allow Playwright to listen for the `dialog` event. Firefox and Safari handle it differently. Target Chrome first (P0 browser).
- Playwright test pattern:
  ```javascript
  page.on('dialog', dialog => { assert(dialog.type() === 'beforeunload'); dialog.dismiss(); });
  await page.close();
  ```
- The `beforeunload` handler itself is a one-liner in the component. The harder part is testing on-page link interception (NG-04), which requires the component to track transfer state globally.

---

## 2. Test Strategy for SA Dashboard

The SA dashboard introduces path-based URL routing, a cache browser UI, and multiple new views. This is a fundamentally new test surface.

### 2.1 Path-Based Routing Tests

The brief specifies path-based URLs (Decision D038):
```
/admin/dashboard/                    -> SA overview
/admin/dashboard/lambda/{id}         -> Lambda detail
/admin/dashboard/cloudfront/         -> CloudFront overview
/admin/dashboard/cache/              -> Cache browser
/admin/dashboard/costs/              -> Cost dashboard
```

**Test approach:** Path-based routing in a single-page app requires either server-side route handling (Lambda returns the same HTML for all `/admin/dashboard/*` paths) or client-side routing with `History API`. Both need testing.

| ID | Test | Type | Layer | Assertion |
|----|------|------|-------|-----------|
| RT-01 | Direct URL `/admin/dashboard/` loads SA overview | Smoke (pytest) | API | GET `/admin/dashboard/` returns 200 with HTML containing the SA overview component |
| RT-02 | Direct URL `/admin/dashboard/cache/` loads cache browser | Smoke (pytest) | API | GET `/admin/dashboard/cache/` returns 200 with HTML (not 404) |
| RT-03 | Direct URL `/admin/dashboard/lambda/user-dev` loads Lambda detail | Smoke (pytest) | API | GET `/admin/dashboard/lambda/user-dev` returns 200 with HTML (not 404) |
| RT-04 | Client-side navigation updates URL | QUnit | Component | Clicking "Cache" nav item pushes `/admin/dashboard/cache/` to `history.state` |
| RT-05 | Browser back button navigates between SA views | Playwright E2E | Browser | Navigate dashboard -> cache -> back -> verify URL is `/admin/dashboard/` and overview is visible |
| RT-06 | Unknown dashboard path shows 404 or fallback | Smoke (pytest) | API | GET `/admin/dashboard/nonexistent/` returns 404 or redirects to `/admin/dashboard/` |

**Testing notes:**
- Server-side route handling is critical. If the Lambda does not serve the SA HTML for all `/admin/dashboard/*` paths, direct URL access will 404. This must be tested as a smoke test on every deployment.
- The admin Lambda currently uses static file serving via `osbot-fast-api`. The Dev will need to add a catch-all route for `/admin/dashboard/*` that serves the SA HTML.

### 2.2 Cache Browser Tests

The cache browser is the highest-priority SA view (Decision D039). It must browse cache IDs, view temporal data, inspect entries, and navigate the folder structure.

| ID | Test | Type | Layer | Assertion |
|----|------|------|-------|-----------|
| CB-01 | Cache browser lists available cache IDs | QUnit | Component | Given a mock API response with 3 cache IDs, the component renders 3 entries |
| CB-02 | Clicking a cache ID shows temporal data | QUnit | Component | Clicking a cache entry shows date-based temporal navigation |
| CB-03 | "Latest" folder shows current data | QUnit | Component | Clicking "latest" on a cache entry renders the current version of the data |
| CB-04 | JSON cache entries render as formatted JSON | QUnit | Component | A cache entry containing JSON is displayed with syntax highlighting or formatted output |
| CB-05 | Cache browser URL reflects current navigation | QUnit | Component | Navigating to a specific cache ID updates the URL to `/admin/dashboard/cache/{cache-id}` |
| CB-06 | Cache browser handles empty cache gracefully | QUnit | Component | When the cache is empty, the component shows a "No data" message, not an error |

### 2.3 URL-Based Test Cases

Every SA dashboard view must be reachable by direct URL. This is a smoke test matrix.

| ID | URL Pattern | Expected Result |
|----|-------------|-----------------|
| URL-01 | `/admin/dashboard/` | SA overview page loads |
| URL-02 | `/admin/dashboard/cache/` | Cache browser loads with root listing |
| URL-03 | `/admin/dashboard/cache/{id}` | Cache browser loads with specific cache ID selected |
| URL-04 | `/admin/dashboard/lambda/` | Lambda list loads |
| URL-05 | `/admin/dashboard/lambda/{id}` | Lambda detail loads for specific function |
| URL-06 | `/admin/dashboard/cloudfront/` | CloudFront overview loads |
| URL-07 | `/admin/dashboard/costs/` | Cost dashboard loads |

**Testing notes:**
- URL-01 through URL-03 are P1 (shipped with cache browser). URL-04 through URL-07 are P2 (shipped as subsequent views are built).
- Each URL test is a smoke test: HTTP GET returns 200 with meaningful HTML.

---

## 3. Carryover: v0.3.0 Admin UI Test Plan (46 Tests)

The v0.3.0 QA response defined 46 tests across 5 categories for the admin UI. Here is the status of each category.

### 3.1 Status Summary

| Category | Tests Planned | Status | Notes |
|----------|--------------|--------|-------|
| API Client (T-API-01 to T-API-07) | 7 | **READY TO IMPLEMENT** | `admin-api.js` exists at `v0.1.0/js/admin-api.js`. Component exists. Tests can be written. |
| Token Manager (T-TM-01 to T-TM-12) | 12 | **READY TO IMPLEMENT** | `token-manager.js` exists at `v0.1.0/components/token-manager/`. Component is live in v0.1.1. |
| Token Flows (T-FC-01 to T-FC-03) | 3 | **READY TO IMPLEMENT** | Integration tests -- all components exist. |
| Analytics Dashboard (T-AD-01 to T-AD-06) | 6 | **BLOCKED** | Analytics Pulse bug (Brief #4) must be fixed first. Tests are designed but the component may change. |
| System Health (T-SH-01 to T-SH-04) | 4 | **READY TO IMPLEMENT** | `system-info` component exists. |
| Pulse API Contract (T-PA-01 to T-PA-03) | 3 | **READY TO IMPLEMENT** | Backend tests can be written immediately. |
| Smoke Tests (S-01 to S-10) | 10 | **PARTIALLY READY** | S-01 to S-07 can be written now. S-08 (CORS) needs deployed endpoint. S-09 needs middleware verification. S-10 needs content inspection. |
| E2E (Playwright) | 3 | **DEFERRED** | Requires deployed admin UI. No blocker on scaffolding. |
| **Total** | **46** | **33 ready, 6 blocked, 3 deferred, 4 partial** | |

### 3.2 Adjustments Needed

The v0.3.10 brief introduces changes that affect the v0.3.0 test plan:

1. **Analytics Dashboard tests (T-AD-01 to T-AD-06):** Remain valid but are blocked by the Pulse fix. Once the Pulse bug is resolved, these tests become immediately relevant. The test assertions are still correct.

2. **Token Manager tests:** New requirement from Brief #3 (token usage display) adds tests beyond the original T-TM scope. The token manager component may gain a usage counter display. Add 2 new tests (see Section 4).

3. **Smoke tests:** The SA dashboard introduces new smoke test targets (RT-01 to RT-03, RT-06 from Section 2.1). These supplement the existing S-01 to S-10.

4. **New component: metrics-dashboard.** The v0.1.1 admin UI adds `<metrics-dashboard>` which was not in the v0.3.0 plan. This needs a test suite (covered by the SA tests in Section 2).

### 3.3 Revised Totals

| Source | Tests |
|--------|-------|
| v0.3.0 carryover (admin UI) | 46 |
| v0.3.10 P1 bug fix tests (Section 1) | 28 |
| v0.3.10 SA dashboard tests (Section 2) | 19 |
| v0.3.10 new requirements (Section 4) | 7 |
| Overlap / superseded | -16 (analytics tests counted in both, routing tests overlap smoke) |
| **Net total test backlog** | **84** |

---

## 4. New Test Requirements

The v0.3.10 brief introduces three testing challenges that did not exist in v0.3.0.

### 4.1 `beforeunload` Guard Testing (Browser-Specific)

The `beforeunload` event is one of the most difficult browser events to test programmatically:

- **Chrome/Edge:** Playwright can intercept via `page.on('dialog')`. The browser shows a generic "Changes you made may not be saved" message (custom messages are ignored since Chrome 51).
- **Firefox:** Playwright can intercept similarly, but Firefox may handle the event differently in headless mode.
- **Safari:** Safari's Playwright support is limited. The `beforeunload` event may not fire in WebKit headless.

**Recommended approach:**
1. **Primary test (Playwright, Chrome):** Register `page.on('dialog')`, trigger navigation during upload, assert dialog fires.
2. **Fallback test (QUnit):** Verify the `beforeunload` handler is registered by checking `window.onbeforeunload` or by listening for `addEventListener('beforeunload', ...)`. This does not test the browser behaviour but confirms the code path.
3. **Manual test checklist** for Safari and Firefox (documented, not automated).

| ID | Test | Type | Browser Target | Assertion |
|----|------|------|----------------|-----------|
| BU-01 | `beforeunload` registered during upload | QUnit | All | After state transitions to `encrypting`, `window.onbeforeunload` is a function (or event listener is registered) |
| BU-02 | `beforeunload` removed after completion | QUnit | All | After state transitions to `complete`, `window.onbeforeunload` is null |
| BU-03 | Browser dialog fires on navigation during upload | Playwright | Chrome | Start upload, attempt `page.close()`, dialog event fires |

### 4.2 Upload Progress Event Testing

The current upload flow uses `fetch` API for upload (`ApiClient.uploadPayload`). The `fetch` API does NOT support upload progress events natively. To get granular upload progress, the implementation will need one of:

1. **`XMLHttpRequest` with `upload.onprogress`** -- most compatible, well-tested.
2. **`ReadableStream` body with `fetch`** -- modern but limited browser support for upload streams.
3. **Chunked upload with per-chunk progress** -- requires backend changes (multipart upload).

**Test implications:**
- If the Dev uses `XMLHttpRequest`, tests can mock `upload.onprogress` events in QUnit.
- If the Dev uses chunked upload, tests must verify per-chunk progress events.
- Encryption progress requires testing the Web Crypto API callback pattern (or wrapping `crypto.subtle.encrypt` with progress estimation based on file size).

| ID | Test | Type | Layer | Assertion |
|----|------|------|-------|-----------|
| PE-01 | Encryption stage emits progress events | QUnit | Unit | During encryption of a 1MB test payload, at least 2 progress events are emitted with increasing percentages |
| PE-02 | Upload stage emits progress events | QUnit | Unit | During upload, at least 3 progress events are emitted corresponding to data sent |
| PE-03 | Progress events contain stage identifier | QUnit | Unit | Each progress event includes a `stage` field (`encrypting`, `uploading`, `processing`, etc.) |
| PE-04 | Progress percentage is monotonically increasing | QUnit | Unit | No progress event has a percentage lower than the previous event's percentage |

### 4.3 Path-Based URL Routing

Path-based routing changes the testing model fundamentally compared to the current hash-based approach:

- **Hash-based (current user UI):** `download.html#transferId/key` -- the server only sees `download.html`, routing is purely client-side. Tests only need one server-side route.
- **Path-based (new SA dashboard):** `/admin/dashboard/cache/{id}` -- the server must handle all sub-paths. Every distinct path needs a server-side smoke test.

**Test implications:**
1. Every new SA view adds at least 1 server-side smoke test (does the route return 200?).
2. Client-side routing must handle `popstate` events for browser back/forward.
3. The `History API` usage (`pushState`, `replaceState`) must be tested.

**Backend route registration tests (new pytest tests):**

| ID | Test | Type | Layer | Assertion |
|----|------|------|-------|-----------|
| PR-01 | `/admin/dashboard/` route is registered in FastAPI | pytest | Integration | Admin FastAPI app has a route matching `/admin/dashboard/` |
| PR-02 | `/admin/dashboard/{path:path}` catch-all returns 200 | pytest | Integration | GET `/admin/dashboard/cache/test-id` returns 200 with HTML content-type |
| PR-03 | Dashboard route serves SA HTML, not JSON | pytest | Integration | Response content-type is `text/html`, body contains `<!DOCTYPE html>` |

---

## 5. Recommendations: Test Priority Order

Aligned with the Conductor's three-track structure and the Dev's recommended execution order from the Librarian's master index.

### 5.1 Priority Order

| Order | Track | Tests | Blocked By | Ship With |
|-------|-------|-------|------------|-----------|
| **1** | UX Bug Fixes | BF-01 to BF-03 (loading state) | Dev fix for loading state | Dev P1 #1 |
| **2** | UX Bug Fixes | TE-01 to TE-06 (token expiry) | Dev fix for token expiry | Dev P1 #2 |
| **3** | UX Bug Fixes | TA-01 to TA-05 (token-aware state) | Dev fix for token-aware state | Dev P1 #3 |
| **4** | UX Bug Fixes | UP-01 to UP-07 (upload progress) | Dev fix for upload progress | Dev P1 #5 |
| **5** | UX Bug Fixes | NG-01 to NG-05, BU-01 to BU-03 (navigation guards) | Dev fix for beforeunload | Dev P1 #6 |
| **6** | Admin | AP-01 to AP-04 (analytics pulse) | Dev fix for analytics pulse | Dev P1 #4 |
| **7** | SA Foundation | PR-01 to PR-03 (path-based routing backend) | Architect routing design + Dev implementation | Dev P1 #7 / P2 #17 |
| **8** | SA Foundation | RT-01 to RT-06 (routing smoke tests) | Path-based routing deployed | Dev P2 #17 |
| **9** | SA Foundation | CB-01 to CB-06 (cache browser) | Cache browser component built | Dev P1 #7 |
| **10** | Admin Carryover | T-API-01 to T-API-07, T-TM-01 to T-TM-12, T-SH-01 to T-SH-04 (v0.3.0 admin UI) | Nothing (components exist) | Parallel with Dev P2 work |
| **11** | Admin Carryover | S-01 to S-10 (smoke tests) | Deployed admin Lambda | Deployment pipeline |
| **12** | UX Features | PE-01 to PE-04 (progress events unit) | Dev implementation of granular events | Dev P2 #8 |

### 5.2 Rationale

1. **User-facing bug fix tests first (Orders 1-5).** Every new user hits these bugs. Tests should be written immediately after the Dev's fix lands -- or ideally, tests should be written first (test-first where possible) to define the expected behaviour.

2. **Analytics Pulse tests (Order 6)** are separated from the other user-facing bugs because the Pulse is admin-facing and the root cause may be frontend-only (backend tests already pass).

3. **SA foundation tests (Orders 7-9)** are gated by the Architect's routing design. QA should prepare test scaffolds now so tests can be filled in as soon as the implementation lands.

4. **Admin carryover tests (Order 10)** have no blockers -- the components exist. These can be written in parallel with Dev P2 work. They do not block any new features but close the testing gap identified in v0.3.0.

5. **Smoke tests (Order 11)** require a deployed admin Lambda. They should be wired into the CI pipeline as soon as they are written.

### 5.3 Immediate Actions (What QA Can Do Now)

| Action | Blocked By | Output |
|--------|------------|--------|
| Scaffold QUnit test infrastructure for admin UI | Nothing | `tests/index.html`, `test-paths.js`, `test-utils.js` |
| Write API client tests (T-API-01 to T-API-07) | Nothing | `admin-api-client.test.js` |
| Write token manager unit tests (T-TM-01 to T-TM-12) | Nothing | `token-manager.test.js` |
| Write system health tests (T-SH-01 to T-SH-04) | Nothing | `system-info.test.js` |
| Write pulse API contract tests (T-PA-01 to T-PA-03) | Nothing | Extend `test_Routes__Analytics.py` |
| Write smoke test scaffold (S-01 to S-07) | Nothing | `tests/smoke/test_smoke__admin.py` |
| Prepare Playwright test scaffolds for loading state (BF-01 to BF-03) | Dev fix | `tests/e2e/test_download_loading.py` |
| Prepare Playwright test scaffolds for navigation guards (NG-01 to NG-03) | Dev fix | `tests/e2e/test_navigation_guards.py` |

### 5.4 Test-First Opportunities

For the P1 bug fixes, QA can define the expected behaviour as test cases before the Dev implements the fix. This is particularly valuable for:

- **Token expiry messages (TE-01 to TE-05):** The expected messages are defined in the brief. QA can write the test assertions now.
- **Token-aware state (TA-01 to TA-04):** The two states (has token vs. no token) are clearly defined. Tests can be written before implementation.
- **Navigation guards (BU-01, BU-02):** The `beforeunload` registration/deregistration is a simple boolean check. The test can be written now.

---

## 6. Risks

| ID | Risk | Likelihood | Impact | Mitigation |
|----|------|-----------|--------|------------|
| QA-R05 | `beforeunload` tests unreliable in headless Playwright | Medium | Medium | Run in headed mode for CI; add manual test checklist for Safari/Firefox |
| QA-R06 | Upload progress granularity depends on `XMLHttpRequest` vs `fetch` decision | High | Low | Write tests against the event interface (`upload-progress` event), not the implementation |
| QA-R07 | Path-based routing smoke tests fail if Lambda catch-all route not implemented | High | High | Coordinate with Dev -- QA writes smoke test, Dev ensures route exists. Test fails fast and loudly. |
| QA-R08 | v0.3.0 admin UI tests (46) remain unimplemented while new tests (38) are added | Medium | Medium | Prioritise v0.3.0 carryover tests in parallel with P2 Dev work (Order 10). Do not let the backlog grow unbounded. |
| QA-R09 | SA dashboard cache browser tests depend on cache service API shape | Medium | Low | Write tests against mock data. Update when API contract is finalised by Architect. |
| QA-R10 | Web Crypto API not available in QUnit test runner (if served over HTTP) | Low | High | Ensure test runner is served over HTTPS or localhost (Web Crypto requires secure context) |

---

## 7. Summary

| Metric | Value |
|--------|-------|
| P1 bug fix tests defined | 28 |
| SA dashboard tests defined | 19 |
| New requirement tests (beforeunload, progress, routing) | 7 |
| v0.3.0 carryover tests | 46 |
| Overlap/superseded | -16 |
| **Total test backlog** | **84** |
| Tests writable immediately (no blockers) | 33 |
| Tests blocked by Dev fixes | 28 |
| Tests blocked by Architect design | 9 |
| Tests deferred (Playwright E2E on deployed system) | 14 |

**Bottom line:** QA can productively write 33 tests right now (admin UI carryover + smoke scaffolds + pulse API contract tests). The remaining 51 tests are gated by Dev and Architect deliverables. The test priority order follows the Dev execution order: user-facing P1 bugs first, then admin Pulse, then SA foundation, then carryover and P2 features.

---

*QA is ready to begin test implementation. Recommend starting with the 33 unblocked tests (admin UI carryover from v0.3.0) while preparing test scaffolds for the P1 bug fixes. Each bug fix should ship with its corresponding test suite.*
