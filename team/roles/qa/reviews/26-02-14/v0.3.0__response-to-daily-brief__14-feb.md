# v0.3.0 -- QA Response to Daily Brief (14 Feb 2026)

**Version:** v0.3.0
**Date:** 2026-02-14
**Role:** QA
**Brief:** `team/humans/dinis_cruz/briefs/02/14/v0.3.0__daily-brief__sgraph-send-14-feb-2026.md`
**Directive:** Plan admin UI test strategy. Update smoke test suite for admin endpoints.

---

## Executive Summary

The v0.3.0 brief establishes the admin UI as the primary deliverable. The backend is fully wired -- `Routes__Tokens` (5 endpoints), `Routes__Analytics` (1 endpoint), `Middleware__Analytics`, and the inter-Lambda `Admin__Service__Client` are all implemented and tested with 111+ passing unit tests. The admin UI (`sgraph_ai_app_send__ui__admin/v0/v0.1/v0.1.0/index.html`) is currently a placeholder string: `"IFD version v0.1.0 will go here"`.

This response defines the complete test strategy for the admin UI, covering backend integration, frontend IFD tests, smoke tests, and browser compatibility.

---

## 1. Current Test Baseline

### Backend Tests (Passing -- 111+ total)

| Test File | Tests | Coverage |
|-----------|-------|----------|
| `tests/unit/lambda__admin/fast_api/routes/test_Routes__Tokens.py` | 7 | Create, duplicate, missing name, lookup, not found, use, revoke, list |
| `tests/unit/lambda__admin/fast_api/routes/test_Routes__Analytics.py` | 3 | Pulse 200, pulse counts, custom window |
| `tests/unit/lambda__admin/service/test_Service__Tokens.py` | Token lifecycle | Create, lookup, use, revoke, list, exhaustion |
| `tests/unit/lambda__admin/service/test_Service__Analytics__Pulse.py` | Pulse computation | Window filtering, visitor dedup, transfer counting |
| `tests/unit/lambda__admin/service/test_Send__Cache__Client.py` | Cache operations | All namespace operations (analytics, tokens) |

### Frontend Tests (None -- placeholder UI)

No frontend tests exist. The admin UI v0.1.0 is the base IFD version and requires full test coverage per IFD testing guide.

---

## 2. Admin UI Test Strategy

### 2.1 Test Layers

```
Layer 4: E2E (Playwright)        -- Full browser flow against deployed admin Lambda
Layer 3: Integration (QUnit)     -- Component interaction on admin pages
Layer 2: Unit (QUnit)            -- Individual Web Component methods
Layer 1: API (pytest)            -- Backend endpoint contracts (EXISTING)
Layer 0: Service (pytest)        -- Business logic in-memory (EXISTING)
```

Layers 0 and 1 are already covered. This strategy focuses on Layers 2-4.

### 2.2 Test Infrastructure (IFD-Compliant)

Per the IFD Testing Guide (`library/guides/development/ifd/v1.2.0__ifd__testing_guide.md`), tests are co-located with source files and use QUnit with zero build dependencies.

```
sgraph_ai_app_send__ui__admin/
  v0/v0.1/
    tests/
      test-paths.js              -- Path configuration for admin UI
      test-utils.js              -- Shared helpers (reuse from IFD guide)
      index.html                 -- Global test runner
    v0.1.0/
      index.html                 -- Admin console entry point
      components/
        token-manager/
          token-manager.js       -- Web Component
          token-manager.test.js  -- Unit tests (co-located)
        analytics-dashboard/
          analytics-dashboard.js
          analytics-dashboard.test.js
        system-health/
          system-health.js
          system-health.test.js
      js/
        admin-api-client.js      -- API client for admin endpoints
        admin-api-client.test.js
      index.html.test.js         -- Integration test for full page
```

---

## 3. Token Management UI Tests

### 3.1 API Client Tests (`admin-api-client.test.js`)

These test the JavaScript API client that calls admin Lambda endpoints.

| # | Test | Method Under Test | Assertion |
|---|------|-------------------|-----------|
| T-API-01 | `createToken sends POST with correct body` | `createToken(name, limit)` | POST to `/tokens/create` with `{token_name, usage_limit}` |
| T-API-02 | `listTokens returns parsed file list` | `listTokens()` | GET to `/tokens/list`, returns `{files: [...]}` |
| T-API-03 | `lookupToken sends GET with token name` | `lookupToken(name)` | GET to `/tokens/lookup/{name}`, returns token data |
| T-API-04 | `revokeToken sends POST with token name` | `revokeToken(name)` | POST to `/tokens/revoke/{name}`, returns `{status: 'revoked'}` |
| T-API-05 | `createToken handles 409 duplicate` | `createToken(name, limit)` | Returns error on duplicate token name |
| T-API-06 | `lookupToken handles 404` | `lookupToken(name)` | Returns null/error for nonexistent token |
| T-API-07 | `API client includes auth headers` | All methods | Every request includes API key header |

### 3.2 Token Manager Component Tests (`token-manager.test.js`)

| # | Test | Flow | Assertion |
|---|------|------|-----------|
| T-TM-01 | `renders create form with name and limit fields` | Component init | Form elements present in shadow DOM |
| T-TM-02 | `create button dispatches token-create event` | Fill form, click create | Custom event fired with `{token_name, usage_limit}` |
| T-TM-03 | `displays token list from API response` | Load with mock data | Table rows match token count |
| T-TM-04 | `token list shows name, status, usage count` | Load with mock data | Each row has name, status badge, usage fraction |
| T-TM-05 | `clicking token name shows detail view` | Click row | Detail panel shows full token metadata |
| T-TM-06 | `revoke button dispatches token-revoke event` | Click revoke on active token | Custom event fired with `{token_name}` |
| T-TM-07 | `revoked token shows revoked badge` | After revoke | Status badge changes to 'revoked' |
| T-TM-08 | `exhausted token shows exhausted badge` | Token at limit | Status badge shows 'exhausted' |
| T-TM-09 | `create form validates empty name` | Submit empty name | Error message shown, no API call |
| T-TM-10 | `usage limit defaults to 50` | Open create form | Limit input pre-filled with 50 |
| T-TM-11 | `empty token list shows placeholder message` | No tokens exist | "No tokens created yet" message |
| T-TM-12 | `token list refreshes after create` | Create token | List re-fetches and shows new token |

### 3.3 Full Create Flow (Integration)

| # | Test | Steps | Assertion |
|---|------|-------|-----------|
| T-FC-01 | `full create-to-list flow` | Fill form -> create -> verify in list | Token appears in list with correct name and status 'active' |
| T-FC-02 | `full create-revoke flow` | Create -> revoke -> verify status | Token status changes to 'revoked' in list |
| T-FC-03 | `full create-lookup flow` | Create -> click name -> verify details | Detail view shows usage_limit, usage_count=0, created_by |

---

## 4. Analytics Dashboard Tests

### 4.1 Analytics Dashboard Component Tests (`analytics-dashboard.test.js`)

| # | Test | Flow | Assertion |
|---|------|------|-----------|
| T-AD-01 | `renders pulse metrics on load` | Component init with mock pulse | Shows active_requests, active_visitors, active_transfers |
| T-AD-02 | `pulse shows window_minutes label` | Load pulse data | "Last 5 minutes" label displayed |
| T-AD-03 | `custom window parameter sent to API` | Change window dropdown | GET `/health/pulse?window_minutes=15` called |
| T-AD-04 | `zero metrics display correctly` | Empty pulse (all zeros) | Shows "0" for all metrics, no errors |
| T-AD-05 | `auto-refresh fetches new pulse data` | Wait for refresh interval | Second API call made after interval |
| T-AD-06 | `error state displayed on API failure` | Mock API 500 | Error message shown, no crash |

### 4.2 Pulse API Contract Tests (Backend -- NEW)

These extend the existing `test_Routes__Analytics.py`:

| # | Test | Endpoint | Assertion |
|---|------|----------|-----------|
| T-PA-01 | `pulse returns integer counts` | `GET /health/pulse` | All count fields are integers >= 0 |
| T-PA-02 | `pulse with window=0 returns empty` | `GET /health/pulse?window_minutes=0` | Graceful handling, no crash |
| T-PA-03 | `pulse with large window still works` | `GET /health/pulse?window_minutes=60` | Returns valid response |

---

## 5. System Health Display Tests

| # | Test | Flow | Assertion |
|---|------|------|-----------|
| T-SH-01 | `displays application version` | Component init | Shows version from `/config/version` or hardcoded |
| T-SH-02 | `displays service info from /info endpoint` | Component init | Shows service name, version from Routes__Info |
| T-SH-03 | `health check shows green on success` | Cache healthy | Green status indicator |
| T-SH-04 | `health check shows red on failure` | Cache unhealthy | Red status indicator |

---

## 6. Smoke Test Additions for Admin Endpoints

These run after every deployment (CI pipeline or manual). They validate the admin Lambda is alive and correctly configured.

### 6.1 New Smoke Tests

| # | Test | Endpoint | Expected | Priority |
|---|------|----------|----------|----------|
| S-01 | `admin health pulse returns 200` | `GET /health/pulse` | 200 + valid JSON with 4 count fields | P0 |
| S-02 | `admin info returns version` | `GET /info` | 200 + `version` field matches deployed version | P0 |
| S-03 | `admin static redirect works` | `GET /admin` | 302 redirect to `/admin/v0/v0.1/v0.1.0/index.html` | P0 |
| S-04 | `admin static UI loads` | `GET /admin/v0/v0.1/v0.1.0/index.html` | 200 + HTML content (not placeholder) | P1 |
| S-05 | `token create requires auth` | `POST /tokens/create` (no API key) | 401 or 403 | P0 |
| S-06 | `token create works with auth` | `POST /tokens/create` (with API key) | 200 + `{cache_id, token_name}` | P1 |
| S-07 | `token list works` | `GET /tokens/list` | 200 + `{files: [...]}` | P1 |
| S-08 | `CORS headers present` | `OPTIONS /health/pulse` | Access-Control-Allow-Origin present | P1 |
| S-09 | `analytics middleware records events` | `GET /health/pulse` twice | Second pulse shows >= 1 active_requests | P2 |
| S-10 | `no plaintext in admin responses` | All endpoints | No response body contains unencrypted file content | P0 |

### 6.2 Smoke Test Implementation Pattern

```python
# tests/smoke/test_smoke__admin.py (proposed)
class test_smoke__admin(TestCase):
    """Post-deployment smoke tests for admin Lambda.
       Run against live admin Lambda URL from env var."""

    @classmethod
    def setUpClass(cls):
        cls.base_url    = get_env('SGRAPH_SEND__ADMIN__BASE_URL', '')
        cls.api_key     = get_env('SGRAPH_SEND__ADMIN__API_KEY__VALUE', '')
        cls.headers     = {'x-api-key': cls.api_key}
        if not cls.base_url:
            raise SkipTest('SGRAPH_SEND__ADMIN__BASE_URL not set')

    def test__S01__pulse_returns_200(self):
        response = httpx.get(f'{self.base_url}/health/pulse', headers=self.headers)
        assert response.status_code == 200
        data = response.json()
        for key in ('active_requests', 'active_visitors', 'active_transfers', 'window_minutes'):
            assert key in data
```

---

## 7. IFD Compliance Checklist for Admin UI

Per the IFD methodology and testing guide, the admin UI v0.1.0 must satisfy:

### 7.1 Structure Compliance

| # | Requirement | Status | Notes |
|---|-------------|--------|-------|
| IFD-01 | Version path: `v0/v0.1/v0.1.0/` | PASS | Path exists at `sgraph_ai_app_send__ui__admin/v0/v0.1/v0.1.0/` |
| IFD-02 | Entry point: `index.html` | NEEDS WORK | File exists but contains placeholder text only |
| IFD-03 | Web Components (custom elements) | NOT STARTED | No components defined yet |
| IFD-04 | Zero framework dependencies | N/A | Will verify when implemented |
| IFD-05 | Co-located test files (`*.test.js`) | NOT STARTED | No test files exist |
| IFD-06 | Shared test runner (`tests/index.html`) | NOT STARTED | No test infrastructure |
| IFD-07 | `test-paths.js` with component chains | NOT STARTED | First version -- no chains needed, single paths |
| IFD-08 | `test-utils.js` shared helpers | NOT STARTED | Can reuse pattern from IFD testing guide |

### 7.2 Testing Compliance

| # | Requirement | Status | Notes |
|---|-------------|--------|-------|
| IFD-T01 | Co-located unit tests for each component | NOT STARTED | 0/3 components have test files |
| IFD-T02 | Integration test for index.html | NOT STARTED | `index.html.test.js` needed |
| IFD-T03 | Base version tests all methods | NOT STARTED | v0.1.0 is base -- full test coverage required |
| IFD-T04 | QUnit framework (no build step) | NOT STARTED | QUnit 2.20.0 CDN link |
| IFD-T05 | Tests run in browser (`tests/index.html`) | NOT STARTED | Must work with `open tests/index.html` |
| IFD-T06 | Tests run via Karma (CI) | DEFERRED | Can add once QUnit tests exist |
| IFD-T07 | `afterEach` cleanup in all modules | N/A | Must verify when implemented |
| IFD-T08 | No cross-version test dependencies | N/A | v0.1.0 is base -- no cross-version concern yet |

### 7.3 Security Compliance (Admin-Specific)

| # | Requirement | Status | Notes |
|---|-------------|--------|-------|
| IFD-S01 | API key never hardcoded in JS | MUST VERIFY | Key must come from cookie or auth flow |
| IFD-S02 | No credential exposure in browser DevTools | MUST VERIFY | Network tab must not show keys in URLs |
| IFD-S03 | API key sent via header, not query string | MUST VERIFY | All fetch calls use header-based auth |
| IFD-S04 | No localStorage/sessionStorage for secrets | MUST VERIFY | API key should use httpOnly cookie |
| IFD-S05 | CSP headers allow only required origins | MUST VERIFY | No inline scripts if possible |

---

## 8. Browser Compatibility Notes

### 8.1 Required Browser Support

The admin UI is an internal tool (not public-facing). Target browsers:

| Browser | Version | Priority | Notes |
|---------|---------|----------|-------|
| Chrome | Latest (130+) | P0 | Primary development browser |
| Firefox | Latest (130+) | P1 | Secondary testing |
| Safari | Latest (18+) | P2 | macOS admin users |
| Edge | Latest (130+) | P2 | Windows admin users |

### 8.2 Web API Dependencies

The admin UI requires these Web APIs (all widely supported):

| API | Purpose | Chrome | Firefox | Safari | Edge |
|-----|---------|--------|---------|--------|------|
| Fetch API | All API calls | Yes | Yes | Yes | Yes |
| Custom Elements v1 | Web Components | Yes | Yes | Yes | Yes |
| Shadow DOM v1 | Component encapsulation | Yes | Yes | Yes | Yes |
| ES Modules | `import`/`export` | Yes | Yes | Yes | Yes |
| CSS Custom Properties | Theming | Yes | Yes | Yes | Yes |
| `crypto.subtle` | Not needed (admin UI does no encryption) | N/A | N/A | N/A | N/A |

### 8.3 Known Compatibility Risks

| Risk | Impact | Mitigation |
|------|--------|------------|
| Shadow DOM style isolation | CSS may not cascade into components | Use CSS custom properties for theming |
| Fetch credentials mode | Cookie-based auth needs `credentials: 'include'` | Test in cross-origin deployment |
| ES Module CORS | Modules loaded cross-origin need CORS headers | Admin Lambda serves both UI and API |

### 8.4 Browser Test Matrix

| Test | Chrome | Firefox | Safari | Edge |
|------|--------|---------|--------|------|
| QUnit test suite passes | Required | Required | Desired | Desired |
| Token CRUD flows work | Required | Required | Desired | Desired |
| Analytics dashboard renders | Required | Required | Desired | Desired |
| Static redirect works | Required | Required | Required | Required |

---

## 9. Test Count Summary

### New Tests Required

| Category | Unit (QUnit) | Integration (QUnit) | Smoke (pytest) | E2E (Playwright) | Total |
|----------|-------------|--------------------|----|------|-------|
| Token Management | 12 | 3 | 3 | 2 | 20 |
| Analytics Dashboard | 6 | 0 | 2 | 1 | 9 |
| System Health | 4 | 0 | 2 | 0 | 6 |
| API Client | 7 | 0 | 0 | 0 | 7 |
| Admin Static | 0 | 1 | 3 | 0 | 4 |
| **Total** | **29** | **4** | **10** | **3** | **46** |

### Running Totals

| Metric | Before v0.3.0 | After v0.3.0 Admin UI |
|--------|--------------|----------------------|
| Backend tests (pytest) | 111+ | 111+ (existing) + 3 (new pulse contract) = 114+ |
| Frontend tests (QUnit) | 0 (admin) | 33 (29 unit + 4 integration) |
| Smoke tests | 0 (admin-specific) | 10 |
| E2E tests (Playwright) | 0 (admin) | 3 |
| **Grand Total** | 111+ | **160+** |

---

## 10. Implementation Priority

| Phase | Tests | Blocked By | Notes |
|-------|-------|------------|-------|
| **Phase A** | Smoke tests S-01 to S-05 | Nothing (endpoints exist) | Can write today |
| **Phase B** | API client tests T-API-01 to T-API-07 | Admin UI v0.1.0 JS | When admin-api-client.js exists |
| **Phase C** | Token manager tests T-TM-01 to T-TM-12 | Token manager component | When token-manager.js exists |
| **Phase D** | Analytics tests T-AD-01 to T-AD-06 | Analytics component | When analytics-dashboard.js exists |
| **Phase E** | Integration tests T-FC-01 to T-FC-03 | All components | When all components wired |
| **Phase F** | Playwright E2E | Deployed admin UI | After first admin UI deployment |

---

## 11. Risks

| ID | Risk | Likelihood | Impact | Mitigation |
|----|------|-----------|--------|------------|
| QA-R01 | Admin UI auth flow not testable in QUnit | Medium | High | Mock API client for unit tests; real auth in smoke/E2E |
| QA-R02 | IFD test infrastructure delays UI development | Low | Medium | Scaffold test-paths.js and test-utils.js first |
| QA-R03 | Cross-origin cookie auth fails in smoke tests | Medium | Medium | Use header-based auth for programmatic tests |
| QA-R04 | No CI pipeline for QUnit tests yet | High | Medium | Add Karma step to `ci-pipeline__dev.yml` when ready |

---

*QA is ready to scaffold the test infrastructure and write smoke tests immediately. Frontend unit tests will follow the IFD pattern as each component is implemented.*
