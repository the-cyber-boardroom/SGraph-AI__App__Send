# v0.2.1 — QA Response to MVP Infrastructure Brief

**Version:** v0.2.1
**Date:** 2026-02-10
**Role:** QA
**Responding to:** `team/humans/dinis_cruz/briefs/2026-02-10/v0.1.4__briefs__focus-on-mvp-release-infrastructure.md`

---

## 1. Test Matrix

The brief defines three dimensions: **storage modes × deployment targets × test levels**. Here is the complete matrix.

### 1.1 Storage Modes

| Mode | Backend | When Used |
|---|---|---|
| Memory | In-memory (dict-backed) | Unit tests, local integration tests |
| Disk | Local filesystem | Local dev server, some integration tests |
| S3 (LocalStack) | LocalStack container | CI integration tests |
| S3 (Real) | AWS S3 | Post-deploy smoke tests |

### 1.2 Deployment Targets

| Target | Entry Point | Storage |
|---|---|---|
| In-process (pytest) | Direct FastAPI TestClient | Memory |
| Local dev (uvicorn) | `uvicorn` with `--reload` | Disk or Memory |
| Lambda (AWS) | Mangum handler | S3 |
| Docker container | `uvicorn` in container | Memory, Disk, or S3 |
| ECS Fargate | Same container as Docker | S3 |
| EC2 instance | `uvicorn` via systemd | Disk or S3 |
| AMI | Same as EC2 (pre-baked) | Disk or S3 |
| GCP Cloud Run | Same container as Docker | S3 |

### 1.3 Test Levels

| Level | Scope | Storage Mode | Deployment Target | Mocks | CI Stage |
|---|---|---|---|---|---|
| Unit | Core library, schemas, storage adapters | Memory | In-process | None | Every push |
| Local Integration | Full stack, all storage modes | Memory, Disk, S3 (LocalStack) | In-process | None (except LocalStack for S3) | Every push |
| E2E (Playwright) | Browser-based user workflows | Memory or S3 | Local or Lambda | None | Every push (local), post-deploy (Lambda) |
| Post-Publish | Fresh PyPI install + CLI usage | Memory, Disk | Fresh environment | None | After PyPI publish |
| Deployment Smoke | Health, auth, CORS, frontend | S3 | Each deployed target | None | After each deploy |

---

## 2. Full Test Matrix (Storage × Target × Level)

### Unit Tests (7 existing + proposed)

| Test Area | Storage | Status | File |
|---|---|---|---|
| Version file | N/A | PASS (1 test) | `test_Version.py` |
| FastAPI client create | Memory | PASS (2 tests) | `test_Service__Fast_API__client.py` |
| Lambda handler | Memory | PASS (2 tests) | `test_lambda_handler.py` |
| Admin static pages | Memory | PASS (2 tests) | `test__App_Send__UI__Admin__static_pages.py` |
| Transfer create/upload | Memory | MISSING | — |
| Transfer download/decrypt cycle | Memory | MISSING | — |
| Token CRUD | Memory | MISSING | — |
| Schema validation | Memory | MISSING | — |
| Action event logging | Memory | MISSING | — |
| Privacy data flow (IP hash, anonymisation) | Memory | MISSING | — |
| Storage adapter (Memory) | Memory | MISSING | — |
| Storage adapter (Disk) | Disk | MISSING | — |
| Pre-signed URL generation | S3 (LocalStack) | MISSING | — |

### Local Integration Tests (all proposed)

| Test Scenario | Storage Mode | Status |
|---|---|---|
| Full transfer cycle (upload → encrypt → download → decrypt) | Memory | MISSING |
| Full transfer cycle | Disk | MISSING |
| Full transfer cycle | S3 (LocalStack) | MISSING |
| CLI upload + download | Memory | MISSING |
| CLI upload + download | Disk | MISSING |
| Multiple concurrent transfers | Memory | MISSING |
| Transfer expiry/cleanup | Memory | MISSING |
| Wrong decryption key → clear error | Memory | MISSING |
| Large file handling (near limit) | Memory | MISSING |

### E2E Tests (Playwright — all proposed)

| Test Scenario | Status |
|---|---|
| Upload via drag-and-drop | MISSING |
| Upload via file picker | MISSING |
| Full transfer cycle (upload → share → download → decrypt → verify) | MISSING |
| Wrong key shows clear error (not corrupted file) | MISSING |
| Transparency panel shows correct data | MISSING |
| Mobile layout loads correctly | MISSING |
| Admin console loads with auth | MISSING |
| Admin console blocked without auth | MISSING |

### Post-Publish Tests (all proposed)

| Test Scenario | Status |
|---|---|
| `pip install sgraph-ai-app-send` succeeds | MISSING |
| `sgraph-send --help` works | MISSING |
| CLI upload + download with memory backend | MISSING |
| CLI upload + download with disk backend | MISSING |
| Import and start FastAPI app programmatically | MISSING |

### Deployment Smoke Tests (per target — all proposed)

| Check | Lambda | Docker | Fargate | EC2 | AMI | GCP |
|---|---|---|---|---|---|---|
| `GET /health` returns 200 | TBD | TBD | TBD | TBD | TBD | TBD |
| Pre-signed URLs work | TBD | N/A | TBD | TBD | TBD | TBD |
| Token auth enforced (admin) | TBD | TBD | TBD | TBD | TBD | TBD |
| No plaintext in logs | TBD | TBD | TBD | TBD | TBD | TBD |
| CORS headers present | TBD | TBD | TBD | TBD | TBD | TBD |
| Frontend loads on mobile | TBD | TBD | TBD | TBD | TBD | TBD |
| Admin UI loads | TBD | TBD | TBD | TBD | TBD | TBD |

---

## 3. Current Test Analysis

### 3.1 What's Working (7 tests)

All 7 existing tests pass in ~2.25s. They use the no-mocks pattern: `Fast_API__SGraph__App__Send__Admin` is started in-memory and queried via FastAPI `TestClient`. This validates the Conductor's assertion about ~100ms startup.

### 3.2 Coverage Gaps (Critical)

| Gap | Risk | Priority |
|---|---|---|
| No transfer workflow tests | Core functionality untested | P0 |
| No encryption/decryption tests | Zero-knowledge guarantee unverified | P0 |
| No storage adapter tests | Backend switching unverified | P0 |
| No auth enforcement test | Admin access control unverified | P0 |
| No error path tests | Wrong key, expired transfer, invalid token | P1 |
| No concurrency tests | Race conditions in transfer state | P1 |
| No performance baseline | No latency/throughput benchmarks | P2 |

### 3.3 Test Infrastructure Needed

| Component | Purpose | Priority |
|---|---|---|
| Playwright setup (browser install, config) | E2E tests | P1 |
| LocalStack in CI (docker-compose service) | S3 integration tests | P1 |
| Test fixture: sample files (1KB, 1MB, 5MB) | Upload/download tests | P0 |
| Test fixture: known encryption key + ciphertext | Decryption verification | P0 |
| Smoke test script (reusable across targets) | Post-deploy validation | P0 |
| Fresh virtualenv creation in CI | Post-publish tests | P1 |

---

## 4. Testing Strategy

### 4.1 No-Mocks Principle

Per Conductor directive, ALL tests use real implementations:
- Unit tests: in-memory Memory-FS backend (real storage, real business logic)
- Integration tests: LocalStack for S3 (real S3 API, fake infrastructure)
- E2E tests: real browser via Playwright, real running app
- Smoke tests: real deployed infrastructure

**The only "fake" is LocalStack** — which provides a real S3 API backed by local storage. This is explicitly allowed by the Conductor.

### 4.2 Test Data Strategy

- **Encryption tests:** Generate known key, encrypt known plaintext, verify ciphertext matches expected. Then decrypt and verify round-trip.
- **Transfer tests:** Upload a small text file, retrieve it, verify byte-for-byte match.
- **File size tests:** Test at 1KB (tiny), 1MB (typical), 5MB (near Lambda limit).
- **Error tests:** Wrong key, expired transfer, revoked token, missing transfer.

### 4.3 Recommended Test File Structure

```
tests/
  unit/
    utils/                          # Existing
    lambda__admin/                  # Existing
    lambda__user/                   # To create (mirrors admin structure)
    core/
      test__transfers.py            # Transfer lifecycle
      test__tokens.py               # Token CRUD
      test__storage_adapters.py     # Memory, Disk, S3 backends
      test__encryption.py           # Client-side encrypt/decrypt simulation
      test__action_logging.py       # Event file creation
      test__privacy.py              # IP hashing, anonymisation
  integration/
    test__transfer_cycle__memory.py
    test__transfer_cycle__disk.py
    test__transfer_cycle__s3.py     # Requires LocalStack
    test__cli__memory.py
    test__cli__disk.py
  e2e/
    test__upload_dragdrop.py
    test__upload_filepicker.py
    test__full_transfer_cycle.py
    test__wrong_key_error.py
    test__transparency_panel.py
    test__mobile_layout.py
    test__admin_auth.py
  smoke/
    smoke_test.py                   # Reusable across all deployment targets
  post_publish/
    test__clean_install.py
```

---

## 5. Priority Sequence

1. **P0 — This week:** Unit tests for transfer workflow, storage adapters, auth enforcement. Smoke test script.
2. **P1 — Next week:** LocalStack integration tests, Playwright setup, E2E tests for full transfer cycle.
3. **P2 — Following week:** All deployment smoke tests, post-publish tests, mobile testing, performance baselines.

---

## 6. Action Items for QA

- [ ] Create test fixture files (1KB, 1MB, 5MB sample files) (P0)
- [ ] Write transfer lifecycle unit tests (P0)
- [ ] Write storage adapter unit tests (memory, disk) (P0)
- [ ] Write auth enforcement test for admin Lambda (P0)
- [ ] Create reusable smoke test script (P0)
- [ ] Set up Playwright in the project (P1)
- [ ] Write E2E test: full transfer cycle (P1)
- [ ] Write E2E test: wrong key error (P1)
- [ ] Add LocalStack to CI docker-compose (P1)
- [ ] Write S3 integration tests via LocalStack (P1)
- [ ] Write post-publish smoke test (P1)
- [ ] Write E2E tests: transparency panel, mobile, admin (P2)
- [ ] Establish performance baselines (P2)

---

*This review is the QA master file for the v0.1.4 infrastructure brief response.*
