# v0.2.24 -- QA Status Report: Post-Launch Assessment

**Version:** v0.2.24
**Date:** 13 Feb 2026
**Role:** QA
**System:** SGraph Send -- live at send.sgraph.ai

---

## 1. Executive Summary

SGraph Send is live with 56 unit tests passing in ~2.4s, plus 11 integration smoke tests for local servers. The original QA estimate (v0.2.1 review, 10 Feb) projected 55-80+ tests needed. We have hit 56 unit tests -- but the composition differs from what was projected. Core transfer workflow and schema coverage is strong. The critical gaps are around **access token auth edge cases**, **storage failure handling**, and **browser-level E2E tests** -- all of which matter significantly more now that the system is live and public.

---

## 2. Current Test Inventory

### 2.1 Unit Tests (56 tests, ~2.4s)

| Test File | Tests | What It Covers |
|---|---|---|
| `test_Version.py` | 3 | Version file path and value |
| `test_Fast_API__SGraph__App__Send__Admin.py` | 3 | Admin FastAPI init, auth enforcement, route registration |
| `test__App_Send__UI__Admin__static_pages.py` | 2 | Admin static page serving, redirects |
| `test_lambda_handler__admin.py` | 2 | Admin Lambda handler (bad event, health via Mangum) |
| `test_Schema__Transfer.py` | 6 | All 5 transfer schemas default values and Type_Safe conformance |
| `test_Transfer__Service.py` | 12 | Full service lifecycle: create, upload, complete, info, download, IP hashing, download count, error paths |
| `test_Routes__Transfers.py` | 9 | Full API lifecycle via TestClient: CRUD + not-found errors + full flow with download count |
| `test_Fast_API__SGraph__App__Send__User.py` | 3 | User FastAPI init, health (no auth), route registration |
| `test_lambda_handler__user.py` | 2 | User Lambda handler (bad event, health via Mangum) |
| `test_Send__Config.py` | 6 | Storage mode detection, memory backend creation, AWS credential check, functional storage ops |
| `test__App_Send__UI__User__static_pages.py` | 8 | Static page serving, redirects, crypto.js availability check, Web Component presence, test files served |

### 2.2 Integration Tests (11 tests, separate run)

| Test File | Tests | What It Covers |
|---|---|---|
| `test_Smoke__Local_Servers.py` | 11 | Both servers via uvicorn: user anonymous access (health, docs, openapi, send page), admin auth enforcement (rejected without key, accepted with header, accepted with cookie, rejected with wrong key, docs, console redirect) |

### 2.3 Total: 67 tests (56 unit + 11 integration)

---

## 3. What Is Well-Covered

These areas have solid test coverage and can be considered reliable:

**Transfer lifecycle (strong):** 12 service-level tests + 9 route-level tests cover create, upload, complete, info, and download. Both happy paths and key error paths (not found, not completed, no payload) are tested. Download count incrementation is verified. Full end-to-end flow tested at both service and API layers.

**Schema validation (solid):** All 5 transfer schemas verified for correct defaults and Type_Safe conformance. This catches regressions if schema fields change.

**Storage configuration (solid):** Memory mode defaults, explicit mode setting, AWS credential detection, backend creation, and functional read/write operations all tested. The pluggable storage architecture is validated.

**Static page serving (solid):** Both user and admin UIs verified for correct redirects, file serving, content matching, and Web Component presence. Crypto.js availability checking confirmed in upload and download components.

**Admin auth (solid):** Global API key middleware tested: rejected without key, accepted with correct key. Route registration verified. Lambda handler confirms 401 on unauthenticated requests.

**IP hashing (covered):** Deterministic SHA-256 hashing verified. Different IPs produce different hashes. Length verified at 64 hex chars.

**Lambda handlers (covered):** Both admin and user handlers tested via Mangum with Lambda V2 event format. Error handling for malformed events verified.

---

## 4. Critical Test Gaps

Ranked by risk to the live system.

### 4.1 CRITICAL -- Access Token Auth Edge Cases

**What exists:** The test setup sets `SGRAPH_SEND__ACCESS_TOKEN` env var and sends the token on every request via `fast_api__client.headers`. All route tests pass because the token is always present and correct.

**What is missing:**

| Gap | Risk | Why It Matters |
|---|---|---|
| Request with wrong token -> 401 | HIGH | Attacker with wrong token could bypass auth if check is flawed |
| Request with missing token header -> 401 | HIGH | Ensures auth is enforced, not just checked when present |
| Request with empty token string -> 401 | MEDIUM | Edge case: empty header value vs missing header |
| No env var set (local dev) -> allows all | MEDIUM | Verify the intentional open-access fallback works correctly |
| Token on info/download endpoints -> allowed without token | HIGH | Verify public endpoints remain public regardless of token config |

**Why this is critical:** The `check_access_token` function (line 22-29 in `Routes__Transfers.py`) is the sole auth gate for create/upload/complete. It is called per-route, not via middleware. A regression here exposes the upload API to the public internet.

### 4.2 HIGH -- S3 Storage Failure Scenarios

**What exists:** `test_Send__Config.py` verifies memory backend creation and functional ops. The live system uses S3 (auto-detected via `Send__Config`).

**What is missing:**

| Gap | Risk |
|---|---|
| S3 backend creation (requires LocalStack or mock-free equivalent) | S3 init failure would crash the Lambda |
| S3 read/write/exists operations | Storage ops could silently fail on S3 |
| S3 bucket name resolution (account ID + region pattern) | Wrong bucket name = data loss |
| Behaviour when S3 is unreachable mid-transfer | Upload succeeds at service layer but storage fails |
| Transfer metadata corruption (invalid JSON in S3) | Could crash info/download for all users |

### 4.3 HIGH -- Error Response Consistency

**What exists:** Not-found cases return 404. The `test_Routes__Transfers` tests verify 404 for upload-not-found, info-not-found, download-not-found.

**What is missing:**

| Gap | Risk |
|---|---|
| Complete on non-existent transfer -> 404 | Verified at service layer (returns None) but not at route layer |
| Upload to already-completed transfer -> should reject | Service checks `status != 'pending'` but no test covers this |
| Double-complete on same transfer | Could corrupt state if not idempotent |
| Malformed JSON body on create -> 422 | FastAPI should handle, but no test confirms the error shape |
| Oversized payload upload | No size enforcement exists -- this is a live vulnerability |

### 4.4 HIGH -- Large File and Payload Limits

**What exists:** Tests use small payloads (4-1024 bytes).

**What is missing:**

| Gap | Risk |
|---|---|
| Upload at Lambda payload limit (~6MB for Lambda URL) | Could silently truncate or crash |
| Upload exceeding `file_size_bytes` declared at create | Mismatch between declared and actual size not validated |
| Zero-byte upload | Edge case: empty file encryption |
| Binary payload integrity (round-trip byte-exact) | Tested at 8 bytes; need verification at MB scale |

### 4.5 MEDIUM -- Concurrent Upload Behaviour

**What exists:** All tests are sequential single-transfer flows.

**What is missing:**

| Gap | Risk |
|---|---|
| Two uploads to same transfer_id simultaneously | Race condition on metadata update |
| Many concurrent creates (transfer ID collision) | `secrets.token_hex(6)` has 2^48 space, low risk but untested |
| Download during upload (transfer in pending state) | Service rejects correctly but untested at route level under load |

### 4.6 MEDIUM -- Browser/Frontend Gaps

**What exists:** Static content tests verify Web Component tags exist in HTML, crypto.js contains `isAvailable()`, and components call `SendCrypto.isAvailable()`.

**What is missing:**

| Gap | Risk |
|---|---|
| No Playwright E2E tests | Real browser encrypt/upload/download cycle untested |
| No cross-browser Web Crypto API verification | `crypto.subtle` availability varies by context |
| LaunchList / send-access-gate form interaction | Gate component untested -- could block all users |
| send-transparency component rendering | Transparency data display untested |
| Download page with valid transfer ID | Only tests page loads, not actual download flow |

---

## 5. Comparison to Original Estimate

The v0.2.1 QA review (10 Feb) projected the following. Here is where we stand:

| Area (from v0.2.1 estimate) | Projected | Actual | Status |
|---|---|---|---|
| Unit: Version, FastAPI client, Lambda handler, static pages | 7 | 23 | EXCEEDED (admin + user lambdas, static pages, routes) |
| Unit: Transfer create/upload/download cycle | MISSING | 21 | DONE (service + routes) |
| Unit: Schema validation | MISSING | 6 | DONE |
| Unit: Storage adapters | MISSING | 6 | DONE (memory mode) |
| Unit: Auth enforcement (admin) | MISSING | 3 | PARTIALLY DONE (admin global key tested; user per-route token tested only happy path) |
| Unit: Action event logging | MISSING | 0 | STILL MISSING |
| Unit: Privacy data flow (IP hash) | MISSING | 1 | PARTIALLY DONE (hash function tested, not full anonymisation flow) |
| Integration: Full transfer cycle | MISSING | 0 | STILL MISSING (smoke tests cover server startup, not transfer cycle) |
| Integration: Multiple concurrent transfers | MISSING | 0 | STILL MISSING |
| E2E: Playwright browser tests | MISSING | 0 | STILL MISSING |
| Smoke: Post-deploy checks | MISSING | 11 | DONE (local servers; remote Lambda smoke not in repo) |

**Bottom line:** We have excellent unit coverage of the happy path. The gaps are in auth edge cases, error paths, storage failure modes, and browser-level testing -- exactly the areas that matter most for a live public system.

---

## 6. Recommended Next Tests (Priority Order)

### P0 -- Add This Week (live system protection)

**1. Access token auth edge cases (5 tests)**

Target file: `tests/unit/lambda__user/fast_api/routes/test_Routes__Transfers__auth.py`

```
test__create__missing_token__returns_401
test__create__wrong_token__returns_401
test__upload__missing_token__returns_401
test__complete__missing_token__returns_401
test__info_and_download__no_token_required
```

These require a test setup where the client does NOT send the default access token header. The existing test helper always injects the token, so a separate test class with a "bare" client is needed.

**2. Error path hardening (4 tests)**

Target file: `tests/unit/lambda__user/fast_api/routes/test_Routes__Transfers__errors.py`

```
test__complete__nonexistent_transfer__returns_404
test__upload__to_completed_transfer__returns_error
test__double_complete__is_idempotent_or_errors
test__create__malformed_body__returns_422
```

**3. Upload size mismatch (2 tests)**

Target file: `tests/unit/lambda__user/service/test_Transfer__Service__edge_cases.py`

```
test__upload__exceeds_declared_size
test__upload__zero_bytes
```

### P1 -- Add Next Week (operational confidence)

**4. S3 storage integration via LocalStack (4 tests)**

```
test__s3_backend__create_and_read
test__s3_backend__full_transfer_cycle
test__s3_bucket_name__resolved_from_env
test__s3_backend__missing_bucket__raises
```

**5. Integration: full transfer cycle via HTTP (3 tests)**

Extend `test_Smoke__Local_Servers.py`:

```
test__user__full_transfer_cycle__create_upload_complete_download
test__user__create_without_access_token__returns_401
test__user__download_nonexistent__returns_404
```

**6. Concurrent transfer safety (2 tests)**

```
test__concurrent_creates__unique_ids
test__concurrent_downloads__correct_count
```

### P2 -- Add Following Week (production maturity)

**7. Playwright E2E (4 tests)**

```
test__upload_page__loads_and_shows_dropzone
test__full_cycle__upload_encrypt_download_decrypt
test__wrong_key__shows_error_not_corrupted_file
test__access_gate__blocks_then_allows
```

**8. Post-deploy Lambda smoke tests (3 tests)**

```
test__lambda__health__returns_200
test__lambda__transfer_cycle__works_end_to_end
test__lambda__no_plaintext_in_response_headers
```

---

## 7. Quality Concerns for Live Deployment

### 7.1 No Upload Size Enforcement

The `upload_payload` method accepts any payload size. There is no validation that `len(payload_bytes)` matches or is bounded by `file_size_bytes` from the create step. A malicious client could upload arbitrarily large files, consuming S3 storage and Lambda memory. This is the most actionable security gap.

**Recommendation:** Add a size check in `Transfer__Service.upload_payload` that rejects payloads exceeding `file_size_bytes` (or a configured max like 50MB).

### 7.2 Access Token Fallback Behaviour

When `SGRAPH_SEND__ACCESS_TOKEN` env var is not set, `check_access_token` allows all requests (lines 24-25 in `Routes__Transfers.py`). This is intentional for local dev, but if the env var is accidentally unset in production, all upload endpoints become public. There is no test that verifies this fallback, and no warning log when it activates.

**Recommendation:** Add a test for the no-env-var case. Consider logging a warning at startup when no access token is configured.

### 7.3 Transfer ID Entropy

`secrets.token_hex(6)` produces 12 hex chars (48 bits of entropy). For a file-sharing service, this is on the low end -- a determined attacker could enumerate transfer IDs with ~280 trillion attempts. The existing `Transfer_Id` class and TODO comments indicate this is known and planned for upgrade to full GUID/UUID.

**Recommendation:** Not urgent but should be tracked. The 48-bit space is adequate for MVP volume but should be upgraded before significant traffic.

### 7.4 No Rate Limiting

The create endpoint has no rate limiting. Combined with the lack of size enforcement, this allows a DoS vector: flood create + upload requests to exhaust S3 storage or Lambda concurrency.

**Recommendation:** Track as a known limitation. Consider adding basic rate limiting per IP hash at the Lambda URL level (AWS WAF) or in the access token check.

### 7.5 Metadata Stored as Raw Dicts

Transfer metadata is constructed and mutated as raw `dict` objects throughout `Transfer__Service`. The numerous TODO comments in the service code confirm this is a known tech debt. The risk is subtle: a missing key or wrong type in a dict silently produces incorrect behavior, whereas `Type_Safe` classes would catch this at construction time.

**Recommendation:** Not a testing gap per se, but converting to `Type_Safe` schemas would make many of the error-path tests above unnecessary because the type system would prevent invalid states.

---

## 8. Summary Scorecard

| Area | Score | Notes |
|---|---|---|
| Transfer lifecycle (happy path) | 9/10 | Excellent coverage at service and route layers |
| Schema validation | 8/10 | All schemas tested for defaults and types |
| Storage abstraction | 7/10 | Memory mode solid; S3 mode untested |
| Auth (admin global key) | 8/10 | Tested: no key rejected, correct key accepted, wrong key rejected |
| Auth (user per-route token) | 3/10 | Only happy path tested; no edge cases |
| Error handling | 5/10 | Not-found paths covered; other error paths missing |
| UI static assets | 8/10 | Strong: pages load, components present, crypto checks verified |
| Browser E2E | 0/10 | No Playwright tests exist |
| Performance/load | 0/10 | No load or concurrency tests |
| Post-deploy validation | 6/10 | Local smoke tests exist; no remote Lambda smoke |

**Overall: 5.4/10** -- Strong foundation, but the gaps are in exactly the areas that matter for a public live system (auth edge cases, error handling, browser testing).

---

## 9. Action Items

- [ ] **P0** Write access token auth edge case tests (5 tests)
- [ ] **P0** Write error path hardening tests (4 tests)
- [ ] **P0** Add upload size enforcement + test (2 tests + code change)
- [ ] **P1** Set up LocalStack in CI and write S3 integration tests (4 tests)
- [ ] **P1** Extend smoke tests with full transfer cycle (3 tests)
- [ ] **P1** Add concurrent operation tests (2 tests)
- [ ] **P2** Set up Playwright and write initial E2E tests (4 tests)
- [ ] **P2** Create Lambda post-deploy smoke test suite (3 tests)
- [ ] **Track** Transfer ID entropy upgrade to full GUID
- [ ] **Track** Rate limiting strategy for create endpoint
- [ ] **Track** Startup warning when no access token is configured

---

*This review assesses the test suite at v0.2.24 with SGraph Send live at send.sgraph.ai. The 56 unit tests provide a strong foundation. Priority work is hardening auth and error paths for the live deployment.*
