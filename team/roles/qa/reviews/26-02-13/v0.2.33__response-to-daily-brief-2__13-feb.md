# v0.2.33 -- QA Response to Daily Brief #2 (13 Feb 2026)

**Version:** v0.2.33
**Date:** 2026-02-13
**Role:** QA (+ Sherpa tracking)
**Context:** Response to `team/humans/dinis_cruz/briefs/02/13/v0.2.32__daily-brief__2__sgraph-send-13-feb-2026.md`
**Follows:** `team/roles/qa/reviews/26-02-13/v0.2.24__response-to-daily-brief__13-feb.md` (Brief #1 response)

---

## 1. IFD Compliance Verification

### IFD is Non-Negotiable

Brief #2 is explicit: QA must verify that previous UI versions remain accessible after each new version is deployed. This section defines what IFD compliance means in testable terms, provides a checklist, and outlines automation.

### 1.1 IFD Compliance Checklist

Every UI change (admin UI, transparency panel, landing page, themes, analytics dashboard) must pass ALL of the following before merge:

| # | Check | Method | Pass Criteria |
|---|-------|--------|---------------|
| IFD-1 | New version directory created | Automated (CI) | New HTML deployed to `v{major}/v{major}.{minor}/v{major}.{minor}.{patch}/index.html` |
| IFD-2 | Previous version files untouched | Automated (CI) | `git diff` shows zero changes to any file under previous version paths |
| IFD-3 | Previous version URL reachable | Automated (Playwright) | HTTP 200 on previous version URL, content matches pre-deployment snapshot |
| IFD-4 | Version number present in page | Automated (Playwright) | `document.querySelector('[data-version]')` returns correct version string |
| IFD-5 | No hardcoded overrides | Manual review + CI grep | No `index.html` at parent path that redirects unconditionally |
| IFD-6 | Latest symlink/redirect updated | Automated (CI) | The "current" entry point resolves to the new version |
| IFD-7 | Minor version inherits from previous | Manual review | New minor version only adds/modifies what changed -- does not duplicate entire codebase |
| IFD-8 | Change has version number | Automated (CI) | Every PR that touches `*__ui__*` must include a version bump |

### 1.2 What "Rollback Capability" Means in Practice

**Definition:** At any point in time, a user or admin can access any previously deployed UI version by constructing its URL from the version number.

**URL versioning scheme:**

```
User UI:   /v0/v0.1/v0.1.0/index.html   (first release)
           /v0/v0.1/v0.1.1/index.html   (minor fix)
           /v0/v0.2/v0.2.0/index.html   (new minor version)

Admin UI:  /admin/v0/v0.1/v0.1.0/index.html
           /admin/v0/v0.1/v0.1.1/index.html
```

**Rollback is instant:** No redeployment needed. Previous version files exist on disk/S3. Just point the user to the previous URL. The "current" entry point is the only thing that needs to change.

**Rollback test scenario:**
1. Deploy v0.1.1
2. Verify v0.1.0 still serves correctly
3. Change "current" pointer back to v0.1.0
4. Verify v0.1.0 serves as the default
5. Verify v0.1.1 is still accessible at its explicit URL

### 1.3 Automating IFD Compliance Checks

**CI pipeline additions:**

```
IFD Compliance Stage (runs on every PR touching *__ui__*):
  1. Extract version from PR (must be present)
  2. Verify new version directory structure: v{M}/v{M}.{m}/v{M}.{m}.{p}/
  3. git diff --name-only on previous version paths -> must be empty
  4. Build and serve locally
  5. Playwright: fetch previous version URL -> HTTP 200
  6. Playwright: fetch new version URL -> HTTP 200
  7. Playwright: verify data-version attribute matches
  8. Report: list all accessible versions (version inventory)
```

**Playwright test suite (new):**

| Test | Description |
|------|-------------|
| `test_ifd_previous_version_accessible` | After deploying version N, version N-1 returns HTTP 200 |
| `test_ifd_version_attribute_present` | Every version page has `data-version` attribute |
| `test_ifd_no_content_mutation` | SHA-256 hash of previous version files unchanged |
| `test_ifd_rollback_pointer` | Changing "current" pointer serves the pointed-to version |

---

## 2. New Test Estimates for Brief #2 Features

### 2.1 Cache Service Core

The cache service is the central backbone for Brief #2. It must be tested thoroughly because multiple systems depend on it.

| Test | Type | Description |
|------|------|-------------|
| `test_cache_id_creation` | Unit (Python) | Creating a cache entry returns a unique cache ID |
| `test_cache_id_resolves_to_file_tree` | Unit (Python) | Cache ID maps to a folder structure in Memory-FS |
| `test_cache_hash_from_value` | Unit (Python) | A human-meaningful string produces a deterministic cache hash |
| `test_cache_hash_resolves_to_cache_id` | Unit (Python) | Cache hash correctly resolves to its associated cache ID |
| `test_cache_hash_one_way` | Unit (Python) | Cannot reverse cache hash to original value |
| `test_cache_store_json` | Unit (Python) | Store and retrieve JSON data in a cache entry |
| `test_cache_store_binary` | Unit (Python) | Store and retrieve binary data (encrypted file bytes) |
| `test_cache_store_folder_structure` | Unit (Python) | Store multiple files in a directory tree within a cache entry |
| `test_temporal_save_date_path` | Unit (Python) | Writing with temporal mode creates `year/month/day/hour` path |
| `test_temporal_latest_always_current` | Unit (Python) | Latest folder always contains the most recent version |
| `test_temporal_historical_never_overwritten` | Unit (Python) | Temporal path entries are append-only, never modified |
| `test_lets_raw_file_write` | Unit (Python) | Every event writes a file to the cache entry |
| `test_lets_aggregation_30min` | Unit (Python) | 30-minute aggregation correctly summarises raw files |
| `test_lets_aggregation_cascade_hourly` | Unit (Python) | Hourly aggregation combines 2 x 30-minute aggregations |
| `test_lets_aggregation_cascade_daily` | Unit (Python) | Daily aggregation combines 24 x hourly aggregations |
| `test_lets_incremental_only` | Unit (Python) | Re-querying only processes files since last saved aggregation |

**Cache service test count: 16**

### 2.2 Server-Side Analytics (Replacing GA)

| Test | Type | Description |
|------|------|-------------|
| `test_analytics_event_written_on_request` | Unit (Python) | Every Lambda request writes an event file to cache |
| `test_analytics_aggregation_correctness` | Unit (Python) | Aggregated counts match sum of individual event files |
| `test_analytics_cascade_integrity` | Integration | 30min -> hourly -> daily cascades produce consistent totals |
| `test_analytics_realtime_pulse` | Unit (Python) | "What's happening now?" reads latest aggregation |
| `test_analytics_per_file_view_count` | Unit (Python) | Per-file view count matches event log |
| `test_analytics_no_cookies_set` | E2E (Playwright) | Response headers contain no `Set-Cookie` |
| `test_analytics_no_client_tracking` | E2E (Playwright) | No `<script>` tags referencing analytics/tracking libraries |

**Server-side analytics test count: 7**

### 2.3 Token System with Usage Limits

| Test | Type | Description |
|------|------|-------------|
| `test_token_create_human_friendly` | Unit (Python) | Token with name `community-x` created successfully |
| `test_token_hash_resolution` | Unit (Python) | Token name -> cache hash -> cache ID -> token data |
| `test_token_usage_increment` | Unit (Python) | Using a token increments the usage count |
| `test_token_usage_limit_enforced` | Unit (Python) | Token with limit 5 rejects the 6th use |
| `test_token_usage_at_exact_limit` | Unit (Python) | The Nth use (where N=limit) is accepted, N+1 rejected |
| `test_token_concurrent_usage` | Integration | Two simultaneous uses of a token with limit 1 -- only one succeeds |
| `test_token_event_recorded` | Unit (Python) | Every token usage creates an event in the cache entry |
| `test_token_metadata_in_cache` | Unit (Python) | Cache entry contains limit, creation date, usage count |
| `test_token_list_with_usage_stats` | Unit (Python) | Admin can list all tokens with current usage vs limit |
| `test_token_analytics_dashboard` | Integration | Token usage data available in analytics aggregation |

**Token system test count: 10**

### 2.4 Local Storage Transparency Panel

| Test | Type | Description |
|------|------|-------------|
| `test_transparency_panel_shows_all_stored_items` | E2E (Playwright) | Panel lists every key in localStorage with values |
| `test_transparency_panel_displays_accurately` | E2E (Playwright) | Displayed values match actual `localStorage.getItem()` calls |
| `test_transparency_clear_function` | E2E (Playwright) | "Clear all" button empties localStorage and panel updates |
| `test_zero_storage_mode` | E2E (Playwright) | In zero-storage mode, `localStorage.length === 0` after full flow |
| `test_optional_key_caching` | E2E (Playwright) | User can toggle encryption key caching on/off |

**Transparency panel test count: 5**

### 2.5 GA Removal Verification

| Test | Type | Description |
|------|------|-------------|
| `test_no_ga_script_loaded` | E2E (Playwright) | No `<script>` with `googletagmanager` or `google-analytics` in DOM |
| `test_no_cookies_set` | E2E (Playwright) | After full page load, `document.cookie` is empty |
| `test_no_third_party_requests` | E2E (Playwright) | Network requests only go to `*.sgraph.ai` domains |
| `test_cookie_policy_page_accurate` | E2E (Playwright) | Policy page states "no cookies" (when implemented) |

**GA removal test count: 4**

### 2.6 Admin UI Modular Architecture

| Test | Type | Description |
|------|------|-------------|
| `test_module_dynamic_loading` | E2E (Playwright) | Admin modules load on demand, not all at page load |
| `test_module_event_propagation` | E2E (Playwright) | Event fired in module A is received by module B |
| `test_module_isolation` | E2E (Playwright) | Module failure does not crash the shell |
| `test_admin_layout_renders` | E2E (Playwright) | Admin UI shell renders with navigation and module area |

**Admin UI test count: 4**

### 2.7 AWS Cost Data

| Test | Type | Description |
|------|------|-------------|
| `test_cost_data_collection` | Unit (Python) | Cost collector retrieves and stores data in cache |
| `test_cost_aggregation_daily` | Unit (Python) | Daily cost correctly sums hourly entries |
| `test_cost_correlation_with_traffic` | Unit (Python) | Cost-per-request calculation matches manual computation |

**AWS cost test count: 3**

---

## 3. Updated Test Count Summary

### Brief #2 New Tests

| Area | New Tests |
|------|-----------|
| Cache service core | 16 |
| Server-side analytics | 7 |
| Token system (usage limits) | 10 |
| Transparency panel | 5 |
| GA removal verification | 4 |
| Admin UI modular architecture | 4 |
| AWS cost data | 3 |
| IFD compliance (Playwright) | 4 |
| **Brief #2 subtotal** | **53** |

### Combined Totals (Brief #1 + Brief #2)

| Area | Tests | Source |
|------|-------|--------|
| Existing transfer lifecycle | ~56 | Baseline |
| Brief #1: Hash-fragment URLs | 6 | Brief #1 QA response |
| Brief #1: Text input | 6 | Brief #1 QA response |
| Brief #1: Admin tokens (basic) | 8 | Brief #1 QA response |
| Brief #1: i18n | 5 | Brief #1 QA response |
| Brief #1: Themes | 5 | Brief #1 QA response |
| Brief #1: Email sharing | 3 | Brief #1 QA response |
| Brief #1: Event data UI | 2 | Brief #1 QA response |
| Brief #2: Cache service core | 16 | This document |
| Brief #2: Server-side analytics | 7 | This document |
| Brief #2: Token system (expanded) | 10 | This document |
| Brief #2: Transparency panel | 5 | This document |
| Brief #2: GA removal | 4 | This document |
| Brief #2: Admin UI modular | 4 | This document |
| Brief #2: AWS cost data | 3 | This document |
| Brief #2: IFD compliance | 4 | This document |
| **Grand total** | **~144** | |

**Note on Brief #1 overlap:** The 8 admin token tests from Brief #1 are basic CRUD/lifecycle tests. The 10 token tests from Brief #2 focus on the new cache-hash resolution and usage-limit behaviour. There is minimal overlap -- Brief #2 expands the token system significantly. Some Brief #1 token tests (e.g. `test_token_create`, `test_token_lifecycle`) may be superseded by the cache-based equivalents, but both sets should be maintained until migration is confirmed.

---

## 4. Regression Risk Assessment

### 4.1 Cache Service as Single Point of Failure

**Risk level: HIGH**

The cache service is the most significant new infrastructure component. Brief #2 explicitly states it underpins:
- File storage
- Token management
- Site analytics
- Event logging
- AWS cost tracking

A regression in the cache service could cascade across ALL of these systems.

**Specific risks:**

| Risk | Affected Systems | Severity | Mitigation |
|------|-----------------|----------|------------|
| Cache ID collision | All systems | Critical | Verify ID uniqueness in tests; use cryptographic randomness |
| Cache hash collision | Token resolution | High | Test with known collision-prone inputs; document hash algorithm |
| Temporal path race condition | Analytics, cost data | High | Test concurrent writes to same temporal path |
| LETS aggregation data loss | Analytics dashboards | High | Test aggregation with missing intermediate files |
| Memory-FS backend switch | All systems | High | Run full cache test suite against both in-memory and S3 backends |

### 4.2 GA Removal Regression

**Risk level: MEDIUM**

Removing Google Analytics is straightforward, but the risk is in incomplete removal:
- Leftover `<script>` tags in older IFD versions (IFD means old versions persist)
- Hardcoded GA initialisation in JavaScript modules
- Cookie artifacts left behind from previous GA sessions

**Mitigation:** The GA removal verification tests (Section 2.5) explicitly check for absence of GA artifacts. The `test_no_third_party_requests` test is the strongest guarantee -- it fails if any request goes to a non-sgraph.ai domain.

**IFD consideration:** Previous UI versions that included GA will still contain the GA script tags. This is acceptable under IFD -- those versions represent the state of the product at that point in time. New versions must not include GA. QA should verify that the "current" version pointer always resolves to a GA-free version.

### 4.3 Token System Migration Risk

**Risk level: MEDIUM**

Brief #1 defined tokens with simple GUID-based storage. Brief #2 introduces cache-hash resolution with human-friendly names. The migration path is:

1. Brief #1 tokens: `/tokens/{token_id}/token.json`
2. Brief #2 tokens: cache hash(token_name) -> cache ID -> `/cache/{cache_id}/...`

**Risk:** Existing tokens created under Brief #1 schema will not be findable via cache hash lookup.

**Mitigation:** Either (a) migrate existing tokens into cache entries, or (b) maintain a fallback lookup path. QA must test both the new path and any legacy compatibility.

### 4.4 Existing Transfer Lifecycle

**Risk level: LOW**

The cache service sits alongside the existing transfer flow, not replacing it (yet). The transfer lifecycle tests (~56 existing) should continue to pass without modification. If the cache service is integrated into the transfer flow, re-run the full suite against the cache-backed storage.

---

## 5. Sherpa (UX Tracking) Assignments from Brief #2

Brief #2 assigns the Sherpa role to track:

### 5.1 Sharing Method Preferences

| Metric | How to Track | Data Source |
|--------|-------------|-------------|
| Copy-link usage | Count clicks on "Copy Link" button | Application event log |
| Copy-as-text usage | Count clicks on "Copy as Text" button | Application event log |
| Gmail link usage | Count clicks on "Open in Gmail" button | Application event log |
| Drag-and-drop usage | Count drag events on download link | Client-side event (if cached locally) |

**Note:** With GA removed, all sharing method tracking must come from server-side events or locally cached data exposed via the transparency panel. The user must opt in to local tracking.

### 5.2 Trail Data Across Themes

| Metric | How to Track | Data Source |
|--------|-------------|-------------|
| Theme selection | Count theme switches per session | Transparency panel / local storage |
| Theme-specific friction points | Compare error rates per theme | Server-side analytics (user-agent correlation, not theme-specific -- server does not know the theme) |
| Accessibility theme adoption | Count users on Dark/High-Contrast themes | Local storage preference data (opt-in) |

**Important limitation:** The server does not know which theme the user is using (client-side only, no cookies). Theme analytics depend on either (a) opt-in local storage reporting, or (b) the user choosing to include theme preference in a feedback mechanism. The Sherpa cannot track theme data from server-side analytics alone.

---

## 6. Testing Priorities (Brief #2)

### Immediate (with cache service implementation)

| Priority | Tests | Rationale |
|----------|-------|-----------|
| P1 | Cache service core (16 tests) | Everything depends on this -- must be solid before anything builds on it |
| P1 | GA removal verification (4 tests) | No-cookie policy is non-negotiable; verify as soon as GA is removed |
| P1 | IFD compliance checks (4 tests) | IFD is non-negotiable; set up before any UI work lands |

### With feature implementation

| Priority | Tests | Rationale |
|----------|-------|-----------|
| P2 | Token system usage limits (10 tests) | Second most critical after cache; commercial model foundation |
| P2 | Server-side analytics (7 tests) | GA replacement must prove correct before GA is removed |
| P2 | Transparency panel (5 tests) | Trust feature for privacy-conscious users |

### After infrastructure stable

| Priority | Tests | Rationale |
|----------|-------|-----------|
| P3 | Admin UI modular architecture (4 tests) | Internal tool; lower risk |
| P3 | AWS cost data (3 tests) | Nice-to-have analytics; not user-facing |

---

## 7. Summary: QA Actions from Brief #2

| # | Action | Priority | Status |
|---|--------|----------|--------|
| 1 | Define and publish IFD compliance checklist | P1 | **Done above** |
| 2 | Design IFD Playwright test suite | P1 | **Done above** |
| 3 | Specify cache service test matrix (16 tests) | P1 | **Done above** |
| 4 | Specify GA removal verification tests (4 tests) | P1 | **Done above** |
| 5 | Specify token system usage-limit tests (10 tests) | P2 | **Done above** |
| 6 | Specify server-side analytics tests (7 tests) | P2 | **Done above** |
| 7 | Specify transparency panel tests (5 tests) | P2 | **Done above** |
| 8 | Specify admin UI modular tests (4 tests) | P3 | **Done above** |
| 9 | Specify AWS cost data tests (3 tests) | P3 | **Done above** |
| 10 | Regression risk assessment for cache service | P1 | **Done above** |
| 11 | Define Sherpa tracking metrics for sharing methods and themes | P2 | **Done above** |
| 12 | Write IFD CI pipeline stage definition | P1 | Next session |
| 13 | Implement IFD Playwright tests | P1 | Blocked on first IFD-compliant UI deployment |
| 14 | Implement cache service unit tests | P1 | Blocked on cache service implementation by Dev |
| 15 | Continue Brief #1 test work (35 tests) | Active | In progress |

---

## 8. Open Questions for Conductor

1. **IFD enforcement scope:** Does IFD apply retroactively to the existing UI versions (v0.1.0 etc.), or only from this brief forward? If retroactive, we need to audit existing version paths.

2. **Theme tracking without cookies:** The Sherpa cannot track theme usage from the server side. Do we accept this limitation, or do we add an opt-in mechanism where the user can report their theme preference?

3. **Cache service test environment:** Should cache service tests run against in-memory only, or also against LocalStack S3? This affects CI pipeline duration.

4. **GA in old IFD versions:** Older UI versions will still contain GA script tags. Is this acceptable, or must we strip GA from historical versions (which would violate IFD's "never modify previous versions" principle)?
