# Dev + QA Briefing (UI) — MVP Review Response

**From:** Conductor (on behalf of Dinis Cruz)
**To:** Dev (Frontend) + QA
**Date:** 12/02/2026
**Version:** v0.2.15
**Source:** `team/humans/dinis_cruz/briefs/02/12/v0.2.10__review-of-user-site-mvp.md`

---

## Context

The MVP UI worked end-to-end on Lambda (confirmed with screenshots). However, there's a critical bug when running locally, and several testing improvements needed.

---

## Tasks

### TASK-1: Investigate and Fix Local Crypto Bug (CRITICAL)

**Priority:** Critical
**Status:** Open

**Bug:** After dropping a file on the upload page and clicking "Encrypt & Upload", the error is:
```
Cannot read properties of undefined (reading 'generateKey')
```

**Details from Dinis:**
- No error in console
- No network traffic occurs after clicking the button
- The same browser (different tab) works fine on the Lambda Function URL
- This means `window.crypto.subtle` is likely `undefined` in the local context

**Root cause hypothesis:** `crypto.subtle` is only available in secure contexts (HTTPS or localhost). If the local dev server runs on `127.0.0.1` instead of `localhost`, or on a non-standard port without HTTPS, `crypto.subtle` will be undefined.

**Action items:**
1. Investigate the exact cause — is the local server serving on `localhost` vs `127.0.0.1`?
2. Add a clear error message when `crypto.subtle` is unavailable: "Web Crypto API requires a secure context (HTTPS or localhost)"
3. Ensure local dev server configuration uses `localhost` (not `127.0.0.1`)
4. Document the secure context requirement

**QA angle:** This is a critical error that should be caught by testing. We need:
- A check in the upload component that detects `crypto.subtle` availability before attempting encryption
- A clear, user-facing error message explaining the requirement
- A test that verifies this error handling

### TASK-2: Add Test Files for QA Workflow

**Priority:** High

**User story:** "As QA I should be able to easily replicate the file upload without needing to actually upload or drop a file"

**Proposed workflow:**
1. Add download links on the upload page for test files (image, text file, zip)
2. QA clicks a link → browser downloads the file → shows in Chrome's download bar
3. QA drags the downloaded file from the Chrome download bar into the drop zone
4. This provides a repeatable, no-setup testing workflow

**Files to create:**
- `sgraph_ai_app_send__ui__user/v0/v0.1/v0.1.0/test-files/test-image.png` — small test image
- `sgraph_ai_app_send__ui__user/v0/v0.1/v0.1.0/test-files/test-text.txt` — small text file
- `sgraph_ai_app_send__ui__user/v0/v0.1/v0.1.0/test-files/test-archive.zip` — small zip file

**UI changes:**
- Add a "Test files" section on the upload page (visible in dev/test mode or always visible during MVP)
- Links to download each test file
- Clear instructions: "Download a test file, then drag it into the upload zone above"

### TASK-3: Detect and Test Crypto Availability

**Priority:** High
**QA concern:** "This is a critical error, and we need to look at how can we detect this via testing"

**Testing approach:**
1. **Unit test** (in-browser or jsdom): Mock `window.crypto.subtle` as undefined and verify the component shows an appropriate error
2. **Integration test**: Start local server, load upload page, verify crypto availability is checked before any encryption attempt
3. **Smoke test**: Add to the existing smoke test suite — GET the upload page, verify it loads without errors

### TASK-4: Multi-Instance Awareness

**Priority:** Low (informational, will be fixed by Memory-FS S3 integration)

**Current limitation:** Upload and download must hit the same Lambda instance because data is in-memory. This is by design and will be resolved when Memory-FS S3 storage is integrated.

**No action needed now** — but the UI should eventually show a message if a download fails because the transfer isn't found (already handled by the download component's error state).

---

## Deliverables

1. Bug fix for local crypto issue (or documented workaround)
2. Test files added to UI assets
3. "Test files" UI section on upload page
4. Crypto availability check in `send-upload.js` and `send-download.js`
5. Updated/new tests covering crypto unavailability scenario
6. Review document: `team/roles/qa/reviews/26-02-12/v0.2.15__ui-testing-improvements.md`
7. Issues in `team/roles/qa/.issues/` for tracking

---

## Files to Modify/Create

| File | Action | Purpose |
|---|---|---|
| `send-upload.js` | Modify | Add crypto.subtle availability check |
| `send-download.js` | Modify | Add crypto.subtle availability check |
| `crypto.js` | Modify | Add `isAvailable()` check method |
| `index.html` | Modify | Add test files section |
| `test-files/*` | Create | QA test files |
| Tests | Create/Modify | Crypto unavailability tests |
