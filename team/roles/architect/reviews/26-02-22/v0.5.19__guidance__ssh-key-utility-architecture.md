# Architect Guidance: SSH Key Utility — Architecture

**version** v0.5.19
**date** 22 Feb 2026
**role** Architect
**team** Explorer
**type** Guidance — architecture for SSH key generator utility
**input** [v0.5.10 brief](../../../../humans/dinis_cruz/briefs/02/21/part-3/v0.5.10__brief__ssh-key-utility-and-marketing-campaign.md), [Ambassador SEO research](../../../ambassador/reviews/26-02-22/v0.5.19__research__ssh-key-utility-seo-and-competition.md)

---

## Architectural Position

This utility is **architecturally simple by design**. It is a static page with zero server interaction. The architecture decision here is about **placement, isolation, and trust model** — not about backend complexity.

### Key Architectural Properties

| Property | Value | Rationale |
|----------|-------|-----------|
| Server interaction | **Zero** | No API calls after page load. Works offline. |
| Authentication | **None** (user Lambda), **Admin key** (admin Lambda) | Public-facing utility. No user data to protect. |
| Data persistence | **None** | Keys exist only in browser memory until user copies/downloads. |
| Backend code | **None** | No Python. No routes. No storage. Static file serving only. |
| Crypto dependency | **Web Crypto API** or **pure JS** | See crypto strategy below. |

---

## Deployment Architecture

### Two Mount Points, One Codebase

The brief specifies deployment to both Lambdas. The architecture is straightforward:

```
User Lambda (send.sgraph.ai)
  └─ /send/tools/ssh-keygen/index.html    ← anonymous, public

Admin Lambda (admin.send.sgraph.ai)
  └─ /admin/tools/ssh-keygen.html         ← behind admin auth
```

**Both serve the exact same static files.** No code duplication. The HTML/JS/CSS lives in one location and is mounted into both UI asset directories.

### Recommended File Layout

```
sgraph_ai_app_send__ui__user/
  tools/
    ssh-keygen/
      v0/
        v0.1/
          v0.1.0/
            index.html              ← single-page app
            js/
              ssh-keygen.js         ← Web Component
              ssh-crypto.js         ← key generation + format conversion
            css/
              ssh-keygen.css        ← page-specific styles (imports design system)

sgraph_ai_app_send__ui__admin/
  tools/
    ssh-keygen.html                 ← symlink or copy pointing to user version
```

**IFD versioning applies.** Start at `v0.1.0`. The `tools/` namespace separates utility pages from the core send/download workflow. Future utilities (password generator, certificate inspector, etc.) live under `tools/` too.

### URL Structure

| URL | Served by | Access |
|-----|-----------|--------|
| `send.sgraph.ai/send/tools/ssh-keygen/v0/v0.1/v0.1.0/index.html` | User Lambda static mount | Anonymous |
| `send.sgraph.ai/tools/ssh-keygen` | Redirect route (new) | Anonymous |
| `admin.send.sgraph.ai/admin/tools/ssh-keygen.html` | Admin Lambda static mount | Admin auth |

The redirect route (`/tools/ssh-keygen` → latest version) follows the existing pattern in `Fast_API__SGraph__App__Send__User.setup_static_routes()`. This is the canonical URL for SEO.

---

## Crypto Strategy

### Option A: Web Crypto API + Format Conversion (Recommended)

Use `crypto.subtle.generateKey()` for key generation, then convert from SPKI/PKCS8 to OpenSSH format in JavaScript.

**Pros:**
- Uses the same API as the rest of SG/Send (brand consistency: "powered by Web Crypto API")
- Hardware-backed RNG via `crypto.getRandomValues()`
- No external dependencies

**Cons:**
- Ed25519 support in Web Crypto is relatively recent (Chrome 113+, Firefox 130+, Safari 17+)
- Format conversion from SPKI/PKCS8 to OpenSSH is non-trivial (~200-300 lines of JS)
- ECDSA P-256 is available, but ECDSA SSH keys are uncommon

### Option B: TweetNaCl (Pure JS)

Use `tweetnacl` for Ed25519 key generation, custom implementation for RSA.

**Pros:**
- Well-audited, minimal library (~20KB)
- Direct control over key bytes — easier OpenSSH format generation
- Works in all browsers regardless of Web Crypto Ed25519 support

**Cons:**
- External dependency (violates zero-dependency principle for user Lambda)
- Software RNG instead of hardware-backed (still uses `crypto.getRandomValues()` for seeding)

### Recommendation: Option A (Web Crypto) with Fallback Detection

Use Web Crypto API for all key generation. If Ed25519 is not available in the user's browser, show a clear message explaining why and suggest RSA 4096 as alternative. This maintains the zero-dependency principle and aligns with the SG/Send brand.

**Browser support gate:**
```javascript
// Feature detection for Ed25519
async function supportsEd25519() {
    try {
        const key = await crypto.subtle.generateKey('Ed25519', true, ['sign', 'verify'])
        return true
    } catch { return false }
}
```

If Ed25519 is unsupported, the UI disables the Ed25519 radio button with a tooltip: "Your browser doesn't support Ed25519. Use RSA 4096 or update your browser."

---

## OpenSSH Format Conversion

This is the most technically complex part. The page must output keys in the exact format that `ssh-keygen` produces, or users will get confusing errors when they try to use them.

### Public Key Format

```
ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAA{base64-encoded-key} comment
```

Structure: `[algorithm-name] [base64(type-length-prefixed algorithm name + raw public key)] [comment]`

The wire format inside the base64 is:
```
uint32  length of algorithm name
string  "ssh-ed25519"
uint32  length of public key
bytes   raw public key (32 bytes for Ed25519)
```

### Private Key Format (OpenSSH)

The OpenSSH private key format (`-----BEGIN OPENSSH PRIVATE KEY-----`) is more complex:

```
"openssh-key-v1\0"               magic bytes
string    cipher name             "none" (no passphrase)
string    KDF name                "none"
string    KDF options             empty
uint32    number of keys          1
string    public key (wire format)
string    encrypted section:
  uint32  check1 (random)
  uint32  check2 (same as check1)
  string  key type ("ssh-ed25519")
  string  public key (raw)
  string  private key (raw, 64 bytes for Ed25519)
  string  comment
  padding (1, 2, 3, 4, ... to align to block size)
```

### Implementation Guidance

1. Create `ssh-crypto.js` with functions: `generateEd25519()`, `generateRSA()`, `formatPublicKey()`, `formatPrivateKey()`
2. Each function returns `{ publicKey: string, privateKey: string }` in OpenSSH format
3. Use `DataView` and `ArrayBuffer` for binary format assembly — avoid string concatenation for binary data
4. Test the output by importing generated keys with `ssh-keygen -l -f` and `ssh-keygen -y -f` (acceptance criteria: round-trip must succeed)

---

## Security Architecture

### Threat Model

| Threat | Mitigation | Owner |
|--------|-----------|-------|
| Page compromise serving weak keys | SRI hashes on all script tags. Service Worker integrity verification (v0.4.12 model). Open source for auditability. | AppSec |
| Key exfiltration via modified page | CSP header: `connect-src 'none'` — prevents all outbound network from the page. `form-action 'none'`. | DevOps |
| Keys persisted in browser storage | Page must NOT use localStorage, sessionStorage, or IndexedDB. Keys exist only in DOM/JS memory. Clear on page unload. | Dev |
| Clipboard snooping | Standard browser clipboard API. No mitigation possible — this is a user-device risk, not our risk. | N/A |

### Content Security Policy (Specific to This Page)

```
Content-Security-Policy:
  default-src 'self';
  script-src 'self';
  style-src 'self' https://fonts.googleapis.com;
  font-src https://fonts.gstatic.com;
  connect-src 'none';
  form-action 'none';
  frame-ancestors 'none';
```

The `connect-src 'none'` is the critical directive. It guarantees — at browser level — that the page cannot make any network requests after loading. This is a stronger guarantee than "we promise not to send your keys" — the browser enforces it.

---

## Integration Points

### With Main SG/Send Application

- **CTA link** at bottom of page: "Need to send files securely? Try SG/Send" → links to `/send/` (main upload page)
- **Shared design system**: imports `sg-design-system.css` from `v0.1.6` — same look and feel as the main app
- **Shared header**: same SG/Send branding, GitHub link, docs link. No locale selector needed (this page doesn't need i18n initially)

### With SEO Strategy

- **Canonical URL**: `<link rel="canonical" href="https://send.sgraph.ai/tools/ssh-keygen">`
- **JSON-LD structured data**: `SoftwareApplication` schema with `applicationCategory: "DeveloperApplication"`
- **Clean URL**: redirect route provides the short URL (`/tools/ssh-keygen`) for external linking

### With Future Utilities

The `/tools/` namespace is intentionally generic. Planned future utilities:
- `/tools/password-generator` — password/passphrase generation
- `/tools/cert-inspector` — X.509 certificate viewer
- `/tools/base64` — encode/decode utility

Each follows the same pattern: static page, zero server interaction, Web Crypto where applicable, same design system.

---

## Decisions for Dev

| # | Decision | Rationale |
|---|----------|-----------|
| 1 | Use Web Crypto API, not external libraries | Zero-dependency principle. Brand alignment. |
| 2 | IFD versioned path under `tools/ssh-keygen/` | Separates utilities from core workflow. Follows existing versioning. |
| 3 | `connect-src 'none'` CSP | Browser-enforced guarantee that keys never leave the page. |
| 4 | OpenSSH format output only | Users expect `ssh-keygen` compatible output. No other format needed. |
| 5 | Ed25519 default, RSA 4096 fallback, ECDSA optional | Matches brief. Ed25519 is modern default. RSA for older systems. |
| 6 | Feature detection for Ed25519 | Graceful degradation for older browsers. |
| 7 | No localStorage/sessionStorage/IndexedDB | Keys must not persist in browser storage. |

---

## Open Questions

| # | Question | For |
|---|----------|-----|
| 1 | Should the redirect route (`/tools/ssh-keygen`) be a new route class or added to the existing static routes setup? | Dev |
| 2 | Should the admin version be a symlink or a copy of the same files? | DevOps |
| 3 | Do we need passphrase-protected private keys in v0.1.0? | Product (brief says no — confirm) |
| 4 | Should the page include a fingerprint display (SHA256 hash of public key)? | Designer/Dev |

---

*Explorer Architect — SSH Key Utility Architecture Guidance — 22 Feb 2026*
