# v0.2.33 — Architect Review: Server/Admin Features — Next Sprint

**Version:** v0.2.33
**Date:** 13 February 2026
**Role:** Architect
**Context:** Review of Daily Briefs #1 and #2 server/admin tasks, requested by project lead
**Focus:** Server-side and admin features — what exists, what's designed, what to build next
**Follows:** [Cache Service Schema (Daily Brief #2 Response)](v0.2.33__response-to-daily-brief-2__13-feb.md) | [Daily Brief #1 Response](v0.2.24__response-to-daily-brief__13-feb.md)

---

## Executive Summary

The project lead asked: "What is the next area to tackle on server/admin features?" This review answers that question by auditing the current backend, mapping every server/admin task from both daily briefs against what exists, and recommending an implementation sequence for the next sprint.

**The answer: the cache service is the gating item.** Almost every server/admin feature in both briefs depends on it — token management, site analytics, cost tracking, per-file event dashboards. The admin Lambda and UI are scaffolded but empty. Once the cache service core is operational, the admin features cascade rapidly.

---

## 1. Current Backend State

### 1.1 What Exists and Works

| Component | Status | Location | Notes |
|-----------|--------|----------|-------|
| **Transfer Service** | Working, shipped | `lambda__user/service/Transfer__Service.py` (138 lines) | Full lifecycle: create → upload → complete → download. IP hashing, transparency logging. 70+ TODOs for Type_Safe migration. |
| **Transfer Routes** | Working, shipped | `lambda__user/fast_api/routes/Routes__Transfers.py` (102 lines) | 5 REST endpoints. Per-route access token check. |
| **Storage Config** | Working, shipped | `lambda__user/storage/Send__Config.py` (63 lines) | Auto-detects Memory vs S3 backend. |
| **S3 Backend** | Working, shipped | `lambda__user/storage/Storage_FS__S3.py` (97 lines) | S3 storage through Memory-FS abstraction. |
| **User FastAPI App** | Working, shipped | `lambda__user/fast_api/Fast_API__SGraph__App__Send.py` | Serves routes, static UI, health check. |
| **Admin FastAPI App** | Scaffolded, placeholder | `lambda__admin/fast_api/Fast_API__SGraph__App__Send__Admin.py` (48 lines) | Health check + Routes__Info only. Static file serving for admin UI v0.1.0. |
| **Admin UI** | Placeholder | `sgraph_ai_app_send__ui__admin/v0/v0.1/v0.1.0/index.html` | Contains "this is the admin ui code". |
| **Admin Deploy** | Working | `lambda__admin/lambda_function/deploy/Deploy__Service.py` | Lambda deployment tooling. |
| **CI/CD** | Working | `.github/workflows/ci-pipeline__dev.yml` | Test → tag → publish to PyPI. |

### 1.2 What's Designed but Not Built

| Component | Design Document | Status |
|-----------|----------------|--------|
| **Cache Service** | [Architect Brief #2 Response](v0.2.33__response-to-daily-brief-2__13-feb.md) | Fully specified: 4 schemas (A-D), Type_Safe classes, file tree layouts, LETS pipeline, 7 decisions (D024-D030). Ready for implementation. |
| **Token System** | Same document, Schema B | Cache-hash resolution, human-friendly names, usage limits, lifecycle flow, admin dashboard endpoints. |
| **Site Analytics** | Same document, Schema A | Raw event recording, LETS aggregation cascade, pulse endpoint, GA replacement. |
| **Cost Tracking** | Same document, Schema C | AWS Cost Explorer collection, daily/weekly/monthly aggregation, unit economics. |
| **Transfer Event Cache** | Same document, Schema D | Dual-write pattern, per-file analytics, cross-transfer aggregations. |
| **Admin UI (modular)** | Brief #2, IFD methodology | Event-driven module loading, dashboards, token management panels. Not yet designed in detail. |

### 1.3 What's Missing (No Design Yet)

| Gap | Source Brief | Recommendation |
|-----|-------------|----------------|
| **Admin token creation/sharing endpoints** | Brief #1 | Needs REST API design (POST /tokens/create, GET /tokens, GET /tokens/{name}). Straightforward once cache service exists. |
| **Admin dashboard API endpoints** | Brief #2 | Needs endpoint design for reading aggregations, pulse, token summaries. Should be part of admin Lambda. |
| **CloudFront log ingestion** | Brief #1 + #2 | DevOps dependency. Needs log delivery enabled + collector that reads from observability S3 bucket. |
| **Local storage transparency panel** | Brief #2 | UI-only feature. No server-side component. Can proceed independently. |
| **Email sharing (copy text + Gmail link)** | Brief #1 | UI-only feature. No server-side component. Can proceed independently. |

---

## 2. Server/Admin Tasks from Both Briefs — Complete Audit

### From Daily Brief #1

| # | Task | Priority | Server-Side? | Depends On | Status |
|---|------|----------|-------------|------------|--------|
| B1-01 | Hash-fragment URL for one-click access | P1 | No (client-side) | AppSec review | **DONE** (D014 approved, shipped in v0.1.1) |
| B1-02 | Text input for sending text | P1 | No (client-side) | — | Not started |
| B1-03 | Landing page content | P2 | No (client-side) | i18n (D017) | Partially done (i18n shipped, content pending) |
| B1-04 | Fix drag-and-drop of download link | P2 | No (client-side) | — | Not started |
| B1-05 | **Admin token creation UI** | P2 | **YES** | Cache service (token schema) | Not started |
| B1-06 | **Admin token visualisation UI** | P2 | **YES** | Cache service + admin endpoints | Not started |
| B1-07 | **Admin token sharing (URL generation)** | P2 | **YES** | Cache service + token endpoints | Not started |
| B1-08 | **Backend token storage (indexed by token)** | P2 | **YES** | Cache service Schema B | Not started |
| B1-09 | **DevOps brief on AWS observability** | P1 | **YES** | — | Not started (DevOps deliverable) |
| B1-10 | **Collector pipeline (S3 data lake)** | P2 | **YES** | Cache service Schema A | Not started |
| B1-11 | **Expose file events in UI** | P2 | **YES** (API) | Cache service Schema D | Not started |
| B1-12 | i18n / translation layer | P2 | No (client-side) | — | **DONE** (shipped v0.1.2, 4 languages) |
| B1-13 | Theme system (5 themes) | P2 | No (client-side) | — | Not started |
| B1-14 | Email sharing (copy + Gmail) | P2 | No (client-side) | — | Not started |

### From Daily Brief #2

| # | Task | Priority | Server-Side? | Depends On | Status |
|---|------|----------|-------------|------------|--------|
| B2-01 | **Remove Google Analytics** | P1 | **YES** (config) | Server-side analytics pulse (B2-04) | **DONE** (GA removed in v0.1.3 session) |
| B2-02 | **Cache service core implementation** | P1 | **YES** | Architect schema (done) | Not started |
| B2-03 | **Analytics raw event recording** | P1 | **YES** | Cache service core | Not started |
| B2-04 | **LETS pipeline: pulse endpoint** | P1 | **YES** | Raw event recording | Not started |
| B2-05 | **LETS pipeline: aggregations** | P1 | **YES** | Pulse endpoint | Not started |
| B2-06 | **Human-friendly token system** | P2 | **YES** | Cache service core | Not started |
| B2-07 | **Local storage transparency panel** | P2 | No (client-side) | — | Not started |
| B2-08 | **AWS cost data collection** | P2 | **YES** | Cache service core + osbot-aws | Not started |
| B2-09 | **Modular admin UI (event-driven)** | P2 | Partial (needs API) | Admin dashboard endpoints | Not started |
| B2-10 | **IFD compliance for all UI** | P1 | No (process) | — | **IN EFFECT** (v0.1.1 → v0.1.2 → v0.1.3 all follow IFD) |

### Server-Side Task Summary

**11 server-side tasks remain unstarted.** Of those 11, **9 depend on the cache service core**. The cache service is the clear critical path.

---

## 3. Recommended Implementation Sequence

### Phase 1: Foundation (Next Session, Start Here)

| # | Task | Est. | What It Unblocks | Dinis Help Needed? |
|---|------|------|------------------|--------------------|
| **1.1** | Operational visibility: confirm Lambda logging, ship `/health/pulse` | 1-2h | Confidence that the live system is observable | No |
| **1.2** | Cache service scaffolding: `Cache__Service__Send`, namespace setup, Storage_FS wiring, hash generator integration | 2-3h | Everything below | **Yes** — reference `Cache__Service` code from `team/humans/dinis_cruz/code-example/` |
| **1.3** | Token cache: create/lookup by name, usage counting, validation | 4-6h | Token admin UI, token sharing URLs | **Possibly** — token naming conventions, initial batch |

### Phase 2: Analytics Pipeline (Same Sprint)

| # | Task | Est. | What It Unblocks |
|---|------|------|------------------|
| **2.1** | Analytics raw event recording (write one JSON file per server request) | 2-3h | Analytics pipeline |
| **2.2** | LETS pipeline: pulse computation (last 5 minutes of raw events) | 3-4h | "Is anyone using the site?" — minimum GA replacement |
| **2.3** | LETS pipeline: 30-min + hourly aggregations with cascading save | 4-6h | "How many people today?" |
| **2.4** | Transfer event integration: dual-write to transfer events + analytics raw stream | 2-3h | Per-file analytics in UI |

### Phase 3: Admin Features (Follow-on Sprint)

| # | Task | Est. | What It Unblocks |
|---|------|------|------------------|
| **3.1** | Admin REST endpoints: POST /tokens/create, GET /tokens, GET /tokens/{name} | 3-4h | Admin token UI |
| **3.2** | Admin REST endpoints: GET /analytics/pulse, GET /analytics/{window_type}/{window_key} | 3-4h | Admin dashboard |
| **3.3** | Admin UI v0.1.1: token management panel (IFD versioned) | 4-6h | Token creation + sharing workflow |
| **3.4** | Admin UI v0.1.2: analytics dashboard (IFD versioned) | 4-6h | Operational visibility dashboard |

### Phase 4: Cost + Polish (Future Sprint)

| # | Task | Est. | What It Unblocks |
|---|------|------|------------------|
| **4.1** | AWS cost collector (Cost Explorer API via osbot-aws) | 3-4h | Unit economics |
| **4.2** | Cost dashboard in admin UI | 3-4h | Financial visibility |
| **4.3** | Transfer Service Type_Safe migration (address 70+ TODOs) | 4-6h | Code quality, correctness |
| **4.4** | CloudFront log ingestion (requires DevOps to enable logs first) | 3-4h | Complete analytics picture |

---

## 4. Architecture Decisions for Admin Endpoints

### 4.1 Token Admin API

The admin Lambda needs these new routes:

```
POST   /tokens/create              # Create a new token
  Body: { "name": "community-x", "usage_limit": 100, "metadata": {...} }
  Returns: { "token_name", "cache_id", "cache_hash", "usage_limit", "share_url" }

GET    /tokens                     # List all tokens
  Returns: [ { "token_name", "usage_count", "usage_limit", "status", "created_at" }, ... ]

GET    /tokens/{token_name}        # Get token details + recent events
  Returns: { "token_name", "usage_count", "usage_limit", "status", "events": [...], "share_url" }

POST   /tokens/{token_name}/revoke # Revoke a token
  Returns: { "token_name", "status": "revoked", "revoked_at" }
```

### 4.2 Analytics Admin API

```
GET    /analytics/pulse            # Real-time pulse (last 5 minutes)
  Returns: Schema__Analytics__Pulse

GET    /analytics/{window_type}/{window_key}   # Aggregated analytics
  Examples: /analytics/hourly/2026-02-13T14, /analytics/daily/2026-02-13
  Returns: Schema__Analytics__Aggregation

GET    /analytics/latest/{window_type}         # Most recent aggregation
  Examples: /analytics/latest/daily, /analytics/latest/hourly
  Returns: Schema__Analytics__Aggregation
```

### 4.3 Shared Storage

Both Lambda functions (user and admin) must access the same Storage_FS backend. In Memory mode this means they share the same Memory-FS instance (which they already do in tests). In S3 mode they point to the same bucket. No changes needed — `Send__Config` already handles this.

The critical point: when the user Lambda writes a raw analytics event (on every request), the admin Lambda reads those events via the LETS pipeline. They share the same storage layer. This is the design intent of Memory-FS as the storage abstraction.

---

## 5. Risk Assessment

| Risk | Impact | Mitigation |
|------|--------|------------|
| **Cache service is a large implementation** (25-35h across all schemas) | Delays everything downstream | Start with minimum viable cache: just token schema + raw event recording. Aggregations can follow. |
| **Admin Lambda has no routes yet** | Can't test admin features end-to-end | Scaffold 1-2 routes in Phase 1 alongside cache service. |
| **No analytics since GA was removed** | Flying blind on a public product (RF-23, P0) | Prioritise raw event recording + pulse as the very first cache service feature. Even without aggregations, writing raw events gives us data to query later. |
| **Transfer Service has 70+ TODOs** | Increasing technical debt | Defer to Phase 4. The Transfer Service works. The TODOs are quality improvements, not bugs. |
| **CloudFront logs not enabled** | Analytics picture is incomplete (Lambda-only) | Accept this for Phase 1-2. Lambda events give us the critical metrics. CloudFront adds referrer/country data later. |

---

## 6. Relationship to v0.1.3 Accomplishments

The v0.1.3 session shipped the **user-facing UI** track (3 versions, i18n, 4 languages, Klingon). The next sprint pivots to the **server/admin** track. This is the natural alternation: user-facing work generates the need for server-side analytics and admin tooling.

What v0.1.3 delivered that feeds the server/admin sprint:
- **GA removed** → server-side analytics is now the only path to operational visibility
- **i18n shipped** → admin token system is the next user-facing need (inviting friendlies with community tokens)
- **LinkedIn post went live** → traffic is arriving with zero instrumentation (RF-23)
- **IFD methodology proven** → admin UI can follow the same versioning pattern

---

## Summary

**The next sprint is the server/admin sprint.** The sequence is:

1. Cache service core (the foundation)
2. Raw event recording + pulse (operational visibility — P0)
3. Token system (friendlies onboarding — P1)
4. Admin endpoints + UI (management dashboard — P2)

The Architect's cache service schema (D024-D030) is approved and ready for implementation. The Dev's implementation guide is the companion document to this review.

---

*Architect review complete. The server/admin sprint builds on the Architect's cache service schema. The critical path is: cache core → event recording → pulse → token system → admin UI.*
