# Architect Action Plan: Brief Response — 15 February 2026

**Version:** v0.3.12
**Date:** 15 February 2026
**Role:** Architect (Explorer Team)
**Responding to:** `team/humans/dinis_cruz/briefs/02/15/v0.3.10__daily-brief__explorer-team-15-feb-2026.md`
**Master index:** `team/roles/librarian/reviews/26-02-15/v0.3.10__master-index__daily-brief-15-feb.md`
**Previous action plans:**
- `team/roles/architect/reviews/26-02-15/v0.3.6__implementation-proposal__observability-pipeline.md`
- `team/roles/architect/reviews/26-02-14/v0.3.2__action-plan__explorer-next-steps.md`

---

## 1. Acknowledged Tasks

The v0.3.10 daily brief assigns **5 tasks** to the Architect role (per the Librarian's master index, Section 3.2). All five are acknowledged and accepted.

| # | Task | Priority | Co-owner | Brief Section | Status |
|---|------|----------|----------|---------------|--------|
| A1 | Path-based routing design + component architecture for SA dashboard (covers tasks #7 and #17) | **P1** | Dev | SA Dashboard | **BLOCKING Dev** -- all SA views depend on this |
| A2 | Architecture mapping of cache service usage for token storage (task #9) | **P2** | -- | Section 9 | **BLOCKING Dev** -- token perf fix depends on this |
| A3 | IFD version manifest specification (task #11) | **P2** | Dev | Section 8 | Design spec needed before Dev implements |
| A4 | Research: upload/download resilience -- chunked, retry, resume, streaming encryption (task #19) | **P2** | Dev | Resilience section | Research deliverable, no downstream blocker yet |
| A5 | Three-word key technical feasibility -- entropy analysis, lookup vs. decryption separation (task #20) | **P3** | AppSec, Advocate | Section 1 | Needs AppSec co-review; Dev blocked until security review complete |

---

## 2. Current Workload — Carry-Forward Items

### From v0.3.2 Action Plan (14 Feb)

The v0.3.2 action plan identified 7 workstreams (D1-D7). Current status:

| v0.3.2 ID | Deliverable | Status as of v0.3.12 | Carry Forward? |
|------------|-------------|----------------------|----------------|
| D1 | Technical context for design agency brief | **Superseded** -- Designer has produced the agency brief directly (`v0.3.3__brief__cruz-and-cruz-design-agency.md`) | No -- check if Designer still needs Architect input |
| D2 | Large file transfer design document | Preliminary design complete in v0.3.2 Section 2. The v0.3.10 brief now explicitly requests resilience research (task A4) | **Yes** -- folded into A4 |
| D3 | External partner Claude bot research brief | Research complete in v0.3.2 Section 3. Not referenced in v0.3.10 brief | No -- awaiting Dinis decision (AD-6) |
| D4 | Slack/WhatsApp bot research brief | Research complete in v0.3.2 Section 4. Not referenced in v0.3.10 brief | No -- awaiting Dinis decision |
| D5 | Unencrypted mode architecture assessment | Complete in v0.3.2 Section 5. Not referenced in v0.3.10 brief | No -- awaiting Dinis decision (AD-5) |
| D6 | Five handover briefs (Architect sections) | Blocked by AD-2 (format approval). Not referenced in v0.3.10 brief | Parked -- Villager track, not Explorer priority |
| D7 | AD decision requests to Dinis | Decisions AD-1 through AD-6 submitted. No response yet in the v0.3.10 brief | Parked -- carry forward passively |

### From v0.3.6 Observability Pipeline (15 Feb)

The v0.3.6 proposal is a complete implementation design for the CloudWatch metrics pipeline. It directly supports the SA dashboard work (task A1) and the LETS pipeline architecture described in the brief.

| v0.3.6 Item | Status | Relationship to New Tasks |
|-------------|--------|---------------------------|
| 9 metric schemas (Section 2) | Designed, not yet implemented | Dev implements; Architect design is done |
| CloudWatch Client + Stub (Section 3) | Designed | Dev implements |
| LETS aggregation pipeline | Designed | Feeds into SA dashboard views (A1) |
| Routes__Metrics | Designed | Part of the path-based routing (A1) |
| Open questions Q1-Q4 | Awaiting Dinis input | Q1 resolved (both JSON + HTML); Q2 resolved (Option C: on-demand + cache) |

**Summary:** The v0.3.6 proposal is ready for Dev to implement. No further Architect work is needed on it unless Dinis raises questions. The schemas and service design are inputs to the SA dashboard (A1) -- the routing design must account for these endpoints.

---

## 3. Blocking Responsibilities

Two of the five tasks are **blocking the Dev role**. These must be prioritised above all other Architect work.

### 3.1 BLOCKER: Cache Service Usage Mapping (A2) -- Blocks Dev Token Performance Fix

**What Dev needs:** An architecture map of how the cache service is currently being used for token storage and retrieval. The brief is explicit: "map it first, then optimise" rather than guessing.

**What Dev is blocked on:** Task #10 (fix token fetch performance). Dev cannot effectively fix the performance issue without understanding the current data flow, where cache entries live, and where unnecessary reads or S3 hits occur.

**Why this is the Architect's job:** The cache service has grown organically. Token data may be stored in multiple cache IDs, with temporal + latest folders, and the lookup path may involve multiple reads. Only an architecture-level mapping (not a code-level debugging session) will reveal the structural issues.

**Deliverable:** `v0.3.12__architecture-map__cache-service-token-usage.md`

**Scope:**
1. Map every cache ID involved in token operations (creation, lookup, validation, usage tracking, listing)
2. Trace the read path for "fetch all tokens" -- how many cache reads, how many S3 reads, what data volumes
3. Trace the read path for "validate a single token" -- same analysis
4. Identify whether aggregated/indexed data exists or whether every token list operation reads individual entries
5. Identify the bottleneck: is it N+1 reads, missing aggregation, S3 latency, data volume, or something else
6. Recommend the fix (likely: add a cached token index/summary in the `latest` folder)

**Estimated effort:** 1 session (read the code, map the flows, identify the bottleneck, write the recommendation).

### 3.2 BLOCKER: Path-Based Routing Design (A1) -- Blocks Cache Browser and All SA Dashboard Views

**What Dev needs:** A routing architecture that maps URL paths to view components for the SA dashboard. The brief specifies path-based URLs (not hash-fragment), REST-style, each view independently loadable.

**What Dev is blocked on:**
- Task #7: Build cache service browser UI
- Task #12: Build Lambda functions dashboard
- Task #13: Build CloudFront log viewer
- Task #17: Set up path-based routing for SA dashboard
- Task #21: Build AWS infrastructure overview

All five views are blocked. The cache browser (#7) is P1 and is itself the gating item for the other three views.

**Why this is the Architect's job:** Path-based routing in a static-file IFD context (no server-side rendering, no SPA framework) requires a deliberate architecture decision. The admin Lambda serves static files from versioned paths. Introducing path-based routing means either: (a) the Lambda rewrites paths to serve the correct IFD component, (b) a client-side router intercepts paths and loads components dynamically, or (c) CloudFront routing rules map paths to different static assets. Each has implications for IFD versioning, deployment, and the existing admin page structure.

**Deliverable:** `v0.3.12__design__sa-dashboard-path-based-routing.md`

**Scope:**
1. Evaluate the three routing approaches (Lambda rewrite, client-side router, CloudFront rules)
2. Recommend one approach and justify
3. Define the URL scheme for all SA views:
   - `/admin/dashboard/` -- overview
   - `/admin/dashboard/cache/` -- cache browser
   - `/admin/dashboard/cache/{cache-id}/` -- specific cache entry
   - `/admin/dashboard/lambda/` -- Lambda functions
   - `/admin/dashboard/lambda/{function-name}/` -- specific function
   - `/admin/dashboard/cloudfront/` -- CloudFront overview
   - `/admin/dashboard/cloudfront/logs/` -- log viewer
   - `/admin/dashboard/costs/` -- cost dashboard
4. Define the component loading pattern (how does a path resolve to a Web Component)
5. Define how routing interacts with IFD versioning (the admin UI is at `/admin/v0/v0.1/v0.1.0/` -- how does `/admin/dashboard/` relate to this?)
6. Define the data contract between routes and the cache service (what API endpoints does each view call)
7. Account for the three missing UI elements (API call log, event log, message panel) -- where do they fit in the layout

**Architecture decisions needed:** See Section 5 below.

**Estimated effort:** 1-2 sessions (research existing admin structure, design routing, write the spec).

---

## 4. Proposed Execution Order

Based on blocking status, priority, and dependencies:

```
Execution Order:

1. A2: Cache service usage mapping           [BLOCKING] ~1 session
   |
   +---> Unblocks Dev: token fetch performance fix (#10)
   |
2. A1: Path-based routing design             [BLOCKING] ~1-2 sessions
   |
   +---> Unblocks Dev: cache browser (#7), all SA views (#12, #13, #21)
   +---> Unblocks Dev: routing implementation (#17)
   +---> Unblocks Cartographer: system map update
   |
3. A3: IFD version manifest specification    [NON-BLOCKING] ~0.5 session
   |
   +---> Enables Dev: version switcher (#11)
   |
4. A4: Resilience research                   [NON-BLOCKING] ~2-3 sessions
   |
   (can overlap with Dev once they start SA dashboard work)
   +---> Feeds into future large file transfer implementation
   |
5. A5: Three-word key feasibility            [P3, NON-BLOCKING] ~1 session
   |
   (depends on AppSec co-review; can be deferred if AppSec is not available)
   +---> Feeds into future UX decision
```

**Rationale:**

- **A2 first** because it is the simplest blocker to remove (1 session) and immediately frees Dev to fix a user-visible performance issue. The brief is explicit: the human does not want Dev guessing.
- **A1 second** because it unblocks the entire SA dashboard workstream (5 Dev tasks) and is the critical path identified by the Librarian. It requires more work (~1-2 sessions) but has the highest unblocking value.
- **A3 third** because it is a short design task (~0.5 session) that can be produced quickly once the two blockers are cleared. The IFD manifest is a well-understood pattern.
- **A4 fourth** because it is strategically important but has no downstream blockers yet. The brief says "start early" but also says "a separate detailed briefing is coming." This is research, not implementation design -- it can proceed in parallel once blockers are cleared.
- **A5 last** because it is P3, depends on AppSec availability, and the brief explicitly says "don't implement yet." The entropy analysis can wait until the higher-priority items are delivered.

---

## 5. Architecture Decisions Needed

### AD-7: SA Dashboard Routing Approach

**Question:** How does path-based routing work in an IFD static-file architecture served by Lambda?

**Options:**

| Option | Mechanism | Pros | Cons |
|--------|-----------|------|------|
| A. Lambda path rewriting | Admin Lambda's FastAPI catches `/admin/dashboard/*` routes, serves the appropriate static HTML/JS component | Server-controlled, clean URLs, works with direct navigation | Requires route registration in FastAPI, adds coupling between server and UI structure |
| B. Client-side router | A single `dashboard.html` entry point with a vanilla JS router that reads `window.location.pathname` and loads the correct Web Component | Pure IFD, no server changes, all routing logic in the UI | Requires the Lambda (or CloudFront) to serve `dashboard.html` for all `/admin/dashboard/*` paths (catch-all route) |
| C. CloudFront routing | CloudFront behaviours map `/admin/dashboard/*` to specific origins or rewrite rules | CDN-level, fast | CloudFront config complexity, harder to change, couples routing to infrastructure |

**Preliminary recommendation:** Option B (client-side router with Lambda catch-all). This is most consistent with IFD methodology (UI owns its own routing) and requires only a single FastAPI catch-all route. The v0.3.6 observability proposal already defines `/metrics/*` API routes -- the dashboard UI would call those as data endpoints while managing its own view routing.

**Decision needed from:** Dinis (approach) + Dev (implementation feasibility check)

### AD-8: Cache Service Token Data Structure

**Question:** Is token data currently stored as individual cache entries (one per token) requiring N reads to list all tokens, or is there an aggregated index?

**This is not a decision to make -- it is a fact to discover.** The cache mapping (A2) will answer this question and determine the fix. Possible outcomes:

- If individual entries with no index: recommend adding a `latest/tokens-index.json` aggregation
- If index exists but is stale: recommend adding a cache-invalidation pattern on token mutation
- If the data volume is small but S3 latency is high: recommend pre-loading into memory on Lambda init

### AD-9: IFD Version Manifest Location and Format

**Question:** Where does the version manifest live, and what format does it use?

**Preliminary design:**
- Location: `/admin/v0/v0.1/manifest.json` (at the root of the major version folder, as the brief specifies)
- Format:
  ```json
  {
    "major_version": "v0.1",
    "current": "v0.1.0",
    "versions": [
      {
        "version": "v0.1.0",
        "timestamp": "2026-02-14T18:00:00Z",
        "status": "active"
      }
    ]
  }
  ```
- The manifest is updated on each IFD deployment (part of the deploy pipeline)
- The admin UI reads the manifest to populate the version switcher dropdown

**Decision needed from:** Dev (confirm feasibility of manifest generation in deploy pipeline) + Dinis (approve format)

### AD-10: Dashboard Layout with Three Missing UI Elements

**Question:** How do the API call log, event log, and message panel integrate with the SA dashboard layout?

**Preliminary thinking:** These are development/debugging tools that should be available on every SA dashboard view, not just one. Options:
- Collapsible bottom panel (like browser DevTools)
- Slide-out side panel
- Dedicated `/admin/dashboard/debug/` view

This decision is tightly coupled with the routing design (A1) and will be addressed in that deliverable.

---

## 6. Deliverables

| # | Document | Produces | Target | Unblocks |
|---|----------|----------|--------|----------|
| D1 | `v0.3.12__architecture-map__cache-service-token-usage.md` | Cache ID mapping, read paths, bottleneck identification, fix recommendation | **This session** | Dev: token fetch performance (#10) |
| D2 | `v0.3.12__design__sa-dashboard-path-based-routing.md` | URL scheme, routing approach, component loading pattern, IFD integration, layout with debug panels | **This session or next** | Dev: cache browser (#7), routing (#17), Lambda dashboard (#12), CloudFront viewer (#13), infrastructure overview (#21) |
| D3 | `v0.3.12__spec__ifd-version-manifest.md` | Manifest format, location, generation process, version switcher component contract | **After D1 and D2** | Dev: version switcher (#11) |
| D4 | `v0.3.12__research__upload-download-resilience.md` | Current state analysis, browser capabilities, S3 capabilities, existing solutions survey, encryption interaction, proposed architecture | **After D1-D3** | Future: large file transfer implementation |
| D5 | `v0.3.12__research__three-word-key-feasibility.md` | Entropy analysis, lookup vs. decryption separation, security trade-offs, trademark check | **After D1-D4, requires AppSec** | Future: three-word key UX decision |

**Location for all deliverables:** `team/roles/architect/reviews/26-02-15/`

### Deliverable Dependencies

```
D1 (cache mapping) -----> Dev starts token perf fix
    |
    v
D2 (routing design) ----> Dev starts cache browser + all SA views
    |
    v
D3 (IFD manifest) ------> Dev starts version switcher
    |
    v
D4 (resilience research)  (no immediate downstream blocker)
    |
    v
D5 (three-word key)        (P3, requires AppSec co-review)
```

---

## 7. Relationship to v0.3.6 Observability Pipeline

The v0.3.6 implementation proposal (`v0.3.6__implementation-proposal__observability-pipeline.md`) is a completed Architect deliverable. It provides:

- **9 schema designs** for metrics data (Lambda, CloudFront, S3, health, aggregation)
- **Service architecture** (CloudWatch Client, Stub, Snapshot orchestrator, Aggregator)
- **API route design** (Routes__Metrics)
- **Testing strategy** (no mocks, CloudWatch__Client__Stub)

The routing design (D2) must integrate the `/metrics/*` API endpoints from v0.3.6 into the SA dashboard URL scheme. The cache browser (Dev task #7) will need to display the metrics data that the v0.3.6 pipeline produces.

**No rework of v0.3.6 is expected.** The routing design wraps around it.

---

## 8. Relationship to v0.3.2 Pending Decisions

Six architectural decisions (AD-1 through AD-6) were submitted to Dinis in the v0.3.2 action plan. The v0.3.10 brief does not explicitly respond to any of them, but implicitly resolves some:

| Decision | Status | Resolution |
|----------|--------|------------|
| AD-1: Environment separation (Explorer vs. Villager) | **Open** | Not addressed in v0.3.10 brief |
| AD-2: Handover brief format | **Open** | Not addressed; handover is Villager-track work |
| AD-3: Branching strategy for two teams | **Open** | Not addressed |
| AD-4: Large file transfer architecture (chunk-then-encrypt) | **Partially addressed** | Brief requests resilience research (A4), which subsumes and expands AD-4 |
| AD-5: Unencrypted mode | **Open** | Not addressed in v0.3.10 brief |
| AD-6: External partner communication | **Open** | Not addressed |

New decisions AD-7 through AD-10 are identified in Section 5 above. These are immediate -- they arise from the current brief and must be resolved within this workstream.

---

## 9. Summary

**Immediate priority:** Remove the two blockers. The cache service usage mapping (D1) is a ~1 session task that frees Dev to fix a visible performance bug. The path-based routing design (D2) is a ~1-2 session task that unlocks the entire SA dashboard track -- the single highest-value workstream in this brief.

**After blockers cleared:** IFD manifest spec (D3, quick), resilience research (D4, substantial), three-word key feasibility (D5, requires AppSec).

**No rework needed:** The v0.3.6 observability pipeline proposal is complete and ready for Dev implementation. The v0.3.2 action plan items not addressed in this brief remain parked awaiting Dinis decisions.

**The Architect's critical path is clear: D1 then D2. Everything else follows.**

---

*Architect: Acknowledged 5 tasks, identified 2 blockers, proposed execution order, defined 5 deliverables with dependencies. Ready to begin D1 (cache service usage mapping) immediately.*
