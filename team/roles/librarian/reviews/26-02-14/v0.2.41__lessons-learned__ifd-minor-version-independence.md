# Librarian: Lessons Learned — IFD Minor Version Independence

**Version:** v0.2.41
**Date:** 2026-02-14
**Role:** Librarian
**Category:** Lessons Learned

---

## Context

During the v0.1.x frontend development cycle (v0.1.1 through v0.1.4), the IFD surgical override pattern was not followed. Minor versions contain full class copies (~400–500 lines each) instead of small prototype method overrides (~15–50 lines). This was identified during the 14 Feb 2026 session and accepted as technical debt to carry into the v0.2.0 consolidation.

---

## Lessons Learned

### L1: Methodology Must Precede Implementation

**What happened:** The IFD Versioning Guide (v1.2.0) was formalised after v0.1.0 and early minor versions were already being created. Agents followed the spirit ("each version in its own folder") but not the letter ("surgical overrides only").

**Lesson:** When introducing a new methodology (IFD, or any other), the guide must exist and be referenced **before** the first implementation. Add the guide to CLAUDE.md or the relevant section so agents pick it up automatically.

**Action:** When v0.2.0 work begins, ensure the IFD Versioning Guide is linked directly from the Key Rules section of CLAUDE.md, not just present in `library/guides/`.

---

### L2: Web Components Have a `customElements.define()` Constraint

**What happened:** The IFD guide shows surgical overrides via `ClassName.prototype.methodName = function() { ... }`, which works for vanilla JS classes. But for Web Components, `customElements.define('tag-name', ClassName)` can only be called **once per tag name** per page. Agents re-declared the entire class with a new `customElements.define()` call, making surgical overrides impossible without refactoring.

**Lesson:** The IFD guide needs a Web Components addendum explaining:
- Only the base version (v0.X.0) calls `customElements.define()`
- Minor versions override methods via `ClassName.prototype.methodName = ...`
- If a new method needs to be added, extend the prototype; don't re-declare the class

**Action:** Update `library/guides/development/ifd/v1.2.0__ifd__versioning_guide.md` with a "Web Components" section before v0.2.1 work begins.

---

### L3: Guard Rails Catch Drift Before It Compounds

**What happened:** The full-copy pattern was introduced in v0.1.1. It was then replicated in v0.1.2, v0.1.3, and v0.1.4 without being flagged. By the time the drift was noticed, four versions had the same problem.

**Lesson:** A simple automated check could have caught this:
- Flag any file in a minor version folder (vN.N.X where X > 0) that exceeds 100 lines
- Flag any minor version that contains `customElements.define()`

**Action:** Add IFD lint rules to the QA checklist or pre-commit hooks before v0.2.1 work begins.

---

### L4: "Works Correctly" and "Follows Methodology" Are Separate Concerns

**What happened:** The app works perfectly. All 111 tests pass. Encryption is correct. The UI is functional. But the versioning methodology is broken — minor versions are not independent, rollback granularity is lost, and there's hidden coupling to v0.1.0.

**Lesson:** Functional correctness doesn't validate process compliance. Both matter, but they're checked differently. Test suites catch functional regressions; methodology compliance needs review or lint rules.

**Action:** When the QA role reviews frontend work, add an IFD compliance check alongside functional testing.

---

### L5: Accept and Move On When Retrofitting Costs More Than Forward-Fixing

**What happened:** The team considered retroactively fixing v0.1.1–v0.1.4 to use proper surgical overrides. The decision was to **not do this** — the app works, it's going to production, and the v0.2.0 consolidation will create a clean baseline anyway.

**Lesson:** Not every deviation needs immediate correction. If the fix is expensive, the impact is contained, and there's a natural resolution point ahead (v0.2.0 consolidation), it's pragmatic to document the issue, capture the lessons, and fix it properly at the next checkpoint.

---

## Summary Table

| # | Lesson | Prevents | Fix Point |
|---|--------|----------|-----------|
| L1 | Guide before implementation | Methodology drift | Before v0.2.1 |
| L2 | Web Components define() constraint | Class re-declaration in patches | IFD guide update |
| L3 | Guard rails (lint/size checks) | Compounding drift | Pre-commit or QA checklist |
| L4 | Process compliance ≠ functional correctness | Invisible methodology violations | QA role review scope |
| L5 | Accept when retrofit > forward-fix | Wasted effort on dead-end refactors | Team decision pattern |

---

## Cross-References

- **Dev analysis:** `../../dev/reviews/26-02-14/v0.2.41__review__ifd-broken-independence-analysis.md`
- **IFD Versioning Guide:** `../../../../library/guides/development/ifd/v1.2.0__ifd__versioning_guide.md`
- **Debrief:** `../../../humans/dinis_cruz/debriefs/02/14/v0.2.41__debrief__ifd-broken-independence-lessons.md`

---

*Lessons captured. No code changes. Knowledge indexed for future agent sessions.*
