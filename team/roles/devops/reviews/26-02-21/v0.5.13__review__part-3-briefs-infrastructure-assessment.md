# DevOps Review: Part-3 Briefs — Infrastructure Assessment

**version** v0.5.13
**date** 21 Feb 2026
**role** DevOps
**type** Review — infrastructure assessment of v0.5.10 briefs

---

## Briefs Assigned to DevOps

| Brief | Key Infrastructure Concern |
|-------|---------------------------|
| `architecture__github-store-and-ephemeral-compute` | EC2 on-demand, Lambda orchestrator, DNS routing, CloudFront |
| `dev-brief__fastapi-ec2-management-routes` | EC2 lifecycle via API, SSH in Lambda, budget controls |
| `brief__secrets-manager-dogfooding` | Deployment secret management via SG/Send |
| `dev-brief__data-room-ux-and-fleet-management` | Fleet management: DNS provisioning, CloudFront distributions |

---

## Infrastructure Requirements

### EC2 Ephemeral Instances

Each data room requires:
- EC2 instance (t3.micro default, up to t3.medium)
- Security group: port 443 inbound only, **zero egress**
- No IAM role (or minimal — no AWS API access)
- No SSH access (disabled by default; available via API for admin)
- Auto-terminate after idle timeout (configurable, default 30 min)

**AMI creation**: need a base AMI with SG/Send FastAPI server pre-installed. Instance boots, receives config from Lambda, starts serving.

### Lambda Orchestrator

State machine for data room boot:
1. NO_INSTANCE -> Create EC2 from AMI
2. BOOTING -> Poll health check
3. RUNNING_VANILLA -> Push config via admin API
4. READY -> Update DNS routing
5. ACTIVE -> Monitor idle timeout
6. SHUTTING_DOWN -> Sync data, terminate, revert DNS

### DNS and CloudFront

Per data room:
- Route53 entry: `{name}.send.sgraph.ai`
- CloudFront distribution with origin switching (Lambda when down, EC2 when running)
- Estimated cost: ~$0.50/month per data room for DNS

### Secrets Manager Migration

Replace current 20+ env vars per Lambda with 2:
- `SGSEND_DOC_ID` — pointer to encrypted secrets document
- `SGSEND_KEY` — decryption key

This simplifies the CI/CD pipeline significantly. One API call on boot replaces all GitHub Secrets configuration.

---

## Cost Model (for Accountant)

| Component | Per Data Room | Notes |
|-----------|--------------|-------|
| DNS (Route53) | ~$0.50/month | Per hosted zone + queries |
| CloudFront | Variable | Per-request + per-GB |
| EC2 (running) | ~$0.01/hour (t3.micro) | Only when active |
| EC2 (idle) | $0 | Terminated when idle |
| S3 (encrypted storage) | Pennies | Per-GB stored |
| Lambda orchestrator | Negligible | Few invocations per boot |

**Key metric needed**: cost per data room per month at idle, light, and active usage levels.

---

## Action Items

1. Design base AMI for data room EC2 instances
2. Implement security group template (443 inbound, zero egress)
3. Plan DNS automation for data room provisioning
4. Evaluate CloudFront origin switching for Lambda/EC2 routing
5. Prepare for secrets manager migration (test with one Lambda first)
