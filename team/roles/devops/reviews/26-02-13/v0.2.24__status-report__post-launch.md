# DevOps Status Report -- Post-Launch Operational Assessment

**Version:** v0.2.24
**Date:** 13 Feb 2026
**Role:** DevOps
**Status:** SGraph Send is live at send.sgraph.ai

---

## 1. Current Production State

### What Is Deployed

| Component | Status | Details |
|-----------|--------|---------|
| User Lambda (`sgraph_ai_app_send-user-dev`) | Live | Python 3.13, Mangum adapter, Function URL |
| Admin Lambda (`sgraph_ai_app_send-admin-dev`) | Live | Python 3.13, Mangum adapter, Function URL |
| S3 persistent storage | Live | Auto-created bucket (`{account_id}--sgraph-send-transfers--{region}`), created on first request by `Storage_FS__S3.setup()` |
| CI pipeline (dev) | Active | Push to `dev` --> tests --> tag (minor) --> deploy both Lambdas |
| CI pipeline (main) | Active | Push to `main` --> tests --> tag (major) --> PyPI publish --> deploy both Lambdas |
| Jekyll docs site | Live | docs.send.sgraph.ai via GitHub Pages (`jekyll-pages.yml`) |
| Google Analytics | Active | Tracking on send.sgraph.ai and docs.send.sgraph.ai |
| LaunchList waitlist | Embedded | On landing page |
| Access token auth | Active | `SGRAPH_SEND__ACCESS_TOKEN` env var, validated per-route via `x-sgraph-access-token` header |

### What Is Working

1. **Full transfer cycle**: upload (encrypted in browser) --> store (S3) --> share link --> download --> decrypt in browser
2. **CI/CD automation**: every push to `dev` runs tests, increments tag, deploys both Lambdas in parallel (~1m 26s total)
3. **S3 auto-provisioning**: `Send__Config` auto-detects AWS credentials, resolves bucket name, `Storage_FS__S3.setup()` creates bucket if missing
4. **Per-route access control**: `check_access_token()` on mutation endpoints (create, upload, complete), read endpoints (info, download) are public
5. **Graceful CI degradation**: missing AWS credentials skip deploy without failing the pipeline

---

## 2. Operational Readiness Assessment

### GREEN -- Functioning

| Area | Assessment |
|------|------------|
| Deployment automation | Fully automated test-to-deploy pipeline |
| Storage persistence | S3 backend operational, survives Lambda instance recycling |
| Version management | Automated minor/major tagging tied to branch |
| Secret management | 7 GitHub secrets properly segmented, credential check gate before deploy |
| Zero-knowledge integrity | Server stores only ciphertext, no file names, no decryption keys |

### AMBER -- Partially Addressed

| Area | What Exists | What Is Missing |
|------|-------------|-----------------|
| Authentication | Per-route access token on write endpoints | No rate limiting on token-protected endpoints; single shared token (no per-user tokens) |
| CORS | Lambda Function URL default CORS | No explicit CORS policy configured; needs lockdown to `send.sgraph.ai` origin only |
| Error handling | FastAPI exception handlers (404, 401) | No structured error logging; no error alerting |
| Storage lifecycle | S3 bucket auto-created | No object lifecycle rules (TTL); no bucket policy enforcing SSL-only access |

### RED -- Not Present

| Area | Risk | Priority |
|------|------|----------|
| Monitoring and alerting | No CloudWatch alarms, no error notifications, no anomaly detection | P0 |
| Rate limiting | No throttling on any endpoint; a single client can exhaust Lambda concurrency or S3 throughput | P0 |
| Request logging | Lambda CloudWatch logs exist but are not structured, not dashboarded, not retained with policy | P1 |
| WAF | No Web Application Firewall; Lambda Function URLs are directly exposed | P1 |
| Health check monitoring | `/info/health` exists but nothing polls it; no uptime monitoring | P1 |
| Incident response runbooks | No documented procedures for any failure scenario | P1 |
| Cost monitoring | No budget alerts, no spend dashboard | P2 |

---

## 3. Identified Risks for a System with Real Users

### RISK-1: No Rate Limiting (Severity: High)

**What could happen:** A single actor floods `/transfers/create` or `/transfers/upload/{id}` with requests. Lambda scales up (concurrency), S3 fills with objects, AWS bill spikes. Alternatively, the access token is brute-forced.

**Mitigation path:**
- Immediate: configure Lambda reserved concurrency to cap scaling (e.g., 10 concurrent)
- Short-term: add API-level rate limiting (per-IP throttle via middleware or WAF)
- Medium-term: WAF rules on the Lambda Function URL (if supported) or move to CloudFront + WAF

### RISK-2: No CORS Lockdown (Severity: High)

**What could happen:** Any origin can call the transfer API. A malicious site could embed requests to `send.sgraph.ai` endpoints.

**Mitigation path:**
- Immediate: configure Lambda Function URL CORS to allow only `https://send.sgraph.ai`
- Verify: the current Function URL CORS settings (may be `*` by default)

### RISK-3: No Monitoring or Alerting (Severity: High)

**What could happen:** The system goes down and nobody knows until a user reports it. An attacker probes the system and nobody sees it. S3 costs spike and nobody notices.

**Mitigation path:**
- Immediate: CloudWatch alarm on Lambda errors > 0 (SNS to email/Slack)
- Immediate: CloudWatch alarm on Lambda throttles > 0
- Short-term: external uptime monitor polling `/info/health` every 5 minutes
- Medium-term: full WS-3 observability stack (see Section 5)

### RISK-4: No S3 Object Lifecycle (Severity: Medium)

**What could happen:** Encrypted transfer payloads accumulate indefinitely. Storage costs grow linearly with usage. Old transfers never expire.

**Mitigation path:**
- Immediate: add S3 lifecycle rule to auto-delete objects older than 7 days (configurable)
- Short-term: add transfer expiry to `Transfer__Service` (reject downloads of expired transfers)

### RISK-5: No Structured Logging (Severity: Medium)

**What could happen:** When investigating an incident, we cannot query logs effectively. We cannot answer "how many transfers happened today?" or "what IPs are hitting the API?"

**Mitigation path:**
- Short-term: add structured JSON logging to FastAPI (request method, path, status code, duration, IP hash)
- Medium-term: CloudWatch Insights queries on structured logs

### RISK-6: S3 Bucket Configuration Not Hardened (Severity: Medium)

**What could happen:** The auto-created bucket may not have optimal security settings. Need to verify: public access block, encryption at rest, bucket policy.

**Mitigation path:**
- Immediate: audit the bucket created by `Storage_FS__S3.setup()` -- verify all four public access block settings are enabled, SSE-S3 encryption is active, and a bucket policy enforces `aws:SecureTransport`

---

## 4. CI/CD Assessment and Improvements Needed

### Current Pipeline (Working)

```
Push to dev --> Run Unit Tests (20s)
                  |
                  +--> Increment Tag (minor, 8s)
                  |       +--> Admin Lambda Deploy (49s) --\
                  |       +--> User Lambda Deploy (41s)  ---+--> (parallel)
                  |
                  +--> Check AWS Credentials (3s) ----+
```

### What Works Well

- Pytest-driven deployment with assertions at every step
- Parallel Lambda deployment (Admin + User)
- Graceful skip when AWS credentials are absent
- Tag management automated (minor on dev, major on main)

### Improvements Needed

| Improvement | Priority | Rationale |
|-------------|----------|-----------|
| **Post-deploy smoke test** | P0 | After deployment, hit `/info/health` on both Lambda Function URLs and assert `{"status": "ok"}`. Currently the deploy tests do this, but if the Function URL configuration drifts, CI would not catch it on subsequent runs. |
| **SGRAPH_SEND__ACCESS_TOKEN in deploy env** | P0 -- Verify | Confirm this new env var is injected into both Lambda functions during deployment. If not, write endpoints will reject all requests with 401. |
| **Branch protection on `dev`** | P1 | Currently any push to `dev` triggers deployment. Add required status checks (tests must pass) as branch protection rule. |
| **Deploy to `prod` workflow** | P1 | Test classes exist (`test_Deploy__*__Service__to__prod.py`) but no CI trigger. Need a production deployment workflow (manual trigger, approval gate). |
| **Integration tests in CI** | P1 | No LocalStack S3 tests in CI. Storage backend only tested in-memory. |
| **Playwright E2E in CI** | P2 | WS-6 prerequisite. No browser tests verify the full upload-download cycle through the UI. |
| **Dependency version pinning audit** | P2 | Lambda dependencies are pinned (`httpx==0.28.1`, `memory-fs==v0.40.0`, `osbot-fast-api-serverless==v1.33.0`) but the deploy action installs from `requirements-test.txt` + `pip install -e .` -- verify no floating versions. |
| **Pipeline duration tracking** | P3 | Track CI duration over time. Current ~1m 26s is good; watch for regression as test count grows. |

---

## 5. WS-3 (AWS Observability) Readiness

### Current State: Not Started

No AWS observability features are enabled beyond default Lambda CloudWatch logs.

### Implementation Plan (Ordered by Priority)

#### Phase 1: Immediate (This Week)

| Action | Service | Deliverable |
|--------|---------|-------------|
| Enable CloudWatch alarms | Lambda | Alarms on: Errors > 0, Throttles > 0, Duration > 10s. SNS notification target. |
| Enable Lambda enhanced monitoring | Lambda | Memory utilisation, init duration metrics |
| Verify CloudWatch log retention | Lambda | Set retention to 30 days (avoid indefinite accumulation) |
| Set up AWS Budget alert | Billing | Alert at $10, $25, $50 thresholds |

#### Phase 2: Short-Term (Next 1-2 Weeks)

| Action | Service | Deliverable |
|--------|---------|-------------|
| Enable X-Ray tracing | Lambda | Trace requests through Lambda + S3 calls |
| Create CloudWatch dashboard | CloudWatch | Single dashboard: invocations, errors, duration, throttles, S3 operations |
| Enable S3 request metrics | S3 | Request counts and latency by operation type |
| Add structured logging | Application | JSON-formatted logs with request metadata (parseable by CloudWatch Insights) |

#### Phase 3: Medium-Term (When CloudFront Is Added)

| Action | Service | Deliverable |
|--------|---------|-------------|
| Enable CloudFront access logs | CloudFront | Detailed request logs to S3 |
| Enable WAF | CloudFront/WAF | Rate limiting rules, geo-blocking rules, SQL injection/XSS protection |
| Create WAF dashboard | WAF/CloudWatch | Blocked requests, rule match rates |
| Feed logs to Sherpa | Application | Format observability data for trail observation |

### Cost Estimate at Current Traffic

At low traffic (< 1000 requests/day):
- CloudWatch alarms: ~$0.10/alarm/month (5 alarms = $0.50)
- CloudWatch Logs (30-day retention): < $1/month
- X-Ray tracing: free tier covers 100K traces/month
- S3 request metrics: $0.01/1000 requests
- **Total estimate: < $5/month**

This validates the brief's position: enable everything now while traffic is low, scale back later if needed.

---

## 6. Pending Workstream Status

| Workstream | Status | Blocker | Next Step |
|------------|--------|---------|-----------|
| **WS-3: AWS Observability** | Not started | None | Create CloudWatch alarms and budget alert (Phase 1 above) |
| **WS-11: Self-Hosted Docker** | Not started | Dockerfile not created | Create Dockerfile, test locally, publish to GHCR |
| **WS-6: Playwright Service** | Not started | Architecture not finalised | Architect to define Issues FS zip-in/zip-out contract; DevOps to provision Docker/Lambda infra |

### Dependency Chain

```
WS-3 (Observability) --> Enables Sherpa trail reading
                     --> Feeds tabletop exercise data
                     --> No blockers, can start immediately

WS-11 (Docker)       --> Enables WS-6 (Playwright runs in Docker)
                     --> Enables ECS Fargate, GCP Cloud Run targets
                     --> Blocked on Dockerfile creation

WS-6 (Playwright)    --> Depends on WS-11 (Docker image)
                     --> Depends on Architect (DSL schema)
                     --> Depends on QA (synthetic user scripts)
```

---

## 7. Action Items (Prioritised)

### P0 -- Do This Week

- [ ] Configure Lambda reserved concurrency (cap at 10-20)
- [ ] Lock down CORS on both Lambda Function URLs to `https://send.sgraph.ai`
- [ ] Create CloudWatch alarms: Lambda errors, throttles, duration
- [ ] Set up AWS Budget alert ($10, $25, $50 thresholds)
- [ ] Verify `SGRAPH_SEND__ACCESS_TOKEN` is set as Lambda env var in both functions
- [ ] Audit S3 bucket: public access block, encryption, bucket policy

### P1 -- Do Next Week

- [ ] Add S3 lifecycle rule (7-day TTL on transfer objects)
- [ ] Set CloudWatch log retention to 30 days
- [ ] Enable X-Ray tracing on both Lambdas
- [ ] Create CloudWatch dashboard (single pane: invocations, errors, duration, S3 ops)
- [ ] Add post-deploy smoke test to CI pipeline
- [ ] Set up external uptime monitor (ping `/info/health` every 5 min)

### P2 -- Do Within Two Weeks

- [ ] Add structured JSON logging to FastAPI application
- [ ] Create production deployment workflow (manual trigger, approval gate)
- [ ] Create Dockerfile for WS-11
- [ ] Enable S3 request metrics
- [ ] Begin Playwright service infrastructure (WS-6)

---

## 8. Summary

SGraph Send is live and the core transfer cycle works. The CI/CD pipeline is solid -- automated test-to-deploy in under 90 seconds. S3 persistent storage resolved the single-instance limitation.

However, the system is running without guardrails. There is no rate limiting, no monitoring, no alerting, no CORS lockdown, and no incident runbooks. For a system that now has real users arriving via LinkedIn, these gaps represent concrete operational risk.

The highest-priority actions are defensive: cap Lambda concurrency, lock CORS, set up CloudWatch alarms, and audit the S3 bucket. These are all achievable within days and require no code changes to the application -- they are infrastructure configuration only.

WS-3 (Observability) should be the primary DevOps focus for the next sprint. The brief's guidance to "enable everything while traffic is low" is correct -- the cost at current volume is negligible, and the observability data is essential for the Sherpa, CISO, and DPO roles.

---

*Previous DevOps reviews:*
- `team/roles/devops/reviews/26-02-12/v0.2.15__aws-deployment-documentation.md`
- `team/roles/devops/reviews/26-02-12/v0.2.15__briefing__mvp-review-devops-tasks.md`
- `team/roles/devops/reviews/26-02-10/v0.2.1__response-to-infrastructure-brief.md`
