# v0.2.24 — Cartographer Response to Daily Brief (13 Feb 2026)

**Version:** v0.2.24
**Date:** 2026-02-13
**Role:** Cartographer
**Context:** Response to `team/humans/dinis_cruz/briefs/02/13/v0.2.16__daily-brief__sgraph-send-13-feb-2026.md`

---

## 1. Updated Data Flow: Hash-Fragment URLs

### Before (Current)

```
Sender                          Server                     Recipient
  │                               │                           │
  ├── encrypt(file, key) ────────►│                           │
  │   POST /transfers/create      │                           │
  │   POST /transfers/upload      │                           │
  │   POST /transfers/complete    │                           │
  │                               │                           │
  │◄── download_url + key ────────│                           │
  │                               │                           │
  │── share link via channel A ──────────────────────────────►│
  │── share key via channel B ───────────────────────────────►│
  │                               │                           │
  │                               │◄── GET /transfers/info ───┤
  │                               │◄── GET /transfers/download┤
  │                               │                           │
  │                               │                  decrypt(blob, key)
```

### After (Hash-Fragment)

```
Sender                          Server                     Recipient
  │                               │                           │
  ├── encrypt(file, key) ────────►│                           │
  │   POST /transfers/create      │                           │
  │   POST /transfers/upload      │                           │
  │   POST /transfers/complete    │                           │
  │                               │                           │
  │◄── combined_url#id/key ───────│                           │
  │                               │                           │
  │── share ONE link ────────────────────────────────────────►│
  │   (email, chat, etc.)         │                           │
  │                               │                           │
  │                               │◄── GET /download.html ────┤
  │                               │    (hash NOT sent)        │
  │                               │                           │
  │                               │   JS reads hash locally   │
  │                               │   ├── transferId from hash│
  │                               │   └── key from hash       │
  │                               │                           │
  │                               │◄── GET /transfers/info ───┤
  │                               │◄── GET /transfers/download┤
  │                               │                           │
  │                               │               decrypt(blob, key)
  │                               │               history.replaceState()
```

**Key change:** Server never sees the hash fragment. The `#id/key` part is consumed entirely by client-side JavaScript. Zero-knowledge property preserved.

---

## 2. New System Components

### Observability Pipeline (New)

```
┌─────────────────────────────────────────────────────────┐
│                    DATA SOURCES                          │
├─────────────┬──────────────┬──────────────┬─────────────┤
│ CloudWatch  │ CloudFront   │ S3 Access    │ App Events  │
│ Logs        │ Access Logs  │ Logs         │             │
└──────┬──────┴──────┬───────┴──────┬───────┴──────┬──────┘
       │             │              │              │
       ▼             ▼              ▼              ▼
┌─────────────────────────────────────────────────────────┐
│              COLLECTOR LAYER                             │
│  (Lambda / scheduled / on-demand)                        │
│  High-water mark tracking per source                     │
└──────────────────────┬──────────────────────────────────┘
                       │
                       ▼
┌─────────────────────────────────────────────────────────┐
│              S3 DATA LAKE                                │
│  sgraph-send-datalake-{env}/                             │
│  ├── cloudwatch/{function}/YYYY/MM/DD/                   │
│  ├── cloudfront/YYYY/MM/DD/                              │
│  ├── s3-access/YYYY/MM/DD/                               │
│  ├── app-events/YYYY/MM/DD/                              │
│  ├── google-analytics/YYYY/MM/DD/                        │
│  └── _metadata/high-water-marks.json                     │
└──────────────────────┬──────────────────────────────────┘
                       │
                       ▼
┌─────────────────────────────────────────────────────────┐
│              VISUALISATION LAYER                         │
│  Admin UI dashboards                                     │
│  ├── Transfer volume / time                              │
│  ├── Error rates                                         │
│  ├── Token activation funnel                             │
│  └── User event timeline                                 │
└─────────────────────────────────────────────────────────┘
```

### Admin Token System (New)

```
┌─────────────────┐     ┌──────────────────────┐
│  Admin UI       │     │  Admin Lambda         │
│  (token mgmt)   │────►│  POST /tokens/create  │
│                 │     │  GET  /tokens         │
│                 │     │  POST /tokens/:id/    │
│                 │     │       revoke          │
└─────────────────┘     └──────────┬───────────┘
                                   │
                                   ▼
                        ┌──────────────────────┐
                        │  Memory-FS           │
                        │  /tokens/{id}/       │
                        │    token.json        │
                        └──────────────────────┘
```

### i18n Data Flow (New)

```
┌──────────────┐     ┌───────────────┐     ┌──────────────────┐
│ Language      │     │ i18n Module   │     │ Web Components   │
│ JSON files    │────►│ (js/i18n.js)  │────►│ render() methods │
│ (en.json,    │     │ t('key')      │     │ use t() function │
│  pt.json)    │     │ fallback: en  │     │                  │
└──────────────┘     └───────────────┘     └──────────────────┘
                            ▲
                            │
                     ┌──────┴──────┐
                     │ localStorage │
                     │ 'sgraph-lang'│
                     └─────────────┘
```

---

## 3. Updated Security Boundary Map

```
┌─────────────────── BROWSER (Client) ────────────────────┐
│                                                          │
│  ┌──────────────────────────────────────────────────┐   │
│  │ SECRETS ZONE (never leaves browser)              │   │
│  │  • AES-256-GCM encryption key                    │   │
│  │  • Plaintext file/text content                   │   │
│  │  • URL hash fragment (#id/key)                   │   │
│  │  • Original filename                             │   │
│  └──────────────────────────────────────────────────┘   │
│                                                          │
│  ┌──────────────────────────────────────────────────┐   │
│  │ TRANSMITTED TO SERVER                             │   │
│  │  • Encrypted blob (ciphertext)                   │   │
│  │  • Transfer ID                                   │   │
│  │  • Access token (header)                         │   │
│  │  • Content-type hint (new: text/plain or binary) │   │
│  │  • Invitation token (query string — intentional) │   │
│  └──────────────────────────────────────────────────┘   │
│                                                          │
└──────────────────────────────────────────────────────────┘

┌─────────────────── SERVER ──────────────────────────────┐
│                                                          │
│  ┌──────────────────────────────────────────────────┐   │
│  │ STORED (all non-sensitive by design)              │   │
│  │  • Encrypted blob                                │   │
│  │  • Transfer metadata (ID, timestamp, size)       │   │
│  │  • IP hash (SHA-256 + daily salt)                │   │
│  │  • Events (created, viewed, downloaded)          │   │
│  │  • Token lifecycle (created, used, revoked)      │   │
│  │  • Content-type hint                             │   │
│  └──────────────────────────────────────────────────┘   │
│                                                          │
│  ┌──────────────────────────────────────────────────┐   │
│  │ NEVER STORED                                      │   │
│  │  • Encryption key                                │   │
│  │  • Plaintext content                             │   │
│  │  • Original filename                             │   │
│  │  • URL hash fragment                             │   │
│  └──────────────────────────────────────────────────┘   │
│                                                          │
└──────────────────────────────────────────────────────────┘
```

---

## 4. Dependency Graph: New Features

```
                    ┌───────────────┐
                    │ AppSec review │ ✅ DONE
                    │ (hash-fragment│
                    │  approval)    │
                    └───────┬───────┘
                            │
               ┌────────────▼────────────┐
               │ Dev: Hash-fragment URLs │
               └────────────┬────────────┘
                            │
            ┌───────────────┼───────────────┐
            │               │               │
   ┌────────▼───────┐ ┌────▼────────┐ ┌────▼──────────┐
   │ Email sharing  │ │ Copy as text│ │ Drag-and-drop │
   │ (Gmail link)   │ │             │ │ fix           │
   └────────────────┘ └─────────────┘ └───────────────┘

               ┌─────────────────────┐
               │ Architect: i18n     │ ✅ DONE
               │ design              │
               └──────────┬──────────┘
                          │
               ┌──────────▼──────────┐
               │ Dev: i18n module    │
               └──────────┬──────────┘
                          │
            ┌─────────────┼──────────────┐
            │             │              │
   ┌────────▼──────┐ ┌───▼──────────┐ ┌─▼──────────────┐
   │ Landing page  │ │ Admin token  │ │ Theme system   │
   │ content       │ │ UI strings   │ │ (i18n-aware)   │
   └───────────────┘ └──────────────┘ └────────────────┘

               ┌────────────────────┐
               │ DevOps: AWS logging│
               └──────────┬─────────┘
                          │
               ┌──────────▼──────────┐
               │ Collector pipeline  │
               └──────────┬──────────┘
                          │
               ┌──────────▼──────────┐
               │ Event data UI       │
               └──────────┬──────────┘
                          │
               ┌──────────▼──────────┐
               │ Rate limiting       │ (deferred)
               └─────────────────────┘
```

---

## Summary: Cartographer Actions

| # | Action | Priority |
|---|---|---|
| 1 | Data flow diagrams updated (hash-fragment) | P1 — **Done above** |
| 2 | Security boundary map updated | P1 — **Done above** |
| 3 | Observability pipeline topology documented | P2 — **Done above** |
| 4 | Dependency graph for new features | P2 — **Done above** |
| 5 | Update system landscape map (full revision) | P2 — Next session |
