# v0.2.1 — Cartographer Response to MVP Infrastructure Brief

**Version:** v0.2.1
**Date:** 2026-02-10
**Role:** Cartographer
**Responding to:** `team/humans/dinis_cruz/briefs/2026-02-10/v0.1.4__briefs__focus-on-mvp-release-infrastructure.md`

---

## 1. Dependency Graph: Deployment Targets × Storage × Tests

The brief creates a three-dimensional deployment matrix. This map shows what blocks what.

### 1.1 Core Dependencies (Must Exist First)

```
┌───────────────────────────────────────────────────────────────────┐
│ LAYER 0: Foundations (already exist)                               │
│                                                                   │
│  osbot-utils (Type_Safe)  ──┐                                    │
│  osbot-fast-api             ├──▶ FastAPI app core                │
│  osbot-fast-api-serverless  ──┘                                  │
│  osbot-aws (S3 operations) ──────▶ Memory-FS S3 backend          │
│  Memory-FS (storage abstraction) ──▶ All storage modes           │
│  Web Crypto API (browser-native) ──▶ Client encryption           │
└───────────────────────────────────────────────────────────────────┘
```

### 1.2 Build Dependencies (Unblocking Order)

```
                    ┌──────────────────────┐
                    │ Fast_API app classes  │
                    │ (Admin: done)        │
                    │ (User: TODO)         │
                    └──────────┬───────────┘
                               │
              ┌────────────────┼────────────────┐
              ▼                ▼                ▼
    ┌──────────────┐  ┌──────────────┐  ┌──────────────┐
    │ Lambda entry │  │ Uvicorn entry│  │ CLI entry    │
    │ (Mangum)     │  │ (container/  │  │ (direct lib  │
    │ [DONE admin] │  │  EC2/local)  │  │  import)     │
    │ [TODO user]  │  │ [TODO]       │  │ [TODO]       │
    └──────┬───────┘  └──────┬───────┘  └──────────────┘
           │                 │
     ┌─────┴──┐        ┌────┴────┐
     ▼        ▼        ▼         ▼
  Lambda   Lambda   Docker    EC2/AMI
  deploy   URL Fn   image     systemd
  action   config   build     config
  [TODO]   [TODO]   [TODO]    [TODO]
     │        │        │         │
     │        │   ┌────┤    ┌────┘
     │        │   ▼    ▼    ▼
     │        │  Fargate  GCP Cloud Run
     │        │  [TODO]   [TODO]
     │        │
     ▼        ▼
  ┌─────────────────────────────────┐
  │ Smoke tests (per target)        │
  └─────────────────────────────────┘
```

### 1.3 What Blocks What

| Blocker | Blocks | Status |
|---|---|---|
| `Fast_API__SGraph__App__Send__User` class | User Lambda, all user-facing deployments | TODO |
| Memory-FS S3 class (Conductor provides) | Real S3 deployments | BLOCKED — waiting on Conductor |
| Uvicorn entry point module | Docker, EC2, AMI, GCP, local dev | TODO |
| Dockerfile | Fargate, GCP (both reuse container) | TODO |
| Transfer service classes | All functional tests | TODO |
| Frontend UI (upload/download pages) | E2E tests, user-visible deployments | TODO |

---

## 2. Deployment Target Topology

```
                              ┌──────────────────────────┐
                              │      SAME CODEBASE       │
                              │   sgraph_ai_app_send     │
                              └────────────┬─────────────┘
                                           │
            ┌────────────┬────────────┬────┴────┬─────────────┬──────────┐
            ▼            ▼            ▼         ▼             ▼          ▼
     ┌────────────┐┌───────────┐┌─────────┐┌────────┐┌───────────┐┌─────────┐
     │   Lambda   ││  Docker   ││  ECS    ││  EC2   ││   AMI     ││  GCP    │
     │            ││           ││ Fargate ││        ││           ││Cloud Run│
     ├────────────┤├───────────┤├─────────┤├────────┤├───────────┤├─────────┤
     │Entry:      ││Entry:     ││Entry:   ││Entry:  ││Entry:     ││Entry:   │
     │ Mangum     ││ uvicorn   ││ uvicorn ││uvicorn ││ uvicorn   ││uvicorn  │
     │            ││           ││         ││+systemd││ +systemd  ││         │
     ├────────────┤├───────────┤├─────────┤├────────┤├───────────┤├─────────┤
     │Storage:    ││Storage:   ││Storage: ││Storage:││Storage:   ││Storage: │
     │ S3         ││ any       ││ S3      ││disk/S3 ││ disk/S3   ││ S3      │
     ├────────────┤├───────────┤├─────────┤├────────┤├───────────┤├─────────┤
     │Scaling:    ││Scaling:   ││Scaling: ││Scaling:││Scaling:   ││Scaling: │
     │ auto       ││ manual    ││ auto    ││ none   ││ launch    ││ auto    │
     ├────────────┤├───────────┤├─────────┤├────────┤├───────────┤├─────────┤
     │HTTPS:      ││HTTPS:     ││HTTPS:   ││HTTPS:  ││HTTPS:     ││HTTPS:   │
     │Lambda URL  ││port 8080  ││ALB/NLB  ││ ELB   ││ ELB       ││built-in │
     └────────────┘└───────────┘└─────────┘└────────┘└───────────┘└─────────┘
            │            │            │         │           │          │
            └────────────┴────────────┴────┬────┴───────────┴──────────┘
                                           │
                              ┌────────────▼─────────────┐
                              │    Memory-FS (shared)    │
                              │  Same interface, any     │
                              │  backend                 │
                              └──────────────────────────┘
```

**Key insight:** Docker, Fargate, and GCP Cloud Run share the same container image. EC2 and AMI share the same systemd configuration. This means there are really **4 unique deployment patterns**, not 7:
1. Lambda (Mangum)
2. Container (uvicorn in Docker → Fargate, GCP reuse)
3. Server (uvicorn + systemd → EC2, AMI reuse)
4. CLI (direct library import)

---

## 3. Test Level × Storage Mode Map

```
                              Storage Mode
                    ┌──────────┬──────────┬──────────┐
                    │ Memory   │ Disk     │ S3       │
Test       ┌───────┼──────────┼──────────┼──────────┤
Level      │Unit   │ ● ALL    │          │          │
           ├───────┼──────────┼──────────┼──────────┤
           │Integ  │ ●        │ ●        │ ● Local  │
           │       │          │          │   Stack  │
           ├───────┼──────────┼──────────┼──────────┤
           │E2E    │ ● local  │          │ ● Lambda │
           ├───────┼──────────┼──────────┼──────────┤
           │Post-  │ ●        │ ●        │          │
           │publish│          │          │          │
           ├───────┼──────────┼──────────┼──────────┤
           │Smoke  │          │          │ ● all    │
           │       │          │          │   targets│
           └───────┴──────────┴──────────┴──────────┘

● = test cell exists in the matrix
```

---

## 4. CI/CD Pipeline Flow Map

```
┌──────────┐
│  git     │
│  push    │
│  to dev  │
└────┬─────┘
     │
     ▼
┌──────────────────────────────────────────────────────────────────┐
│  STAGE 1: Validate                                                │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────────┐       │
│  │ Unit Tests   │  │ Integration  │  │ Lint / Type      │       │
│  │ (memory)     │  │ Tests        │  │ Check            │       │
│  │ ~2s          │  │ (LocalStack) │  │                  │       │
│  │ [WORKING]    │  │ [TODO]       │  │ [TODO]           │       │
│  └──────┬───────┘  └──────┬───────┘  └──────┬───────────┘       │
│         └──────────────────┼─────────────────┘                   │
│                            ▼                                     │
│                    ┌──────────────┐                               │
│                    │ All Pass?    │──No──▶ BLOCK                 │
│                    └──────┬───────┘                               │
│                           │ Yes                                  │
└───────────────────────────┼──────────────────────────────────────┘
                            ▼
┌──────────────────────────────────────────────────────────────────┐
│  STAGE 2: Build                                                   │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐           │
│  │ Increment    │  │ Build Docker │  │ Package      │           │
│  │ Tag          │  │ Image        │  │ Lambda       │           │
│  │ [WORKING]    │  │ [TODO]       │  │ [TODO]       │           │
│  └──────────────┘  └──────────────┘  └──────────────┘           │
└───────────────────────────┼──────────────────────────────────────┘
                            ▼
┌──────────────────────────────────────────────────────────────────┐
│  STAGE 3: Deploy (parallel per target)                            │
│  ┌────────┐ ┌────────┐ ┌────────┐ ┌────┐ ┌─────┐ ┌─────┐      │
│  │Lambda  │ │Docker  │ │Fargate │ │EC2 │ │ AMI │ │ GCP │      │
│  │[TODO]  │ │[TODO]  │ │[TODO]  │ │[T] │ │ [T] │ │ [T] │      │
│  └───┬────┘ └───┬────┘ └───┬────┘ └─┬──┘ └──┬──┘ └──┬──┘      │
│      ▼          ▼          ▼        ▼       ▼       ▼           │
│  ┌────────┐ ┌────────┐ ┌────────┐ ┌────┐ ┌─────┐ ┌─────┐      │
│  │Smoke   │ │Smoke   │ │Smoke   │ │Smk │ │Smk  │ │Smk  │      │
│  │Test    │ │Test    │ │Test    │ │Test│ │Test │ │Test │      │
│  └────────┘ └────────┘ └────────┘ └────┘ └─────┘ └─────┘      │
└───────────────────────────┼──────────────────────────────────────┘
                            ▼
┌──────────────────────────────────────────────────────────────────┐
│  STAGE 4: E2E (against deployed targets)                          │
│  ┌──────────────────────────────────┐                            │
│  │ Playwright E2E against Lambda    │                            │
│  │ [TODO]                           │                            │
│  └──────────────────────────────────┘                            │
└──────────────────────────────────────────────────────────────────┘
```

---

## 5. Data Flow Across Deployment Targets

Regardless of deployment target, the data flow is identical:

```
Browser ──encrypted bytes──▶ [ANY TARGET] ──▶ Memory-FS ──▶ [configured backend]
Browser ◀──encrypted bytes── [ANY TARGET] ◀── Memory-FS ◀── [configured backend]

The target is just a different way to host the same FastAPI application.
The storage backend is just a different Memory-FS provider.
These two dimensions are completely independent.
```

---

## 6. Action Items for Cartographer

- [ ] Update system landscape map v0.1.2 to add deployment target matrix
- [ ] Create deployment-specific topology diagrams per target
- [ ] Map the CI/CD pipeline stages with status indicators
- [ ] Document the container image sharing pattern (Docker → Fargate, GCP)
- [ ] Create a "critical path" diagram showing what blocks MVP delivery

---

*This review is the Cartographer master file for the v0.1.4 infrastructure brief response.*
