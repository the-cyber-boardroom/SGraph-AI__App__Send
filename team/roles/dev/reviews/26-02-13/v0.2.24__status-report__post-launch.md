# Dev Status Report -- Post-Launch

**version** v0.2.24
**date** 13 Feb 2026
**role** Dev
**context** SGraph Send is live at send.sgraph.ai

---

## What Shipped

The live system delivers end-to-end encrypted file transfer on AWS Lambda (Function URL, no API Gateway). Key implementation work completed since the MVP review:

- **Per-route auth** -- disabled the global `osbot-fast-api` middleware; `check_access_token()` now guards only the mutating routes (`create`, `upload`, `complete`). Read-only routes (`info`, `download`) remain open by design.
- **`send-access-gate` web component** -- IFD pattern, zero framework dependencies. Prompts for the access token before the upload workflow is exposed.
- **LaunchList embed forms + Google Analytics tags** -- ready for the friendlies invite flow.
- **Root redirect** -- `/` now redirects to the latest versioned send page (`/send/v0/v0.1/v0.1.0/index.html`).
- **Test setup updated** -- tests inject the access token header so the full auth path is exercised. 56 tests pass in ~2.4s, all real implementations (no mocks, in-memory Memory-FS).

**Stack in production:** FastAPI via `osbot-fast-api` / `osbot-fast-api-serverless`, `Type_Safe` (not Pydantic), `Storage_FS` (Memory-FS), Web Crypto API (AES-256-GCM, client-side), Vanilla JS Web Components.

---

## What Is Ready to Start NOW

| # | Workstream | Ready? | Blocker |
|---|-----------|--------|---------|
| WS-13 | Sharing UX (3 modes) | Yes | None -- pure frontend + minor backend |
| WS-10 | Text mode | Yes | None -- same encryption pipeline, new input |
| WS-15 | Code quality (Type_Safe refactor) | Yes | None -- todos already annotated in source |
| WS-14 | Foundation (SPA, URL nav, i18n, themes) | Partially | Architect design needed for SPA routing split and i18n content structure |
| WS-7  | UI/Design improvements | Partially | No Designer role active yet; Dev can start structural work but not brand/visual |

---

## Recommended Priority Order

**Criterion:** maximum user impact for the friendlies launch.

### 1. WS-13: Sharing UX (three modes)

This is the single highest-impact change for friendlies. Right now users must copy/paste the transfer ID and decryption key separately. That is the friction point most likely to cause drop-off.

**Three modes to ship:**

| Mode | Description | Effort |
|------|------------|--------|
| Copy/paste (current) | Already works. Keep as "most secure" option. | Done |
| URL with hash fragment (`#key`) | Transfer ID in path, key in `#` fragment (never sent to server). Generates a single shareable link. | Small (frontend only, ~1 day) |
| Email template | Pre-filled body with URL, individual components, and explanation text. `mailto:` link with pre-filled body. | Small (~0.5 day after Mode 2) |

**Effort estimate: Small (1--2 days).** Almost entirely frontend. The backend already returns everything needed. The hash-fragment approach needs AppSec sign-off (already flagged in WS-13 brief, and the daily brief from 12 Feb explicitly requests the threat model).

### 2. WS-10: Text Mode

Immediate usability win. The encryption pipeline is identical; only the input changes from file-drop to textarea. Dinis explicitly prioritised this as "first" in the public-key/text-mode brief (v0.2.16).

**What to build:**

- Add a textarea input alongside the existing file drop zone (tab or toggle).
- On submit, convert the text to a `Blob`, feed it into the same `crypto.js` encrypt path.
- Download side: detect content type, render as text in the browser instead of triggering a file save.

**Effort estimate: Small (1--2 days).** Frontend-dominant. Backend already handles arbitrary binary payloads. The only backend consideration is whether to store a content-type hint of `text/plain` to enable the render-in-browser behaviour on download.

### 3. WS-15: Code Quality (Type_Safe Refactor)

Not user-visible, but critical for velocity and correctness. The 13-phase execution plan from the v0.2.15 backend briefing is well-defined. The source code already has 50+ `# todo` annotations from Dinis's review pointing at every instance.

**Scope summary:**

- Replace raw `dict` with `Type_Safe` classes (`Transfer__Record`, `Schema__Transfer__Transparency`, event classes).
- Replace raw primitives (`str`, `int`) with safe primitives (`Transfer_Id`, `Safe_UInt__FileSize`, `Timestamp_Now`, `Enum__Transfer__Status`).
- Add `@type_safe` decorator to all public service methods.
- Split `Schema__Transfer.py` into one class per file (scaffolding files already exist: `Transfer_Id.py`, `Enum__Transfer__Status.py`, `Schema__Transfer__Event.py`, `Schema__Transfer__Transparency.py`).
- Migrate in-memory dict storage patterns to Memory-FS abstraction.
- Restructure tests: rename `test_Routes__Transfers` to `test_Routes__Transfers__client`, create direct-method test class, add test helper for fixture data.

**Effort estimate: Medium (3--5 days).** The plan is prescriptive (Phases 1--13 in the briefing). The risk is low because the 56 existing tests cover the full transfer lifecycle and will catch regressions immediately.

---

## Tech Debt and Code Quality Concerns in the Live System

### High priority

1. **50+ `# todo` annotations in production code.** `Transfer__Service.py` alone has 30+ todos. Every method uses raw `dict` instead of `Type_Safe` classes, raw `str` instead of safe primitives, and `datetime.now().isoformat()` instead of `Timestamp_Now()`. This is the single largest debt surface.

2. **No `@type_safe` decorator on any service method.** Method parameters are untyped. A caller can pass anything -- wrong types will produce silent corruption rather than fast failure.

3. **Hardcoded URLs in the service layer.** `upload_url` and `download_url` are string-concatenated inside `Transfer__Service`. The service should not know about URL structure; the routes layer should derive URLs from the transfer ID.

4. **Injection surface in error messages.** `Routes__Transfers` does not reflect `transfer_id` in HTTP error details (good), but the pattern should be audited as more routes are added. The broader AppSec review (flagged in v0.2.15 briefing) has not yet been completed.

### Medium priority

5. **`Send__Config` reads env vars in `__init__` and in `resolve_storage_mode()`.** Env var access should be centralised through a service registry pattern, not scattered across constructors.

6. **Single-file schema module.** `Schema__Transfer.py` still contains 5 schema classes. Scaffolding files exist (`Transfer_Id.py`, `Enum__Transfer__Status.py`, etc.) but the actual classes have not been moved yet.

7. **IP hashing uses bare `hashlib.sha256` inline.** Should use `Cache__Hash__Generator` from `osbot-utils` or a dedicated class. Current implementation has no daily salt rotation (the design doc specifies daily salt).

8. **Static route setup is inline in `Fast_API__SGraph__App__Send__User`.** The `setup_static_routes` method should be extracted to a dedicated class, per the existing `# todo` annotation.

### Low priority (not blocking friendlies)

9. **No SPA routing yet.** All paths resolve to specific files. Multi-page navigation will require SPA routing with a catch-all that serves `index.html` for app routes while still serving static assets directly.

10. **No test for the `send-access-gate` component.** The web component works in production but has no automated test coverage (Playwright E2E would be the appropriate test level).

---

## Immediate Next Actions

| Action | Owner | Dependency |
|--------|-------|-----------|
| Implement URL-with-hash sharing mode | Dev | AppSec sign-off on hash fragment security |
| Implement email template sharing mode | Dev | URL-with-hash mode (builds on it) |
| Implement text mode input | Dev | None |
| Begin Type_Safe refactor Phase 1 (review all todos) | Dev | Read Type_Safe guides first (mandatory) |
| Request AppSec threat model for hash fragment approach | Dev -> AppSec | None (already flagged, needs activation) |

---

## References

| Document | Path |
|----------|------|
| MVP review (Dinis) | `team/humans/dinis_cruz/briefs/02/12/v0.2.10__review-of-user-site-mvp.md` |
| Backend tasks briefing | `team/roles/dev/reviews/26-02-12/v0.2.15__briefing__mvp-review-backend-tasks.md` |
| Friendlies daily brief | `team/humans/dinis_cruz/briefs/02/12/v0.2.16__daily-brief__sgraph-send-next-mvp-friendlies.md` |
| Text mode / public key brief | `team/humans/dinis_cruz/briefs/02/12/v0.2.16__briefs__sgraph-send-public-key-text-mode-self-hosted.md` |
| Master index (v0.2.15) | `team/roles/librarian/reviews/26-02-12/v0.2.15__master-index__mvp-review-briefings.md` |
| Transfer__Service.py | `sgraph_ai_app_send/lambda__user/service/Transfer__Service.py` |
| Routes__Transfers.py | `sgraph_ai_app_send/lambda__user/fast_api/routes/Routes__Transfers.py` |
| Schema__Transfer.py | `sgraph_ai_app_send/lambda__user/schemas/Schema__Transfer.py` |
