# v0.2.24 — Dev Response to Daily Brief (13 Feb 2026)

**Version:** v0.2.24
**Date:** 2026-02-13
**Role:** Dev
**Context:** Response to `team/humans/dinis_cruz/briefs/02/13/v0.2.16__daily-brief__sgraph-send-13-feb-2026.md`

---

## 1. Implementation Plan: Hash-Fragment URLs (P1)

**Status:** Ready to implement pending AppSec approval (now received — APPROVED).

### Changes Required

**File: `components/send-upload/send-upload.js`**
- Modify the success result display to generate the combined URL format:
  ```
  https://send.sgraph.ai/send/v0/v0.1/v0.1.0/download.html#{transferId}/{base64urlKey}
  ```
- Replace the two separate "copy" buttons (link + key) with a single "Copy link" button
- Keep a "Show key separately" toggle for advanced users who want split sharing
- Update guidance text: "Share this link — the recipient can open it to access the file"

**File: `components/send-download/send-download.js`**
- Add hash-fragment parsing on load:
  ```javascript
  parseHashFragment() {
      const hash = window.location.hash.substring(1);
      const slashIndex = hash.indexOf('/');
      if (slashIndex > 0) {
          this.transferId = hash.substring(0, slashIndex);
          this.keyString = hash.substring(slashIndex + 1);
      }
  }
  ```
- Auto-populate key input if present in hash
- Auto-trigger info fetch if transfer ID found
- After successful decryption: `history.replaceState(null, '', window.location.pathname)` (per AppSec)
- Maintain fallback: `?id=xxx` query param + manual key input still works

**File: `components/send-download/send-download.js`** (download filename)
- Currently saves as generic `'download'` — keep this for now (original filename never sent to server)
- Future: sender could optionally include filename hint in the hash (not server-visible)

### Estimated Effort
Small — 2-3 hours. Mostly UI string changes and hash parsing logic.

---

## 2. Implementation Plan: Text Input (P1)

### Changes Required

**File: `components/send-upload/send-upload.js`**
- Add input mode toggle (tabs or buttons): "File" | "Text"
- In text mode, show a `<textarea>` instead of the drag-and-drop zone
- On submit in text mode:
  ```javascript
  const textBytes = new TextEncoder().encode(this.textContent);
  const encrypted = await SendCrypto.encryptFile(textBytes, key);
  ```
- The rest of the upload pipeline is identical (create → upload → complete)
- Store `content_type: 'text/plain'` in transfer metadata (backend change needed)

**File: `components/send-download/send-download.js`**
- After decryption, check content type:
  - If `text/*` → display decrypted text in a `<pre>` element (using `textContent`, not `innerHTML` — per AppSec)
  - Provide "Copy to clipboard" button for text content
  - Still offer "Download as file" as secondary action
  - If file → current download-as-file behaviour

**Backend: `sgraph_ai_app_send/lambda__user/schemas/Schema__Transfer.py`**
- Add `content_type: str` field (default: `'application/octet-stream'`)
- Set to `'text/plain'` when text mode is used

**Backend: `Routes__Transfers.py`**
- Accept optional `content_type` in create request
- Return `content_type` in info response

### Estimated Effort
Medium — 4-6 hours. Frontend tab UI + text encoding + backend schema addition + download-side rendering.

---

## 3. Implementation Plan: Admin Token UI (P2)

### Three Admin Pages

**3a. Token Creation**
- Form: batch size (1-50), optional expiry, optional notes
- Generates N tokens (UUID v4 via `crypto.randomUUID()`)
- Calls admin API: `POST /admin/tokens/create` with batch config
- Displays generated tokens with copy buttons

**3b. Token Visualisation**
- Table/list of all tokens with columns: token (truncated), status, created, used, expires
- Filter by status: all, active, used, revoked, expired
- Calls admin API: `GET /admin/tokens`

**3c. Token Sharing**
- For each active token, generate shareable URL: `https://send.sgraph.ai/?token={token_id}`
- "Copy link" button per token
- "Copy all links" for batch sharing
- "Open in Gmail" — `mailto:?subject=...&body=...` with the token URL

### Backend Routes (Admin Lambda)

```python
POST /admin/tokens/create    → create batch of tokens
GET  /admin/tokens            → list all tokens (with filter params)
POST /admin/tokens/{id}/revoke → revoke a token
```

### Storage

Per Architect schema: `/tokens/{token_id}/token.json` in Memory-FS.

### Estimated Effort
Medium-Large — 8-12 hours. Three UI pages + three backend endpoints + storage layer.

---

## 4. Fix: Drag-and-Drop of Download Link (P2)

### Investigation Needed

The download link should be draggable from the success panel into email compose, chat, etc. Possible issues:
- The link might be rendered as a `<span>` with click-to-copy instead of an `<a>` element
- Need to ensure the result panel has a proper `<a href="...">` element that browsers treat as draggable
- May need `draggable="true"` attribute and proper `dragstart` event handling

### Fix Approach
- Render the download URL as a clickable `<a>` element (not just text)
- Test drag-and-drop from Chrome, Firefox, Safari into Gmail compose, Slack, etc.

### Estimated Effort
Small — 1-2 hours investigation + fix.

---

## 5. Implementation Plan: Observability — Event Data UI (P2)

### Current State
- Transfer events already exist: `Schema__Transfer__Event` tracks created, viewed, downloaded
- Events are stored per-transfer in Memory-FS

### UI Addition
- On the download page (after info fetch), show event timeline:
  - "Created: 13 Feb 2026, 10:30 AM"
  - "Viewed: 13 Feb 2026, 11:15 AM"
  - "Downloaded: 13 Feb 2026, 11:16 AM"
- Simple list format, no complex charting needed for MVP
- DPO review required before shipping (per AppSec recommendation)

### Estimated Effort
Small — 2-3 hours. Events already exist, just need UI rendering.

---

## 6. Implementation Plan: Email Sharing (P2)

### Two Sharing Options

**Copy as Text:**
```
I'm sending you a secure file via SGraph Send.

Click this link to access it:
https://send.sgraph.ai/send/v0/v0.1/v0.1.0/download.html#{id}/{key}

The file is encrypted in your browser — only you can see the contents.
```

**Open in Gmail:**
```javascript
const subject = encodeURIComponent('Secure file for you');
const body = encodeURIComponent(emailTemplate);
window.open(`https://mail.google.com/mail/?view=cm&su=${subject}&body=${body}`);
```

### UI
- After upload success, show sharing panel with two buttons:
  - "Copy message" — copies formatted text to clipboard
  - "Share via Gmail" — opens Gmail compose
- Journalist to provide final copy for the email template

### Estimated Effort
Small — 2-3 hours.

---

## 7. Foundation: i18n Integration (P2)

### Approach (per Architect)
- Create `js/i18n.js` module with `t('key')` function
- Create `i18n/en.json` and `i18n/pt.json`
- Refactor all component `render()` methods to use `t()` instead of hardcoded strings
- Language selector in page header
- Persist to `localStorage`

### Migration Plan
1. Extract all current hardcoded strings into `en.json` (there are ~40-50 strings across components)
2. Create `i18n.js` loader
3. Update each component's `render()` method
4. Create Portuguese translation (Journalist to provide)
5. Add language selector component

### Estimated Effort
Medium — 6-8 hours. Mostly mechanical string extraction + component updates.

---

## 8. Foundation: Theme System (P2)

### Approach
- Extend existing CSS custom properties in `common.css`
- Add `data-theme` attribute on `<html>` element
- Five themes: light (default), dark, high-contrast, aurora, glacier, ember
- Theme switcher component in page header
- Persist to `localStorage`
- Respect `prefers-color-scheme` for initial default

### Implementation
1. Define colour palettes for all 5 themes as CSS variable blocks (Designer to provide values)
2. Add `theme-manager.js` for switching logic
3. Add theme selector component
4. Test all components render correctly in each theme

### Estimated Effort
Medium — 6-8 hours. CSS variable definitions + switcher + testing across themes.

---

## Priority Sequencing (Dev Perspective)

| Order | Task | Priority | Blocks | Est. Hours |
|-------|------|----------|--------|------------|
| 1 | Hash-fragment URLs | P1 | Sharing UX, email sharing | 2-3h |
| 2 | Text input | P1 | First-time user testing | 4-6h |
| 3 | i18n foundation | P2 | All new UI content | 6-8h |
| 4 | Landing page content (with i18n) | P2 | User onboarding | 3-4h |
| 5 | Email sharing | P2 | Viral loop | 2-3h |
| 6 | Admin token UI | P2 | Waitlist onboarding | 8-12h |
| 7 | Event data UI | P2 | User transparency | 2-3h |
| 8 | Theme system | P2 | Accessibility | 6-8h |
| 9 | Drag-and-drop fix | P2 | Minor UX | 1-2h |

**Recommended:** Do hash-fragment URLs first (small, high impact, unblocks email sharing), then text input (P1), then i18n (architectural foundation before more content).
