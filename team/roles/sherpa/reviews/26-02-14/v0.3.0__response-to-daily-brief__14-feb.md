# Sherpa Response to v0.3.0 Daily Brief

**Version:** v0.3.0
**Date:** 14 February 2026
**Role:** Sherpa
**Trigger:** v0.3.0 daily brief -- directive #11: "Map admin user journey. Identify friction points in token management workflow."
**Previous:** `team/roles/sherpa/reviews/26-02-13/v0.2.33__first-time-user-journey-map-and-friction-log.md`

---

## 1. Admin User Journey Map

The admin console is a single-user tool at this stage. Dinis Cruz is the primary (and only) admin user. The journey map reflects his specific needs and workflow patterns.

### Persona: Admin (Dinis Cruz)

| Field | Value |
|-------|-------|
| **Technical level** | Expert -- writes code, reads logs, uses Swagger, comfortable with curl |
| **Primary goals** | Create tokens for communities/individuals, monitor usage, revoke compromised tokens, check system health |
| **Context** | Accesses admin console from laptop, typically during work sessions. May also check from mobile for quick status |
| **Current workaround** | Uses Swagger UI at `/docs` and direct API calls with API key header |
| **Mental model** | "I need a dashboard that shows me what is happening and lets me manage access" |

### Stage A1: Access Admin Console

| Field | Value |
|-------|-------|
| **URL** | `{admin-lambda-url}/admin` |
| **What the admin sees** | Browser redirects to `/admin/v0/v0.1/v0.1.0/index.html` |
| **Expected experience** | Page loads in under 2 seconds. Dashboard shows system overview immediately. |
| **Authentication** | The admin Lambda enforces API key authentication. The admin UI must include the API key in every API request. |
| **Key question** | How does the admin authenticate in the browser? The API key must be provided somehow -- either via a login form that stores it in memory, a URL parameter, or a browser extension. |
| **Trail signal** | Admin page load event, authentication attempt (success/failure) |

**Friction risk (AF-001):** The admin Lambda uses API key auth (header-based). Browser-based UIs cannot easily set custom headers on navigation requests. The static HTML page will load (served by StaticFiles, no auth needed), but every subsequent API call from JavaScript must include the API key header. The admin needs a way to enter and store the API key for the session. This is the first friction point the admin UI must solve.

### Stage A2: View Dashboard (System Health)

| Field | Value |
|-------|-------|
| **What the admin sees** | System version, service info, request count pulse, active token count |
| **API calls** | `GET /config/version`, `GET /health/pulse?window_minutes=60` |
| **Expected experience** | At-a-glance health status. Green/amber/red indicators. No need to interpret raw numbers. |
| **Trail signal** | Dashboard load event, which widgets rendered, time to first meaningful paint |

### Stage A3: View Token List

| Field | Value |
|-------|-------|
| **What the admin sees** | Table of all tokens with columns: name, status, usage (count/limit), created by, actions |
| **API call** | `GET /tokens/list` |
| **Expected experience** | Sortable table. Status badges (active = green, exhausted = amber, revoked = red). Quick scan to identify tokens needing attention. |
| **Trail signal** | Token list loaded, number of tokens displayed, sort/filter actions |

### Stage A4: Create Token

| Field | Value |
|-------|-------|
| **What the admin sees** | Form with fields: token name, usage limit (default 50), created by, metadata (optional key-value pairs) |
| **API call** | `POST /tokens/create` with `Schema__Token__Create__Request` body |
| **Expected experience** | Fill in name and limit. Click create. See confirmation with the share URL template. Copy the share URL. |
| **Trail signal** | Token creation event, token name pattern, usage limit chosen, time to complete form |

### Stage A5: View Token Details

| Field | Value |
|-------|-------|
| **What the admin sees** | Full token metadata: name, status, usage count vs limit, progress bar, created by, creation timestamp, usage event log |
| **API call** | `GET /tokens/lookup/{token_name}` |
| **Expected experience** | See exactly who is using this token and how. Usage history shows IP hashes, actions, timestamps. Progress towards limit is visually clear. |
| **Trail signal** | Token detail view event, which token viewed, time spent on detail page |

### Stage A6: Revoke Token

| Field | Value |
|-------|-------|
| **What the admin sees** | Confirmation dialog: "Revoke token {name}? This will immediately prevent all further use." |
| **API call** | `POST /tokens/revoke/{token_name}` |
| **Expected experience** | One-click revoke with confirmation. Immediate effect. Token list updates to show revoked status. |
| **Trail signal** | Token revocation event, which token revoked, time between viewing detail and revoking |

### Stage A7: Monitor Analytics

| Field | Value |
|-------|-------|
| **What the admin sees** | Request count over configurable time window. Pulse metrics showing system activity. |
| **API call** | `GET /health/pulse?window_minutes=N` |
| **Expected experience** | Quick check that the system is being used. Spike detection for unusual activity. |
| **Trail signal** | Analytics view event, time window selected, frequency of checks |

---

## 2. Token Management Workflow Friction Analysis

### Workflow 1: Create and Distribute a Token

**Steps:**
1. Open admin console
2. Navigate to token creation
3. Enter token name (e.g., `community-owasp`)
4. Set usage limit (e.g., 1000)
5. Click create
6. Copy the generated share URL: `send.sgraph.ai/t/community-owasp/{transfer_id}#key`
7. Send the URL to the community contact

**Friction points:**

| ID | Friction | Severity | Stage | Description |
|----|----------|----------|-------|-------------|
| AF-001 | API key entry | HIGH | A1 | Admin must provide API key to authenticate. No login form exists yet. Without this, no API calls work from the browser. |
| AF-002 | Share URL not auto-generated | MEDIUM | A4 | After creating a token, the admin gets a JSON response with the token metadata but no ready-to-share URL. The admin must manually construct the share URL by combining the domain, token name, and transfer path. |
| AF-003 | No bulk token creation | LOW | A4 | Creating tokens for multiple communities requires repeating the form for each one. Not a problem at current scale (single-digit communities) but will become friction at scale. |
| AF-004 | Token name validation feedback | LOW | A4 | If the token name already exists, the API returns 409. The UI should prevent submission and show inline validation before the API call. |

### Workflow 2: Monitor and Manage Active Tokens

**Steps:**
1. Open admin console
2. View token list
3. Identify tokens nearing exhaustion
4. Decide: increase limit, create replacement, or let expire
5. For compromised tokens: revoke immediately

**Friction points:**

| ID | Friction | Severity | Stage | Description |
|----|----------|----------|-------|-------------|
| AF-005 | No usage alerts | MEDIUM | A3 | The admin must manually check the token list to discover tokens nearing exhaustion. No proactive notification exists. At current scale this is manageable but becomes unreliable beyond 20 tokens. |
| AF-006 | No limit increase capability | MEDIUM | A3 | Once a token is created, its usage limit cannot be changed. To extend a community's allocation, the admin must create a new token and distribute a new URL. This breaks any existing shared links. |
| AF-007 | Revocation is permanent | LOW | A6 | There is no "suspend" state. Revoking a token is irreversible. If the admin accidentally revokes the wrong token, they must create a new one and redistribute. |
| AF-008 | No usage timeline | LOW | A5 | Token detail shows current count vs limit but no temporal distribution. The admin cannot see "50 uses in the last hour" vs "50 uses spread over a week" -- both show the same number. |

### Workflow 3: Incident Response (Token Compromise)

**Steps:**
1. Detect unusual usage (via analytics or external report)
2. Identify which token is affected
3. Revoke the compromised token
4. Create replacement token
5. Notify legitimate users of the new token

**Friction points:**

| ID | Friction | Severity | Stage | Description |
|----|----------|----------|-------|-------------|
| AF-009 | No anomaly detection | MEDIUM | A7 | The admin must manually spot unusual patterns. The pulse endpoint shows aggregate counts, not per-token anomalies. A token being brute-forced would not be visible until the admin happens to check that specific token. |
| AF-010 | No IP hash analysis | LOW | A5 | Usage events record IP hashes but the admin UI has no way to group or analyse them. "Is this one user using the token 100 times or 100 different users?" is not answerable from the current data display. |

---

## 3. Key Friction Points -- Priority Ranking

| Priority | ID | Friction | Impact | Recommendation |
|----------|----|----------|--------|----------------|
| **P1** | AF-001 | API key entry | Blocks all admin UI functionality | Build a simple session-scoped API key entry form. Store in JavaScript memory (not localStorage). Clear on tab close. |
| **P2** | AF-002 | No auto-generated share URL | Slows token distribution | After token creation, display the share URL template with a copy button: `send.sgraph.ai/t/{token_name}/` |
| **P2** | AF-005 | No usage alerts | Risk of silent token exhaustion | Add visual indicators in the token list: green (< 50% used), amber (50-80%), red (> 80%), grey (exhausted/revoked) |
| **P3** | AF-006 | No limit increase | Forces new token creation for extensions | Future API enhancement: `POST /tokens/extend/{token_name}` to increase limit |
| **P3** | AF-009 | No anomaly detection | Delayed incident detection | Future: add per-token usage rate to pulse endpoint |
| **P4** | AF-003 | No bulk creation | Minor friction at current scale | Defer until token count exceeds 20 |
| **P4** | AF-004 | Token name validation | Minor UX polish | Add inline check before submit |
| **P4** | AF-007 | No suspend state | Minor risk of accidental revocation | Add confirmation dialog; consider suspend/resume later |
| **P4** | AF-008 | No usage timeline | Limited forensics capability | Defer to v0.4.x analytics enhancement |
| **P4** | AF-010 | No IP hash analysis | Limited forensics capability | Defer to v0.4.x analytics enhancement |

---

## 4. Recommended Telemetry Events for Admin Actions

### Admin Console Events

These events should be captured by the `Middleware__Analytics` on the admin Lambda to enable trail observation of admin behaviour.

| Event Name | Trigger | Data Fields | Purpose |
|------------|---------|-------------|---------|
| `admin.console.loaded` | Admin UI index.html loaded | `timestamp`, `user_agent`, `ip_hash` | Track admin access patterns |
| `admin.auth.attempt` | API key submitted | `timestamp`, `ip_hash`, `success` | Detect unauthorized access attempts |
| `admin.auth.failure` | Invalid API key | `timestamp`, `ip_hash` | Security alerting -- multiple failures may indicate brute force |
| `admin.token.created` | Token created via UI | `timestamp`, `token_name`, `usage_limit`, `created_by` | Audit trail for token lifecycle |
| `admin.token.viewed` | Token detail page opened | `timestamp`, `token_name` | Track which tokens receive attention |
| `admin.token.revoked` | Token revoked via UI | `timestamp`, `token_name`, `ip_hash` | Critical audit event |
| `admin.token.list.viewed` | Token list page loaded | `timestamp`, `token_count` | Admin activity tracking |
| `admin.pulse.viewed` | Analytics pulse viewed | `timestamp`, `window_minutes` | How often admin checks health |
| `admin.session.duration` | Admin closes console | `timestamp`, `duration_seconds`, `actions_count` | Session quality metric |

### Why These Events Matter

The admin console is currently single-user (Dinis), but the telemetry infrastructure should be built for the future when multiple admins may exist. Every admin action is a potential audit trail entry. The events above enable:

1. **Access auditing** -- Who accessed the admin console, when, from where
2. **Action auditing** -- What tokens were created, modified, revoked, and by whom
3. **Anomaly detection** -- Unusual access patterns (time of day, frequency, failed auth attempts)
4. **Usage insights** -- How often the admin checks the console, which views are most used

### Implementation Note

These events should flow through the same `Middleware__Analytics` that captures all HTTP requests. The admin UI JavaScript should NOT send custom analytics events to a separate endpoint -- the server-side middleware captures what is needed from the HTTP requests themselves. This preserves the zero-cookie, zero-client-tracking architecture.

---

## 5. Trail Observation Plan for Admin Console Usage

### Phase 1: Baseline (v0.3.0 Launch)

**Duration:** First 7 days after admin UI ships
**Goal:** Establish baseline admin usage patterns

| Observation | Method | Frequency |
|-------------|--------|-----------|
| Admin console access frequency | Server logs (admin Lambda) | Daily review |
| Most common admin actions | HTTP request paths in Middleware__Analytics | Daily review |
| Average session duration | Time between first and last request per IP hash | Weekly summary |
| Error rate on admin endpoints | HTTP 4xx/5xx response codes | Daily review |
| Token management velocity | Token create/revoke events per day | Weekly summary |

### Phase 2: Pattern Recognition (Week 2-4)

**Goal:** Identify admin workflow patterns and optimisation opportunities

| Observation | What to Look For | Action if Found |
|-------------|-----------------|-----------------|
| Repeated path sequences | Admin always views list, then views specific token, then goes back -- indicates navigation friction | Recommend quick-action buttons in list view |
| Time between token creation and next action | Long gap after creation suggests the admin is copy-pasting the URL elsewhere | Confirm AF-002 recommendation (auto-generate share URL) |
| Pulse check frequency | If admin checks pulse multiple times per session | Recommend auto-refresh or real-time update |
| Failed API calls | 401s from browser indicate API key issues | Confirm AF-001 severity |
| Token list refresh frequency | Multiple `GET /tokens/list` calls in short succession | Add auto-refresh or "last updated" timestamp |

### Phase 3: Side Effect Detection (Ongoing)

**Goal:** Detect when admin UI changes affect admin behaviour

After each admin UI update:
1. Compare admin access frequency (before vs after)
2. Compare average session duration (should decrease with better UX)
3. Compare error rate (should decrease)
4. Compare time-to-complete for key workflows (create token, revoke token)
5. Check for new abandonment patterns (admin opens console but does not complete intended action)

### Trail Data Storage

Admin trail data is stored in the same MGraph-AI Cache Service as user trail data, under the `analytics/` key prefix. The `Middleware__Analytics` captures:
- Timestamp
- Request method and path
- Response status code
- IP hash (SHA-256 with daily salt)
- User agent

This data is sufficient for the trail observations described above. No additional instrumentation is needed for Phase 1.

---

## 6. Cross-Role Recommendations

### For Dev (Admin UI Implementation)

1. **Solve AF-001 first.** Without API key entry, the admin console is non-functional. Recommend a simple approach: on first load, show an API key input form. On submit, store the key in a JavaScript variable (not localStorage, not cookies). Include the key in all subsequent `fetch()` calls as a custom header. Clear on page unload.

2. **Token creation should output a share URL.** After `POST /tokens/create` succeeds, display: `send.sgraph.ai/t/{token_name}/` with a copy button. The admin should never have to manually construct a URL.

3. **Status badges in the token list.** Use colour-coded badges: green (active, < 50% used), amber (active, 50-80% used), red (active, > 80% used), grey (exhausted), black (revoked). This gives instant visual scan capability.

### For Architect

1. **AF-006 (limit increase)** requires an API design decision. Options: (a) new endpoint `POST /tokens/extend/{token_name}` with a `new_limit` field, (b) generic `PATCH /tokens/{token_name}` for any metadata update. Recommend (a) for auditability -- "token extended" is a distinct event from "token updated".

2. **Consider an admin session model.** Currently the API key is sent with every request. A session token (short-lived, server-generated) would reduce the risk of the API key being logged in browser history or dev tools. This is a v0.4.x consideration.

### For AppSec

1. **Verify API key is not exposed in browser.** The admin UI JavaScript will contain logic to include the API key in request headers. Ensure: (a) the key is not stored in localStorage or sessionStorage, (b) the key is not visible in the page source, (c) the key input form uses `type="password"`, (d) the key is cleared from memory on page unload.

2. **Rate limiting on admin endpoints.** Currently there is no rate limiting on admin API endpoints. A brute-force attack on the API key could go undetected. Recommend rate limiting failed auth attempts (e.g., 5 failures per minute per IP hash triggers a 15-minute lockout).

---

*Sherpa -- Response to v0.3.0 Daily Brief*
*Admin user journey mapped, 10 friction points identified, telemetry plan defined, trail observation plan established*
