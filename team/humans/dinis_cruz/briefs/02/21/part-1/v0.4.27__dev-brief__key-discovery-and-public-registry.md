# Developer Brief: Key Discovery UI and Public Registry

**version** v0.4.27  
**date** 21 Feb 2026  
**classification** B3 as B1 / D1  
**from** Human (project lead)  
**to** Developer (lead), Designer, Architect  
**type** Developer brief â€” build spec (follows on from admin PKI key management page)  
**status** â¬… CURRENT PRIORITY â€” This is the immediate next build.  

---

## Context

The admin PKI key management page is built and deployed. Two browsers, key generation, public key export/import, encrypt/decrypt â€” all working in production on the admin panel. This was achieved in ~24 hours from the investor meeting brief.

**This brief covers the next build: how do users discover and exchange public keys without manually copy-pasting PEM blobs?**

---

## What to Build

Two new features, both on the admin panel:

1. **Friendly Key Lookup** â€” find a public key by entering a human-readable name or code
2. **Public Key Registry** â€” a page listing published public keys that others can browse and download

Both are new pages in `/admin/`, following the same pattern as `pki.html`.

---

## Design Principle: No Plaintext on the Server

All data stored on the server is either:

- **Encrypted content** (PKI-encrypted blobs â€” the server cannot read them)
- **Tokens / Object IDs** (8-character hexadecimal values or full GUIDs/UUIDs)

**Folder names, key labels, user names â€” NONE of these are stored as strings on the server.** Everything is an Obj_Id or UUID. This is non-negotiable for two reasons:

1. **Security**: no metadata leakage. The server stores `a3f7c891` not `Deal-Alpha-Acquisition`. Traffic analysis reveals nothing.
2. **Injection prevention**: there are no strings to inject into. No SQL injection, no XSS via metadata, no path traversal. The server processes only tokens and encrypted blobs. The attack surface for injection is zero by design.

Friendly names exist only on the client side (in IndexedDB, mapped to Obj_Ids) or as encrypted metadata within PKI-encrypted blobs.

---

## Feature 1: Friendly Key Lookup

### The Concept

Instead of sharing a PEM blob, a user shares a short identifier. The recipient enters it, the server returns the public key.

```
Alice: "My SG/Send ID is dinis-cruz"
Bob:   goes to lookup page â†’ types "dinis-cruz" â†’ gets Alice's public key â†’ imports it
```

### Server-Side Storage

The "friendly name" maps to a public key via an Obj_Id:

```
Registry entry (server-side):
{
  obj_id: "a3f7c891",              // 8-hex Obj_Id â€” the lookup token
  public_key_pem: "-----BEGIN...", // the public key (this IS public data)
  friendly_token: "dinis-cruz",    // stored as a hash, not plaintext
  created: "2026-02-20T10:00:00Z",
  updated: "2026-02-20T10:00:00Z",
  active: true
}
```

**Wait â€” the friendly name**: even "dinis-cruz" is metadata. Two options:

| Approach | How It Works | Trade-Off |
|---|---|---|
| **Hash the friendly name** | Server stores `sha256("dinis-cruz")`. Client sends the hash to look up. Server matches hash â†’ returns public key. The actual name never touches the server. | Server can't enumerate names. Lookup requires knowing the exact name. |
| **Friendly name IS the Obj_Id** | The user's lookup code is just an Obj_Id like `a3f7c891` or a UUID. No human-readable name on the server at all. Client-side label maps Obj_Id â†’ "dinis-cruz" in IndexedDB. | Less user-friendly but zero metadata. |
| **Hybrid** | Use a short alphanumeric code (e.g., `DC-7X4F`) as the lookup token. Not a meaningful name, but short enough to speak aloud. Server stores only the code. | Good balance â€” no metadata leakage, reasonably user-friendly. |

**Recommendation**: start with the hybrid approach. The lookup code is a short token (6â€“8 alphanumeric characters) that the server stores directly. It's not a name â€” it's an opaque identifier that happens to be short enough to read out loud or write on a business card. Client-side, the user can label it whatever they want in their local contacts.

### The Lookup Page: `/admin/key-lookup.html`

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Admin  â€º  Key Lookup                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Find someone's public key                                      â”‚
â”‚                                                                 â”‚
â”‚  Enter their SG/Send code:                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚  â”‚ DC-7X4F                          â”‚  [ Look Up ]              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  âœ“ Key found                                            â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  Code:        DC-7X4F                                    â”‚   â”‚
â”‚  â”‚  Fingerprint: sha256:3a7f...c891                         â”‚   â”‚
â”‚  â”‚  Algorithm:   RSA-OAEP 4096-bit                          â”‚   â”‚
â”‚  â”‚  Published:   20 Feb 2026, 10:00                         â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  âš  Verify this fingerprint with the key owner            â”‚   â”‚
â”‚  â”‚    through a separate channel before trusting it.        â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  Label this contact: [________________________]          â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  [Import to My Contacts]    [View Full Public Key]       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Workflow

```
1. User enters lookup code
2. Client sends GET /api/keys/{code}
3. Server returns: { obj_id, public_key_pem, fingerprint, created }
4. Client displays the key details
5. User optionally verifies fingerprint out-of-band
6. User enters a local label (stored in IndexedDB only)
7. User clicks "Import to My Contacts"
8. Public key imported into IndexedDB "contacts" store (same as pki.html)
```

### Publishing Your Key

On the existing `pki.html` page, add a **Publish** button to each key pair:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”‘  "My Work Key"                                           â”‚
â”‚     Created: 19 Feb 2026, 14:30                              â”‚
â”‚     Fingerprint: sha256:3a7f...c891                          â”‚
â”‚                                                              â”‚
â”‚     [Copy Public Key]  [Share via SG/Send]  [Delete]         â”‚
â”‚     [Publish to Registry]                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

Clicking "Publish to Registry":

```
1. Client sends POST /api/keys
   Body: { public_key_pem: "..." }
2. Server stores the key, generates a lookup code
3. Server returns: { code: "DC-7X4F", obj_id: "a3f7c891" }
4. Client shows:

   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  âœ“ Key published                            â”‚
   â”‚                                              â”‚
   â”‚  Your SG/Send code: DC-7X4F                  â”‚
   â”‚                                              â”‚
   â”‚  Share this code with anyone who wants       â”‚
   â”‚  to send you encrypted messages.             â”‚
   â”‚                                              â”‚
   â”‚  [Copy Code]  [Show as QR Code]              â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### API Endpoints

| Endpoint | Method | Purpose |
|---|---|---|
| `POST /api/keys` | POST | Publish a public key â†’ returns lookup code |
| `GET /api/keys/{code}` | GET | Retrieve a public key by lookup code |
| `DELETE /api/keys/{code}` | DELETE | Unpublish a key (requires authentication) |
| `GET /api/keys` | GET | List all published keys (for the registry page â€” see Feature 2) |

---

## Feature 2: Public Key Registry Page

### The Concept

A browsable page showing all published public keys for this server instance. For private deployments (like the investor's branded instance), only authorised users can access it. For public instances, it's open.

This is the beginning of a key server â€” analogous to keys.openpgp.org but per-deployment.

### The Registry Page: `/admin/key-registry.html`

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Admin  â€º  Public Key Registry                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Published keys on this server                                  â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Code: DC-7X4F                                          â”‚   â”‚
â”‚  â”‚  Fingerprint: sha256:3a7f...c891                        â”‚   â”‚
â”‚  â”‚  Algorithm: RSA-OAEP 4096-bit                           â”‚   â”‚
â”‚  â”‚  Published: 20 Feb 2026, 10:00                          â”‚   â”‚
â”‚  â”‚  [Import]  [View Key]                                   â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚  Code: AB-3M9K                                          â”‚   â”‚
â”‚  â”‚  Fingerprint: sha256:8b2e...f443                        â”‚   â”‚
â”‚  â”‚  Algorithm: RSA-OAEP 4096-bit                           â”‚   â”‚
â”‚  â”‚  Published: 20 Feb 2026, 11:30                          â”‚   â”‚
â”‚  â”‚  [Import]  [View Key]                                   â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚  Code: FX-2R7P                                          â”‚   â”‚
â”‚  â”‚  Fingerprint: sha256:c44a...b118                        â”‚   â”‚
â”‚  â”‚  Algorithm: ECDH P-256                                  â”‚   â”‚
â”‚  â”‚  Published: 20 Feb 2026, 12:15                          â”‚   â”‚
â”‚  â”‚  [Import]  [View Key]                                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  â“˜ All keys shown are PUBLIC keys. They are safe to download.  â”‚
â”‚    Always verify fingerprints with the key owner.               â”‚
â”‚                                                                 â”‚
â”‚  Certificate Transparency: All key registrations and changes    â”‚
â”‚  are logged in an append-only audit trail. [View Log]           â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Certificate Transparency Log

**All key operations are logged in an append-only log** visible to all users of the platform:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Key Transparency Log                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  2026-02-20 12:15  KEY_PUBLISHED  FX-2R7P  sha256:c44a...b118  â”‚
â”‚  2026-02-20 11:30  KEY_PUBLISHED  AB-3M9K  sha256:8b2e...f443  â”‚
â”‚  2026-02-20 10:00  KEY_PUBLISHED  DC-7X4F  sha256:3a7f...c891  â”‚
â”‚                                                                  â”‚
â”‚  Log integrity: sha256:9f3a...2d71 (hash of all entries)        â”‚
â”‚  Previous hash: sha256:0000...0000 (genesis)                    â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

This is the transparency mechanism that detects if the server starts serving attacker-controlled keys. Any user can audit the log. Changes are visible. Deletions are visible. Additions are visible.

---

## File Structure

```
/admin/
â”œâ”€â”€ index.html              â† existing (add nav links)
â”œâ”€â”€ pki.html                â† existing (add "Publish" button)
â”œâ”€â”€ key-lookup.html         â† NEW
â”œâ”€â”€ key-lookup.js           â† NEW
â”œâ”€â”€ key-registry.html       â† NEW
â”œâ”€â”€ key-registry.js         â† NEW
â””â”€â”€ shared/
    â””â”€â”€ pki-common.js       â† shared utilities (PEM parse, fingerprint, IndexedDB)
```

Extract shared utilities from `pki.js` into `pki-common.js` so all three pages can reuse them.

---

## Acceptance Criteria

| # | Criterion | How to Verify |
|---|---|---|
| 1 | Can publish a public key from pki.html | Click Publish â†’ get a lookup code |
| 2 | Can look up a key by code | Enter code on key-lookup.html â†’ key displayed |
| 3 | Can import a looked-up key to contacts | Click Import â†’ key appears in pki.html contacts |
| 4 | Registry page shows all published keys | Visit key-registry.html â†’ all published keys listed |
| 5 | Can import a key from registry | Click Import on registry â†’ key in contacts |
| 6 | Lookup code is 6â€“8 alphanumeric characters | Verify format on publish |
| 7 | No plaintext names stored on server | Inspect server storage â€” only Obj_Ids, PEM keys, timestamps |
| 8 | Transparency log records all key operations | Publish/unpublish â†’ entry appears in log |
| 9 | Unpublishing a key works | Delete from registry â†’ lookup returns 404, log shows removal |
| 10 | QR code for lookup code works | Click QR â†’ scannable code shown |

---

This document is released under the Creative Commons Attribution 4.0 International licence (CC BY 4.0). You are free to share and adapt this material for any purpose, including commercially, as long as you give appropriate credit.
