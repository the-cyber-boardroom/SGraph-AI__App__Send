# Brief: Secrets Manager â€” Dogfooding SG/Send for Deployment

**version** v0.5.10  
**date** 21 Feb 2026  
**from** Human (project lead)  
**to** Developer (lead), DevOps, Architect  
**type** Technical brief â€” new capability solving an existing pain point  

---

## The Pain Point

Deploying secrets today is painful:

1. To add or change an environment variable, the human must edit **three places** in the source code
2. Then go to GitHub Settings â†’ Secrets â†’ click five or six times per secret
3. Each click takes seconds, high cognitive load, easy to make mistakes
4. Then trigger a deployment and wait for the pipeline to execute
5. Can't easily test the change before deploying
6. Environment variables are passed in cleartext to Lambda functions
7. Scaling this to multiple data rooms (each with their own secrets) is unsustainable

The human previously tried HashiCorp Vault â€” expensive, complex, painful. AWS Secrets Manager â€” adds up cost-wise, and still requires IAM configuration per Lambda function.

## The Insight

We already have an encrypted storage system. We already have key-based access control. We already have an API. **We should use SG/Send as our own secrets manager.**

---

## How It Works

### Storing Secrets

An admin creates a "secrets document" in SG/Send â€” a JSON blob containing all the secrets for a deployment:

```json
{
  "deployment": "data-room-investor-x",
  "secrets": {
    "GITHUB_TOKEN": "ghp_xxxxxxxxxxxx",
    "AWS_ACCESS_KEY_ID": "AKIA...",
    "AWS_SECRET_ACCESS_KEY": "...",
    "SSH_PRIVATE_KEY": "-----BEGIN OPENSSH PRIVATE KEY-----\n...",
    "DATABASE_URL": "postgres://...",
    "API_KEY_STRIPE": "sk_live_..."
  }
}
```

This blob is encrypted using the existing SG/Send encryption model and stored as a normal SG/Send document. It gets a document ID (Obj_Id) and a decryption key.

### Retrieving Secrets

A Lambda function (or EC2 instance, or CI/CD pipeline) needs exactly **two values** to retrieve all its secrets:

```
SGSEND_DOC_ID=a3f7c891
SGSEND_KEY=<decryption_key>
```

On boot, the function:

```
1. Calls GET /api/documents/{SGSEND_DOC_ID}
2. Receives the encrypted blob
3. Decrypts with SGSEND_KEY
4. Parses the JSON
5. Has all its secrets in memory
```

Two environment variables instead of twenty. One API call instead of twenty AWS Secrets Manager calls. No IAM role configuration. No per-secret billing.

### The Admin UI

A new section in the admin panel (or a dedicated page) for managing secrets documents:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Admin  â€º  Secrets Manager                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  [ + Create Secrets Document ]                                 â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ğŸ“¦  "Data Room: Investor X"                            â”‚   â”‚
â”‚  â”‚      Doc ID: a3f7c891                                    â”‚   â”‚
â”‚  â”‚      Keys: 6 secrets stored                              â”‚   â”‚
â”‚  â”‚      Last updated: 21 Feb 2026, 10:00                   â”‚   â”‚
â”‚  â”‚      Used by: Lambda (investor-x-orchestrator)          â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚      [Edit]  [Copy Doc ID + Key]  [Rotate Key]  [Delete]â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚  ğŸ“¦  "Main Deployment"                                  â”‚   â”‚
â”‚  â”‚      Doc ID: b4e2d903                                    â”‚   â”‚
â”‚  â”‚      Keys: 12 secrets stored                             â”‚   â”‚
â”‚  â”‚      Last updated: 20 Feb 2026, 14:30                   â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚      [Edit]  [Copy Doc ID + Key]  [Rotate Key]  [Delete]â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

Editing a secrets document:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Edit Secrets: "Data Room: Investor X"                         â”‚
â”‚                                                                 â”‚
â”‚  Key                          Value                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ GITHUB_TOKEN           â”‚   â”‚ â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ AWS_ACCESS_KEY_ID      â”‚   â”‚ â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ SSH_PRIVATE_KEY         â”‚   â”‚ â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  [ + Add Secret ]                                              â”‚
â”‚                                                                 â”‚
â”‚  [Cancel]                                   [Save & Encrypt]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

All editing happens in the browser. The decrypted secrets are never sent to the server. On save, the browser re-encrypts the entire blob and uploads it.

---

## Lambda Function Identity

This model naturally leads to Lambda function identity:

- Each Lambda function gets its own doc_id + key pair (its "identity")
- Different Lambda functions access different secrets documents
- You can see which functions access which secrets
- Revoking a Lambda's access = change the decryption key on its secrets document

In the future, each Lambda function could get its own PKI key pair. The secrets document would be encrypted to the Lambda's public key. Only that specific Lambda could decrypt it. This is the same trust model as user PKI, applied to infrastructure.

---

## Cost Comparison

| Solution | Cost Model | Estimated Monthly Cost (50 secrets) |
|---|---|---|
| AWS Secrets Manager | $0.40/secret/month + $0.05/10,000 API calls | ~$20/month |
| HashiCorp Vault (self-hosted) | EC2 instance + storage + maintenance time | ~$30-50/month + engineer time |
| **SG/Send Secrets Manager** | 1 encrypted document in S3 per deployment | ~$0.01/month (S3 storage cost for a few KB) |

At scale (50 data rooms Ã— 10 secrets each = 500 secrets), AWS Secrets Manager costs $200/month. SG/Send secrets manager costs pennies.

---

## Implementation

### API

Uses existing SG/Send API endpoints â€” no new routes needed:

| Operation | How | Endpoint |
|---|---|---|
| Store secrets | Create/update an encrypted document | `POST /api/upload` (existing) |
| Retrieve secrets | Download and decrypt | `GET /api/documents/{id}` (existing) |
| List secrets docs | Admin-only listing | New admin route, or use admin panel localStorage index |

### Client Library

A thin wrapper for Lambda functions / CI/CD pipelines:

```python
# sgsend_secrets.py
import os, requests, json
from cryptography.fernet import Fernet  # or our existing decryption logic

def load_secrets():
    doc_id = os.environ["SGSEND_DOC_ID"]
    key = os.environ["SGSEND_KEY"]
    api_url = os.environ.get("SGSEND_API_URL", "https://send.sgraph.ai")
    
    response = requests.get(f"{api_url}/api/documents/{doc_id}")
    encrypted_blob = response.content
    
    decrypted = decrypt(encrypted_blob, key)
    secrets = json.loads(decrypted)
    
    return secrets["secrets"]

# Usage in Lambda handler:
secrets = load_secrets()
github_token = secrets["GITHUB_TOKEN"]
```

### Admin UI

New page: `/admin/secrets.html`

```
/admin/
â”œâ”€â”€ index.html
â”œâ”€â”€ pki.html
â”œâ”€â”€ key-lookup.html
â”œâ”€â”€ key-registry.html
â”œâ”€â”€ fleet.html
â”œâ”€â”€ secrets.html          â† NEW
â””â”€â”€ secrets.js            â† NEW
```

---

## Acceptance Criteria

| # | Criterion |
|---|---|
| 1 | Can create a new secrets document from the admin UI |
| 2 | Can add key-value pairs to a secrets document |
| 3 | Secrets are encrypted in the browser before upload (never sent to server in plaintext) |
| 4 | Can retrieve and decrypt a secrets document given doc_id + key |
| 5 | Can edit an existing secrets document (decrypt, modify, re-encrypt, upload) |
| 6 | Python client library loads secrets from SG/Send in a Lambda function |
| 7 | Lambda function needs only SGSEND_DOC_ID + SGSEND_KEY as environment variables |
| 8 | Can rotate the decryption key for a secrets document |

---

This document is released under the Creative Commons Attribution 4.0 International licence (CC BY 4.0). You are free to share and adapt this material for any purpose, including commercially, as long as you give appropriate credit.
