# Developer Brief: Admin PKI Key Management Page

**version** v0.4.20  
**date** 19 Feb 2026  
**classification** B3 as B1 / D1  
**from** Human (project lead)  
**to** Developer (lead), Designer  
**type** Developer brief â€” build spec with UI mockups and workflows  

---

## What to Build

A **new, standalone page** in the admin section for managing public/private key pairs using the Web Crypto API. This is a separate HTML file (`pki.html`), not part of `index.html`.

**Location**: `/admin/pki.html`  
**Access**: same admin authentication as the existing admin panel  
**Dependencies**: Web Crypto API (native browser), IndexedDB (native browser). No external libraries.

---

## The Web Crypto Foundation

The entire page is built on one critical capability:

```javascript
const keyPair = await crypto.subtle.generateKey(
  {
    name: "RSA-OAEP",
    modulusLength: 4096,
    publicExponent: new Uint8Array([1, 0, 1]),
    hash: "SHA-256"
  },
  false,  // â† THIS IS THE KEY: extractable = false
  ["encrypt", "decrypt"]
);
```

`extractable: false` means the private key:
- Can be used for decryption by the browser
- **Cannot be read, exported, or accessed by any JavaScript** â€” not ours, not extensions, not anything
- Is bound to our origin
- Can be stored in IndexedDB (preserves the non-extractable property)
- Survives page reloads and browser restarts (when stored in IndexedDB)

The public key IS extractable â€” it's public by definition.

---

## Storage: IndexedDB, Not localStorage

Web Crypto `CryptoKey` objects cannot be stored in localStorage (it only stores strings). They CAN be stored in IndexedDB via structured cloning, which preserves the non-extractable flag.

**Database schema:**

```javascript
// IndexedDB database: "sg-send-pki"
// Object store: "keys"

{
  id: "auto-increment",
  label: "My Work Key",              // user-defined name
  created: "2026-02-19T14:30:00Z",   // ISO timestamp
  algorithm: "RSA-OAEP",             // algorithm used
  keySize: 4096,                     // modulus length
  publicKey: CryptoKey,              // extractable
  privateKey: CryptoKey,             // NON-extractable
  publicKeyFingerprint: "sha256:3a7f...c891",  // for display/comparison
  publicKeyPEM: "-----BEGIN PUBLIC KEY-----\n..."  // exported SPKI, base64
}
```

```javascript
// Object store: "contacts" (imported public keys from others)

{
  id: "auto-increment",
  label: "Alice - Investor Group",    // user-defined name
  imported: "2026-02-19T15:00:00Z",
  algorithm: "RSA-OAEP",
  publicKey: CryptoKey,               // extractable (it's their public key)
  publicKeyFingerprint: "sha256:8b2e...f443",
  publicKeyPEM: "-----BEGIN PUBLIC KEY-----\n...",
  source: "manual"                    // or "sg-send-code", "url", etc.
}
```

---

## Page Layout

The page has four sections: **My Keys**, **Contacts** (others' public keys), **Test**, and **Info**.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Admin  â€º  PKI Key Management                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€ MY KEYS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚  [ + Generate New Key Pair ]                              â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚ ğŸ”‘  "My Work Key"                                   â”‚ â”‚  â”‚
â”‚  â”‚  â”‚     Created: 19 Feb 2026, 14:30                      â”‚ â”‚  â”‚
â”‚  â”‚  â”‚     Algorithm: RSA-OAEP 4096-bit                     â”‚ â”‚  â”‚
â”‚  â”‚  â”‚     Fingerprint: sha256:3a7f...c891                  â”‚ â”‚  â”‚
â”‚  â”‚  â”‚     Private key: [non-extractable] âœ“                 â”‚ â”‚  â”‚
â”‚  â”‚  â”‚                                                      â”‚ â”‚  â”‚
â”‚  â”‚  â”‚     [Copy Public Key]  [Share via SG/Send]  [Delete] â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚ ğŸ”‘  "Personal"                                      â”‚ â”‚  â”‚
â”‚  â”‚  â”‚     Created: 18 Feb 2026, 09:15                      â”‚ â”‚  â”‚
â”‚  â”‚  â”‚     Algorithm: RSA-OAEP 4096-bit                     â”‚ â”‚  â”‚
â”‚  â”‚  â”‚     Fingerprint: sha256:9c1d...a227                  â”‚ â”‚  â”‚
â”‚  â”‚  â”‚     Private key: [non-extractable] âœ“                 â”‚ â”‚  â”‚
â”‚  â”‚  â”‚                                                      â”‚ â”‚  â”‚
â”‚  â”‚  â”‚     [Copy Public Key]  [Share via SG/Send]  [Delete] â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€ CONTACTS (Others' Public Keys) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚  [ + Import Public Key ]                                  â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚ ğŸ‘¤  "Alice - Investor Group"                         â”‚ â”‚  â”‚
â”‚  â”‚  â”‚     Imported: 19 Feb 2026, 15:00                     â”‚ â”‚  â”‚
â”‚  â”‚  â”‚     Fingerprint: sha256:8b2e...f443                  â”‚ â”‚  â”‚
â”‚  â”‚  â”‚     Source: manual import                            â”‚ â”‚  â”‚
â”‚  â”‚  â”‚                                                      â”‚ â”‚  â”‚
â”‚  â”‚  â”‚     [Encrypt for Alice]  [View Key]  [Delete]        â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€ TEST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚  Encrypt / Decrypt round-trip test                        â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚  Key pair:  [ My Work Key          â–¾ ]                    â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚  Plaintext:                                               â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚  â”‚ Hello, this is a test message.                     â”‚   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚  [ Encrypt with Public Key ]                              â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚  Ciphertext:                                              â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚  â”‚ eyJhbGciOiJSU0EtT0FFUCIsImVuYyI6IkEyNTZHQ00i... â”‚   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚  [ Decrypt with Private Key ]                             â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚  Result:                                                  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚  â”‚ âœ“ "Hello, this is a test message."                 â”‚   â”‚  â”‚
â”‚  â”‚  â”‚   Round-trip successful. Keys working correctly.   â”‚   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€ INFO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚  Browser: Chrome 122 âœ“ (Web Crypto API supported)         â”‚  â”‚
â”‚  â”‚  IndexedDB: âœ“ (available, 2 key pairs stored)             â”‚  â”‚
â”‚  â”‚  Private key security: âœ“ (non-extractable)                â”‚  â”‚
â”‚  â”‚  Origin: send.sgraph.ai                                   â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚  âš  Keys are stored in this browser only.                  â”‚  â”‚
â”‚  â”‚    Clearing browser data will delete your keys.           â”‚  â”‚
â”‚  â”‚    There is no recovery â€” this is by design.              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Workflows

### Workflow 1: Generate a New Key Pair

```
User clicks [ + Generate New Key Pair ]
    â”‚
    â–¼
Modal appears:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Generate New Key Pair                  â”‚
â”‚                                         â”‚
â”‚  Label:  [________________________]     â”‚
â”‚                                         â”‚
â”‚  Algorithm:  ( â€¢ ) RSA-OAEP 4096-bit    â”‚
â”‚              (   ) RSA-OAEP 2048-bit    â”‚
â”‚              (   ) ECDH P-256           â”‚
â”‚                                         â”‚
â”‚  â“˜ Your private key will be stored      â”‚
â”‚    securely in this browser. It cannot  â”‚
â”‚    be exported or read by any code,     â”‚
â”‚    including ours.                      â”‚
â”‚                                         â”‚
â”‚  [Cancel]              [Generate]       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼ (user clicks Generate)
    â”‚
    â”œâ”€â”€ crypto.subtle.generateKey(algorithm, false, ["encrypt","decrypt"])
    â”œâ”€â”€ crypto.subtle.exportKey("spki", keyPair.publicKey)
    â”œâ”€â”€ Compute SHA-256 fingerprint of exported public key
    â”œâ”€â”€ Convert public key to PEM format (base64-encoded SPKI)
    â”œâ”€â”€ Store in IndexedDB: { label, created, algorithm, publicKey, 
    â”‚                          privateKey, publicKeyFingerprint, publicKeyPEM }
    â”‚
    â–¼
Key pair appears in "My Keys" list
Success toast: "Key pair 'My Work Key' created. Your private key is secure."
```

### Workflow 2: Copy / Share Public Key

```
User clicks [Copy Public Key] on a key pair
    â”‚
    â–¼
Copy the PEM-formatted public key to clipboard
Toast: "Public key copied to clipboard"

--- OR ---

User clicks [Share via SG/Send]
    â”‚
    â–¼
    â”œâ”€â”€ Create a new SG/Send transfer containing the public key PEM
    â”œâ”€â”€ (Use the existing SG/Send upload flow internally)
    â”‚
    â–¼
Modal:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Share Your Public Key                  â”‚
â”‚                                         â”‚
â”‚  Link: https://send.sgraph.ai/d/a7x9f  â”‚
â”‚  [Copy Link]                            â”‚
â”‚                                         â”‚
â”‚  This link contains your PUBLIC key     â”‚
â”‚  only. It is safe to share openly.      â”‚
â”‚  Your private key never leaves your     â”‚
â”‚  browser.                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Workflow 3: Import a Public Key

```
User clicks [ + Import Public Key ]
    â”‚
    â–¼
Modal:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Import Public Key                      â”‚
â”‚                                         â”‚
â”‚  Label:  [________________________]     â”‚
â”‚                                         â”‚
â”‚  Paste PEM-encoded public key:          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ -----BEGIN PUBLIC KEY-----      â”‚    â”‚
â”‚  â”‚ MIIBIjANBgkqhkiG9w0BAQEFAA... â”‚    â”‚
â”‚  â”‚ -----END PUBLIC KEY-----        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                         â”‚
â”‚  â€” or â€”                                 â”‚
â”‚                                         â”‚
â”‚  [ Upload .pem file ]                   â”‚
â”‚                                         â”‚
â”‚  [Cancel]              [Import]         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼ (user clicks Import)
    â”‚
    â”œâ”€â”€ Parse PEM â†’ extract DER bytes
    â”œâ”€â”€ crypto.subtle.importKey("spki", derBytes, algorithm, true, ["encrypt"])
    â”œâ”€â”€ Compute SHA-256 fingerprint
    â”œâ”€â”€ Store in IndexedDB "contacts" store
    â”‚
    â–¼
Contact appears in "Contacts" list
Success toast: "Public key for 'Alice - Investor Group' imported."
```

### Workflow 4: Encrypt for a Contact

```
User clicks [Encrypt for Alice] on a contact
    â”‚
    â–¼
Redirect to the main SG/Send send page
BUT: pre-select "PKI mode" with Alice's public key pre-loaded

(This is a future integration point â€” for the MVP, just show a simple
 encrypt/decrypt test within the PKI page itself. Full send-page 
 integration comes in the next iteration.)

--- MVP VERSION ---

Modal:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Encrypt for: Alice - Investor Group    â”‚
â”‚                                         â”‚
â”‚  Message:                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                                 â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                         â”‚
â”‚  [ Drop file here or click to select ]  â”‚
â”‚                                         â”‚
â”‚  [Cancel]           [Encrypt & Upload]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼ (user clicks Encrypt & Upload)
    â”‚
    â”œâ”€â”€ Encrypt content with Alice's public key (RSA-OAEP)
    â”‚   NOTE: RSA-OAEP has a max plaintext size limit (~446 bytes for 4096-bit)
    â”‚   So: generate a random AES-256-GCM key, encrypt content with AES,
    â”‚        encrypt the AES key with RSA-OAEP (hybrid encryption)
    â”œâ”€â”€ Upload encrypted content to SG/Send server
    â”œâ”€â”€ Get link back
    â”‚
    â–¼
Show link to share with Alice
(Alice decrypts using her private key on her PKI page)
```

### Workflow 5: Delete a Key Pair

```
User clicks [Delete] on a key pair
    â”‚
    â–¼
Confirmation dialog:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âš  Delete "My Work Key"?               â”‚
â”‚                                         â”‚
â”‚  This will permanently delete both      â”‚
â”‚  the public AND private key from this   â”‚
â”‚  browser.                               â”‚
â”‚                                         â”‚
â”‚  âš  This cannot be undone.               â”‚
â”‚  âš  Any content encrypted with this      â”‚
â”‚    key pair will become permanently      â”‚
â”‚    unreadable.                           â”‚
â”‚                                         â”‚
â”‚  Type "delete" to confirm:              â”‚
â”‚  [________________________]             â”‚
â”‚                                         â”‚
â”‚  [Cancel]              [Delete Forever] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼ (user types "delete" and clicks Delete Forever)
    â”‚
    â”œâ”€â”€ Remove key pair from IndexedDB
    â”‚
    â–¼
Key removed from list
Toast: "Key pair 'My Work Key' deleted permanently."
```

### Workflow 6: Auto-Detection on Page Load

```
Page loads
    â”‚
    â”œâ”€â”€ Open IndexedDB "sg-send-pki"
    â”œâ”€â”€ Count key pairs in "keys" store
    â”‚
    â”œâ”€â”€ 0 keys found:
    â”‚   â–¼
    â”‚   Show welcome state:
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   â”‚  No keys yet                               â”‚
    â”‚   â”‚                                            â”‚
    â”‚   â”‚  Generate your first key pair to start     â”‚
    â”‚   â”‚  using PKI encryption.                     â”‚
    â”‚   â”‚                                            â”‚
    â”‚   â”‚  [ Generate My First Key Pair ]            â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â””â”€â”€ 1+ keys found:
        â–¼
        Show full UI with all keys listed
```

---

## Technical Notes for the Developer

### Hybrid Encryption (RSA-OAEP + AES-256-GCM)

RSA-OAEP has a max plaintext size of `(keySize / 8) - 2 * (hashSize / 8) - 2`. For 4096-bit RSA with SHA-256, that's 446 bytes. We can't encrypt files or long messages directly with RSA.

**Solution â€” standard hybrid encryption:**

```javascript
// ENCRYPT
// 1. Generate a random AES key
const aesKey = await crypto.subtle.generateKey(
  { name: "AES-GCM", length: 256 }, true, ["encrypt", "decrypt"]
);

// 2. Encrypt content with AES
const iv = crypto.getRandomValues(new Uint8Array(12));
const encrypted = await crypto.subtle.encrypt(
  { name: "AES-GCM", iv }, aesKey, contentBytes
);

// 3. Export AES key and encrypt it with RSA public key
const rawAesKey = await crypto.subtle.exportKey("raw", aesKey);
const wrappedKey = await crypto.subtle.encrypt(
  { name: "RSA-OAEP" }, recipientPublicKey, rawAesKey
);

// 4. Package: wrappedKey + iv + encrypted content
// Send this to the server

// DECRYPT (recipient side)
// 1. Decrypt AES key using RSA private key
const rawAesKey = await crypto.subtle.decrypt(
  { name: "RSA-OAEP" }, myPrivateKey, wrappedKey
);

// 2. Import AES key
const aesKey = await crypto.subtle.importKey(
  "raw", rawAesKey, "AES-GCM", false, ["decrypt"]
);

// 3. Decrypt content
const decrypted = await crypto.subtle.decrypt(
  { name: "AES-GCM", iv }, aesKey, encryptedContent
);
```

This is the standard pattern used by PGP, S/MIME, and TLS. RSA wraps the symmetric key. AES encrypts the content. Best of both worlds.

### PEM Export/Import

```javascript
// Export public key to PEM
async function exportPublicKeyPEM(publicKey) {
  const exported = await crypto.subtle.exportKey("spki", publicKey);
  const b64 = btoa(String.fromCharCode(...new Uint8Array(exported)));
  const pem = `-----BEGIN PUBLIC KEY-----\n${b64.match(/.{1,64}/g).join('\n')}\n-----END PUBLIC KEY-----`;
  return pem;
}

// Import public key from PEM
async function importPublicKeyPEM(pem) {
  const b64 = pem.replace(/-----[^-]+-----/g, '').replace(/\s/g, '');
  const der = Uint8Array.from(atob(b64), c => c.charCodeAt(0));
  return await crypto.subtle.importKey(
    "spki", der,
    { name: "RSA-OAEP", hash: "SHA-256" },
    true, ["encrypt"]
  );
}
```

### Fingerprint Computation

```javascript
async function computeFingerprint(publicKey) {
  const exported = await crypto.subtle.exportKey("spki", publicKey);
  const hash = await crypto.subtle.digest("SHA-256", exported);
  const hex = [...new Uint8Array(hash)].map(b => b.toString(16).padStart(2, '0')).join('');
  return `sha256:${hex.substring(0, 16)}`;  // truncated for display
}
```

### ECDH as an Alternative to RSA

Consider also supporting ECDH (Elliptic Curve Diffie-Hellman) key pairs:

| Property | RSA-OAEP 4096 | ECDH P-256 |
|---|---|---|
| Key generation speed | Slow (~1â€“3 seconds) | Fast (~10ms) |
| Public key size | 550 bytes | 65 bytes |
| Security level | ~128-bit equivalent | ~128-bit equivalent |
| Browser support | Universal | Universal |
| Key exchange model | Encrypt directly to public key | Derive shared secret, then AES |

For the MVP, implement RSA-OAEP (simpler mental model â€” "encrypt with public key, decrypt with private key"). Add ECDH as an option in the algorithm selector for a future iteration.

---

## File Structure

```
/admin/
â”œâ”€â”€ index.html          â† existing admin page (DO NOT MODIFY)
â”œâ”€â”€ pki.html            â† NEW: this page
â”œâ”€â”€ pki.js              â† NEW: all PKI logic (key gen, storage, import/export, encryption)
â”œâ”€â”€ pki.css             â† NEW: styles for PKI page (or inline if preferred)
â””â”€â”€ shared/             â† any shared admin styles/scripts
```

The admin `index.html` should add a navigation link to `pki.html`:

```html
<a href="pki.html">PKI Key Management</a>
```

That's the only change to `index.html`.

---

## Browser Compatibility

| Feature | Chrome | Firefox | Safari | Edge |
|---|---|---|---|---|
| Web Crypto API | âœ“ 37+ | âœ“ 34+ | âœ“ 11+ | âœ“ 79+ |
| RSA-OAEP generate | âœ“ | âœ“ | âœ“ | âœ“ |
| Non-extractable keys | âœ“ | âœ“ | âœ“ | âœ“ |
| IndexedDB CryptoKey storage | âœ“ | âœ“ | âœ“ | âœ“ |
| ECDH P-256 generate | âœ“ | âœ“ | âœ“ | âœ“ |

All modern browsers support everything we need. No polyfills. No WASM. No external libraries.

---

## What This Page Does NOT Cover

The following are covered in separate documents and should NOT be built as part of this page:

| Topic | Document |
|---|---|
| Encrypted page delivery (bootstrap.js, Service Worker trust anchor) | [v0.4.12__appsec-research__service-worker-trust-anchor.md](v0.4.12__appsec-research__service-worker-trust-anchor.md) |
| PKI integration with the main send/receive flow | Future brief â€” depends on this MVP working first |
| Claude skill / LLM integration | [v0.4.12__business-incident__investor-pki-claude-integration.md](v0.4.12__business-incident__investor-pki-claude-integration.md) |
| FastAPI client certificate authentication | [v0.4.12__brief__pki-strategy-and-investor-deployment.md](v0.4.12__brief__pki-strategy-and-investor-deployment.md) |
| Short code public key sharing | Future brief â€” depends on API endpoint |

Build this page. Get key generation, storage, import/export, and the test encrypt/decrypt working. Everything else builds on top of this.

---

## Acceptance Criteria

| # | Criterion | How to Verify |
|---|---|---|
| 1 | Can generate an RSA-OAEP 4096-bit key pair | Click generate â†’ key pair appears in list |
| 2 | Private key is non-extractable | `keyPair.privateKey.extractable === false` |
| 3 | Keys persist across page reloads | Reload page â†’ keys still listed |
| 4 | Keys persist across browser restarts | Close browser, reopen â†’ keys still listed |
| 5 | Can export public key as PEM | Click copy â†’ PEM string in clipboard |
| 6 | Can import a public key from PEM | Paste PEM â†’ contact appears in list |
| 7 | Can encrypt a test message with a public key | Enter text â†’ click encrypt â†’ ciphertext shown |
| 8 | Can decrypt ciphertext with the corresponding private key | Click decrypt â†’ original text shown |
| 9 | Round-trip works for messages > 446 bytes | Hybrid encryption (RSA wraps AES key) working |
| 10 | Can delete a key pair with confirmation | Click delete â†’ type "delete" â†’ key removed |
| 11 | Empty state shown when no keys exist | Clear IndexedDB â†’ page shows welcome state |
| 12 | Info section shows browser capabilities | Web Crypto: âœ“, IndexedDB: âœ“, key count |
| 13 | Page is at `/admin/pki.html`, not part of `index.html` | Navigate to URL â†’ page loads independently |

---

This document is released under the Creative Commons Attribution 4.0 International licence (CC BY 4.0). You are free to share and adapt this material for any purpose, including commercially, as long as you give appropriate credit.
