# Debrief: IFD Broken Independence — Lessons Learned

**Version:** v0.2.41
**Date:** 2026-02-14
**Trigger:** Dinis identified that v0.1.x minor versions are not truly independent

---

## Executive Summary

The v0.1.1–v0.1.4 frontend versions violate the IFD surgical override pattern. Instead of small 15-line prototype method overrides, each version contains a full 400–500 line copy of the component classes. This means minor versions are **not independently deployable or revertable** — they're complete replacements that share base assets (CSS, crypto, API client) from v0.1.0.

**Decision:** Accept the current state. No retrofitting. Ship to production as-is. Fix it properly at v0.2.0 consolidation.

Three documents capture the analysis and lessons for future work.

---

## What Was Delivered

### 1. Dev Review: Root Cause Analysis

- [Dev Review](../../../roles/dev/reviews/26-02-14/v0.2.41__review__ifd-broken-independence-analysis.md)

Identifies **why** this happened:
- Agents copied full class files instead of using prototype method overrides
- `customElements.define()` can only be called once per tag — the IFD guide didn't account for this Web Components constraint
- The guide was written after the first versions were already created
- No guard rails (lint rules, size checks) to catch the drift

### 2. Librarian: Lessons Learned

- [Lessons Learned](../../../roles/librarian/reviews/26-02-14/v0.2.41__lessons-learned__ifd-minor-version-independence.md)

Five lessons captured:

| # | Lesson | One-liner |
|---|--------|-----------|
| L1 | Guide before implementation | Methodology docs must exist before first code |
| L2 | Web Components `define()` constraint | Only base version registers the custom element |
| L3 | Guard rails catch drift early | Lint for file size + `customElements.define()` in patches |
| L4 | Working ≠ compliant | Process violations need separate checks from tests |
| L5 | Accept when retrofit > forward-fix | Document, move on, fix at next checkpoint |

---

## The Situation in One Diagram

```
v0.1.0 (base — CSS, crypto, API client, access gate, transparency)
  ▲       ▲       ▲       ▲
  │       │       │       │       ← hard runtime dependency
  │       │       │       │
v0.1.1  v0.1.2  v0.1.3  v0.1.4   ← each is a FULL CLASS COPY, not a surgical patch
```

**IFD says** each minor version should be a ~15-line prototype override.
**Reality:** each is a ~450-line full class re-declaration.

---

## What This Means for Production

- **Functionally:** Everything works. All 111 tests pass. Encryption correct. No user impact.
- **For rollback:** Cannot independently revert one minor version without affecting others (but in practice this doesn't matter right now since v0.1.4 is the active version).
- **For v0.1.0:** It's frozen. Modifying its CSS, crypto.js, or api-client.js would silently affect all downstream versions.

---

## What's Next

| Action | When | Who |
|--------|------|-----|
| Ship v0.1.4 to production | Now (Dinis deploying) | Dinis |
| Update IFD guide with Web Components section | Before v0.2.1 | Librarian + Dev |
| v0.2.0 consolidation (merge all v0.1.x into self-contained baseline) | When ready for next feature batch | Dev |
| Add IFD lint rules (file size, `customElements.define()` in patches) | With v0.2.0 | QA + Dev |

---

*Debrief complete. No code changes made. Three documents capture the full analysis and lessons for the team.*
