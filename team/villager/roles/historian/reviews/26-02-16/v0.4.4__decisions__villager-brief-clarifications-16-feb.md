# v0.4.4 — Decision Record: Villager Brief Clarifications (16 Feb 2026)

**Date:** 2026-02-16
**Source:** Human answers to Architect + Librarian questions on 16 Feb Villager daily brief
**Status:** Ratified — these decisions are binding for all Villager agents

---

## Decisions

### D054: Domain — Use `sgraph.ai` (not `sgraph.com`)

**Question:** Brief mentions `dev.send.sgraph.com` but production is at `send.sgraph.ai`. Which domain?
**Decision:** Use `sgraph.ai`. All environments use the `.sgraph.ai` domain:
- `dev.send.sgraph.ai`
- `qa.send.sgraph.ai`
- `send.sgraph.ai` (production)

**Impact:** DevOps subdomain architecture, Route 53 hosted zone, ACM certificates, CloudFront alternate domain names.

---

### D055: SA Pipeline — Keep on Admin Lambda

**Question:** Should the SA REST API live on the existing Admin Lambda or a separate Lambda?
**Decision:** Keep everything on the Admin Lambda for now. The SA pipeline endpoints (`/api/sa/*`) are added to the existing Admin Lambda alongside tokens, cache browser, and metrics routes.

**Rationale:** Avoid infrastructure sprawl until the pipeline proves its shape. Can be extracted later if needed.

---

### D056: Route 53 — Human Has Direct Access

**Question:** Does the human have direct Route 53 access for the target domain?
**Decision:** Yes. The `sgraph.ai` domain is managed by Route 53 in the same AWS account used for deployment. DevOps can act directly.

---

### D057: CloudFront Logs First (Not CloudWatch Metrics)

**Question:** The v0.3.6 proposal prioritised CloudWatch metrics; the 16-Feb brief prioritises CloudFront log processing. Which first?
**Decision:** Start with CloudFront logs — the ones already being written to S3.

**Important:** The **first task** is to create a "detailed briefing pack" so the human can run a separate coding session (a regular Claude session, not Claude Code) to explore the best implementation approach for processing CloudFront data using LETS and the Caching Service. The briefing pack must be self-contained.

**Impact:** Supersedes the v0.3.6 phase sequencing. Log processing moves from Phase 2 to Phase 1.

---

### D058: SA API Prefix — Use `/api/sa/`

**Question:** The brief uses `/api/sa/` but existing architecture uses bare paths (no `/api/` prefix per earlier decision). Which convention?
**Decision:** Use `/api/sa/` for all SA endpoints. This prefix makes sense because:
1. All SA endpoints are thematically related (Server Analytics)
2. Makes future extraction to a separate Lambda easier
3. Does not conflict with existing bare-path endpoints

**Impact:** All new SA routes use the `/api/sa/` prefix. Existing routes remain unchanged.

---

### D059: Architect Co-Designs SA Pipeline (Workstream Pack Focus)

**Question:** Should the Villager Architect actively co-design the SA pipeline or just review?
**Decision:** Yes, the Architect should help. The most important thing is ensuring the workstream pack (briefing pack folder) is self-contained and contains everything the separate LLM session will need. The more guidance provided, the better.

**Scope:** The Architect's primary deliverable is the briefing pack content, not the final implementation. The implementation will be done in a separate session using the pack.

---

### D060: Issues FS S3 Adapter — Deferred

**Question:** General-purpose `Issues_FS__S3` backend or SA-specific?
**Decision:** Deferred. This is for later.

---

### D061: Event-Driven Automation — Deferred

**Question:** Is S3 event-triggered Lambda automation Phase 1 or Phase 2?
**Decision:** Deferred. This is for later. The brief says "once the manual pipeline is proven, automate it."

---

### D062: IP Address Verification — Via Tests

**Question:** How to empirically verify IP addresses are not in CloudFront logs?
**Decision:** Done via tests — unit, integration, and live tests. Tests provide absolute proof that there are no IP addresses in the data. The human will handle this during the implementation session.

---

### D063: Klingon — Dropdown Only

**Question:** Produce Klingon strings or just the dropdown entry?
**Decision:** The current dropdown entry is sufficient. No Klingon strings needed.

---

### D064: Evidence Pack — Explorer Territory

**Question:** Target date for DPO/AppSec/GRC evidence articles?
**Decision:** The Explorer team handles this. Not a Villager concern.

---

## Summary Table

| ID | Topic | Decision | Status |
|----|-------|----------|--------|
| D054 | Domain | `sgraph.ai` | Active |
| D055 | SA Lambda | Keep on Admin Lambda | Active |
| D056 | DNS access | Human has Route 53 access | Active |
| D057 | Pipeline priority | CloudFront logs first; briefing pack is first deliverable | Active |
| D058 | API prefix | `/api/sa/` for all SA endpoints | Active |
| D059 | Architect role | Co-design via briefing pack | Active |
| D060 | Issues FS S3 | Deferred | Deferred |
| D061 | Event automation | Deferred | Deferred |
| D062 | IP verification | Via tests (unit + integration + live) | Active |
| D063 | Klingon | Dropdown only | Active |
| D064 | Evidence pack | Explorer team | Deferred to Explorer |
| D065 | Dev pack location | `library/sgraph-send/dev_packs/{version}__{name}/` | Active |

### D065: Dev Pack Location — `library/sgraph-send/dev_packs/`

**Question:** Where in the repo do briefing packs (dev packs) live? The Architect flagged this as an open question (section 5.4 of brief review) with three options: `packs/`, `team/packs/`, `library/packs/`.

**Decision:** Human moved the first pack from `packs/cloudfront-log-pipeline/` to `library/sgraph-send/dev_packs/v0.4.5__cloudfront-log-pipeline/`.

**Convention:**
```
library/sgraph-send/dev_packs/{version}__{pack-name}/
```

- Version prefix uses the project version at time of pack creation
- Double-underscore separator between version and name (matches existing naming convention)
- Lives under `library/sgraph-send/` — alongside project-specific documentation, not at repo root

**Impact:** All future packs use this path. Update `.claude/villager/CLAUDE.md` and `.claude/CLAUDE.md` repo structure sections.

---

## Previous Decisions Referenced

- **D048–D053** (from v0.3.6 observability proposal, 15 Feb) — remain valid
- **D050** (boto3 lazy import pattern) — confirmed as the mechanism for all SA collectors
