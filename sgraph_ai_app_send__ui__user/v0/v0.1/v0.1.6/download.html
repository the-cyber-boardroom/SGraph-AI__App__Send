<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SG/Send — Download</title>
    <meta name="description" content="Download and decrypt your file. Decryption happens in your browser — we never see your data.">
    <meta name="theme-color" content="#1A1A2E">
    <!-- Fonts: DM Sans (display + body) + JetBrains Mono (code) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700;1,9..40,400&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <!-- CSS: base + design system override -->
    <link rel="stylesheet" href="../v0.1.0/css/common.css">
    <link rel="stylesheet" href="css/sg-design-system.css">
</head>
<body class="theme-aurora">
    <header>
        <h1><span class="brand-prefix">SG</span><span class="brand-slash">/</span><span class="brand-product">Send</span></h1>
        <p data-i18n="app.tagline">Your files, your keys, your privacy</p>
        <div id="locale-selector" style="position: absolute; top: var(--space-4); right: var(--space-4);"></div>
    </header>
    <main>
        <!-- Loading indicator: visible before JS loads, hidden by component -->
        <div id="page-loading" class="card" style="text-align: center; padding: var(--space-8);">
            <div class="loading-slash">/</div>
            <div style="font-size: var(--font-size-sm); color: var(--color-text-secondary); margin-top: var(--space-3);" data-i18n="download.loading">Loading transfer info...</div>
        </div>

        <send-download></send-download>

        <!-- CTA section: hidden until JS determines what to show -->
        <section id="cta-signup" class="card" style="margin-top: var(--space-6); text-align: center; display: none;">
            <h3 style="font-size: var(--text-body); margin-bottom: var(--space-1); font-weight: var(--weight-semibold);" data-i18n="cta.title">Want to send files too?</h3>
            <p style="font-size: var(--font-size-sm); color: var(--color-text-secondary); margin-bottom: var(--space-4);" data-i18n="cta.description">
                Join the early access program for SG/Send.
            </p>
            <form class="launchlist-form" action="https://getlaunchlist.com/s/zSa8gI" method="POST">
                <div style="display: flex; gap: var(--space-2); flex-wrap: wrap; justify-content: center;">
                    <input name="name" type="text" class="input" placeholder="Name" style="flex: 1; min-width: 120px;">
                    <input name="email" type="email" class="input" placeholder="Email" required style="flex: 1; min-width: 180px;">
                    <button type="submit" class="btn btn-primary">Sign Up</button>
                </div>
            </form>
        </section>

        <!-- Send-a-file CTA: shown when user already has a token -->
        <section id="cta-send" class="card" style="margin-top: var(--space-6); text-align: center; display: none;">
            <a href="index.html" class="btn btn-primary" style="text-decoration: none;" data-i18n="download.result.send_another">Send a new File or Text</a>
        </section>

        <p class="disclaimer" data-i18n="app.disclaimer">This is a beta service. Do not upload confidential or illegal content.</p>
    </main>
    <!-- v0.1.4 base scripts -->
    <script src="../v0.1.4/js/i18n.js"></script>
    <script src="../v0.1.0/js/crypto.js"></script>
    <script src="../v0.1.0/js/api-client.js"></script>
    <script src="../v0.1.4/components/send-download/send-download.js"></script>
    <script src="../v0.1.0/components/send-transparency/send-transparency.js"></script>
    <!-- v0.1.5 surgical overrides -->
    <script src="../v0.1.5/js/i18n.js"></script>
    <script src="../v0.1.5/components/send-download/send-download.js"></script>
    <!-- v0.1.6 surgical overrides (design-aware) -->
    <script src="js/i18n.js"></script>
    <script src="components/send-download/send-download.js"></script>
    <script>
        // Hide loading indicator once the download component renders
        const _loading = document.getElementById('page-loading');
        if (_loading) _loading.style.display = 'none';

        // Show appropriate CTA based on whether user has a token
        const _hasToken = typeof ApiClient !== 'undefined' && ApiClient.hasAccessToken();
        const _ctaSignup = document.getElementById('cta-signup');
        const _ctaSend   = document.getElementById('cta-send');
        if (_hasToken && _ctaSend)   { _ctaSend.style.display = ''; }
        else if (_ctaSignup)         { _ctaSignup.style.display = ''; }

        I18n.init().then(() => {
            document.documentElement.lang = I18n.locale;
            document.querySelectorAll('[data-i18n]').forEach(el => {
                el.textContent = I18n.t(el.getAttribute('data-i18n'));
            });
            renderLocaleSelector();
        });

        function renderLocaleSelector() {
            const sel = document.getElementById('locale-selector');
            if (!sel) return;
            sel.innerHTML = I18n.availableLocales.map(l =>
                `<button class="btn btn-sm" data-locale="${l.code}"
                         style="font-size: 0.75rem; padding: 0.25rem 0.5rem; ${l.code === I18n.locale ? 'font-weight: 700; color: var(--accent);' : ''}"
                         onclick="I18n.setLocale('${l.code}')">${l.flag || ''} ${l.name}</button>`
            ).join(' ');
        }

        document.addEventListener('locale-changed', () => {
            document.documentElement.lang = I18n.locale;
            document.querySelectorAll('[data-i18n]').forEach(el => {
                el.textContent = I18n.t(el.getAttribute('data-i18n'));
            });
            renderLocaleSelector();
        });

        // Hide page-level CTA when download component shows its own link
        document.addEventListener('download-complete', () => {
            const ctaSend = document.getElementById('cta-send');
            if (ctaSend) ctaSend.style.display = 'none';
        });
    </script>
</body>
</html>
