# v0.1.2 — Frontend UI Plan (Revised)

**Version:** v0.1.2
**Date:** 2026-02-09
**Author:** Claude (Architect role)
**Type:** Plan Mode document — revised per Conductor review
**Status:** DRAFT

---

## Changes from v0.1.1

- IFD methodology with Web Components (not vanilla JS with framework-like patterns)
- SPA routing (not hash routing)
- Three separate UIs instead of one: user workflow, user tools, admin
- Two Lambda functions means two separate sites (public + admin)
- Themes, i18n, and accessibility from day one
- Gmail URL email sharing support
- Cookies/localStorage inspection UI
- API explorer UI for power users
- Page folders with complete artifacts
- IFD admin panel mode for tools and admin sites
- Static files served as FastAPI routes (not separate S3 bucket initially)

---

## 1. Three UIs

### UI-1: User Workflow (send.sgraph.ai)
**Purpose:** Super simple, focused on the core use case: upload, share, retrieve.
**Characteristics:** Minimal code, fast loading, no chrome, laser-focused on the happy path.
**Served by:** Public Lambda (static route)

Pages:
- `/` — Upload page (token entry, file drop, encrypt, upload)
- `/d/{transfer_id}` — Download page (key entry, download, decrypt)
- `/s/{transfer_id}` — Status page (sender view: link, key, download count)

### UI-2: User Tools (tools.send.sgraph.ai or send.sgraph.ai/tools)
**Purpose:** Power user features, transparency deep-dives, encryption demos, API explorer.
**Characteristics:** Uses IFD admin panel mode (EventBus, Shell, debug panel). More complex UI.
**Served by:** Public Lambda (static route)

Features:
- Encryption/decryption playground (live AES-256-GCM demo)
- Cookie/localStorage inspector (what this site stores about you)
- API explorer (make direct requests to backend endpoints)
- Transfer detail view (all events, requests, metadata)
- How-it-works explainer (interactive, not just text)

### UI-3: Admin (admin.send.sgraph.ai)
**Purpose:** Token management, usage stats, system overview.
**Characteristics:** Uses IFD admin panel mode. Protected by OSBot-Fast-API auth.
**Served by:** Admin Lambda (static route)

Features:
- Token CRUD (create, list, revoke)
- Usage analytics dashboard
- Transfer overview (anonymised)
- System health and status

## 2. IFD Implementation

### Architecture
All three UIs follow IFD methodology:
- Zero external dependencies (ES6 + Web Components + browser APIs)
- EventBus for all component communication
- Self-contained components (one .js file with HTML + CSS + logic)
- Surgical override versioning (v0.1.0 base, v0.1.1+ overrides)

### UI-1 Specifics (User Workflow)
- Does NOT use the full Shell/admin-panel infrastructure
- Minimal: standalone Web Components, no EventBus overhead
- Each page is essentially one component
- Goal: <50KB total page weight, <1s load time

### UI-2 and UI-3 Specifics (Tools + Admin)
- Uses the IFD admin panel mode:
  - `<sgraph-shell>` for layout and navigation
  - EventBus (`window.sgraphApp.events`)
  - Debug panel (Messages, Events Viewer, API Logger, Automation)
  - Service singletons (`window.sgraphApp.transfers`, `.tokens`, `.config`)

## 3. SPA Routing

SPA with client-controlled routes. The server sends index.html for all non-API traffic that hits a particular URL. This enables:
- Deep linking (share /d/{id} URL directly)
- Fast page transitions (no full reload)
- Back/forward navigation

Pattern:
```
Server receives /d/abc123
  → Server doesn't know this path
  → Returns index.html (configured as default for all non-API paths)
  → Client JavaScript reads window.location.pathname
  → Routes to the download page component with transfer_id = abc123
```

## 4. Client-Side Encryption Flow

Same as v0.1.1 (Web Crypto API, AES-256-GCM). No changes to the encryption model.

Key details:
- Key generation: crypto.subtle.generateKey (AES-GCM, 256-bit, extractable)
- Export: raw key → base64url (44 chars)
- Encrypt: 12-byte random IV + AES-GCM → payload = IV (12 bytes) + ciphertext + auth tag
- Decrypt: extract IV, import key from base64url, decrypt, catch DOMException for wrong key

## 5. Themes, i18n, Accessibility from Day One

### Themes
- CSS custom properties (variables) for all colours, fonts, spacing
- Theme switching via data-theme attribute on body
- At least 2 themes for MVP: light (default) and dark
- Theme selection stored in localStorage

### i18n
- All user-facing strings in a translations object
- Language detection from browser (navigator.language)
- Language override in localStorage
- At least 2 languages for MVP: English + Portuguese (per LGPD compliance mention)
- Translation keys used in components, not hardcoded strings

### Accessibility
- Semantic HTML (nav, main, section, button — not div for everything)
- ARIA labels on interactive elements
- Keyboard navigation support
- Focus management on page transitions
- Sufficient colour contrast in all themes

## 6. Gmail URL Email Sharing

Support creating a mailto: link with pre-populated content for sharing the download link.

Gmail compose URL pattern:
```
https://mail.google.com/mail/?view=cm&fs=1&to=&su=Encrypted+file+for+you&body=Download+from+https://send.sgraph.ai/d/abc123
```

Show a "Share via Email" button on the result page that opens this URL. The decryption key is NOT included in the email (user shares it via a separate channel).

## 7. Cookie/localStorage Inspector

A dedicated component that shows the user exactly what data this site stores in their browser:
- List all cookies with name, value, expiry
- List all localStorage entries with key, value
- List all sessionStorage entries
- "Clear all" button per category
- Explanation of what each stored item is for

This aligns with the transparency philosophy.

## 8. API Explorer

A built-in API client for power users and developers:
- Dropdown to select endpoint
- Input fields for parameters
- Auth header input
- Send button
- Response display (status code, headers, body)
- History of recent requests

This lives in the user tools site (UI-2).

## 9. Page Folder Structure

Each page has a dedicated folder with all artifacts:
```
frontend/pages/upload/
├── README.md           # Page purpose, states, user flow
├── mockups/            # Visual mockups
├── data-models.md      # What data this page needs/produces
├── components/         # Web Components for this page
│   ├── upload-page.js  # Main page component
│   ├── file-dropzone.js
│   ├── token-input.js
│   └── upload-progress.js
├── events.md           # Events emitted/consumed by this page
└── tests/              # Test scenarios for this page
```

Think in modules and reusable components. Cross-reference shared components between pages (e.g., transparency-panel is used by both upload-result and download pages).

## 10. Error Handling UX

Same categories as v0.1.1 but with i18n support:
- Wrong key: translated error message, retry option
- Expired transfer: translated message, no recovery
- Invalid token: translated message, re-enter option
- Network error: translated message, retry button
- File too large: client-side check before encryption

All error messages are translation keys, not hardcoded strings.

## 11. Browser Compatibility

Same as v0.1.1: Chrome 90+, Firefox 90+, Safari 15+, Edge 90+. No IE11. Web Crypto API required.
