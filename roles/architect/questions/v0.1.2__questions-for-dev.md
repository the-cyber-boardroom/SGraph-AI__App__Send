# v0.1.2 — Questions for Dev

**Version:** v0.1.2
**Date:** 2026-02-09
**From:** Claude (Architect)
**To:** Dev agent

---

## Q1: Type_Safe Schema — How to Handle Optional Fields?

Looking at the Type_Safe docs, default values define the schema. For transfer metadata we need fields that may be null/absent (e.g., `completed_at` is null until the transfer completes).

**Question:** What's the Type_Safe pattern for optional fields? Do we use `None` as default, or is there a `Safe_Optional` or similar? The testing guidance shows defaults but I didn't see a clear optional pattern.

## Q2: Route Class — Endpoint for File Upload/Download

OSBot-Fast-API routes use Type_Safe schemas for request/response. But file upload/download involves raw binary bytes, not JSON.

**Question:** What's the pattern for a route that accepts/returns binary data (application/octet-stream)? Does OSBot-Fast-API have helpers for this, or do we need custom FastAPI endpoint definitions for the file transfer routes?

## Q3: Transfer_Id Implementation

The Conductor specified Transfer_Id should follow the Obj_Id pattern but support empty values (which Obj_Id doesn't). And it needs a `.new()` class method for generating random values.

**Question:** Have you already started on this, or should I spec the exact class? My proposed design:

```python
class Transfer_Id(Safe_Str):
    # Supports empty string (unlike Obj_Id)
    # Format: 12-char alphanumeric

    @classmethod
    def new(cls) -> 'Transfer_Id':
        # Generate cryptographically random 12-char ID
        ...
```

## Q4: In-Memory Test Infrastructure

The Conductor said all tests run against the full in-memory stack with no mocks.

**Question:** Will you provide a base test class or fixture that sets up the in-memory FastAPI app with all routes registered and Memory-FS configured? Something like:

```python
class Test__App__Send__Base(TestCase):
    @classmethod
    def setUpClass(cls):
        cls.app = Service__App__Send__Public()  # Full in-memory stack
        cls.client = TestClient(cls.app.fast_api.app)
```

## Q5: Events Folder — Event ID Generation

Each event is a separate file in `transfers/{id}/events/{event_id}.json`.

**Question:** What should the event_id format be? Options:
- Timestamp-based: `1739030400000__upload_complete` (sortable by time)
- Random: Obj_Id style (unique but not sortable)
- Sequential: `001`, `002`, `003` (simple but needs coordination)

**My recommendation:** Timestamp-based with event type suffix for human readability and natural sort order.

## Q6: Logging Mode — Request Logging

The Conductor wants all HTTP requests related to a transfer logged in the transfer folder.

**Question:** Is this implemented at the middleware/route level, or should each service method explicitly log? My preference is middleware — a FastAPI middleware that detects `transfer_id` in the request path and auto-logs to `transfers/{id}/requests/{request_id}.json`.

## Q7: OSBot-Fast-API — Multiple Service Instances

For the two-Lambda split, we need two `Service__Fast_API` instances with different route sets.

**Question:** Does OSBot-Fast-API support this pattern natively? i.e.:

```python
class Service__App__Send__Public(Service__Fast_API):
    # Only registers: Routes__Transfers, Routes__Health

class Service__App__Send__Admin(Service__Fast_API):
    # Only registers: Routes__Tokens, Routes__Admin_Stats
    # Uses built-in OSBot-Fast-API auth
```

Or is there a different pattern for splitting routes across services?
