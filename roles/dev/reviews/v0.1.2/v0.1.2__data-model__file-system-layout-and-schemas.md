# v0.1.2 â€” Data Model (File System Layout and Schemas)

**version** v0.1.2  
**date** 9 Feb 2026  
**role** Dev

## 1. Scope

Dedicated storage/data model definition for transfer data and observability records. This file intentionally separates storage details from API planning docs.

## 2. Design principles

1. File system abstraction first (Memory-FS), storage backend agnostic.
2. Keep backend data non-sensitive by default.
3. Keep full action trail for transparency and debugging.
4. Use event-per-file and request-per-file (append-only records).
5. Store encrypted file bytes only (never plaintext payload).

## 3. Proposed transfer folder layout

```text
transfers/
  {transfer_id}/
    transfer.json
    payload/
      payload.enc
      payload.meta.json
    events/
      {event_id}.json
    actions/
      {action_id}.json
    requests/
      {request_id}.json
    observability/
      {observation_id}.json
```

## 4. Proposed config folder layout

```text
config/
  tokens/
    {token_id}.json
  stats/
    overview.json
  settings/
    privacy.json
```

## 5. Schema map (Type_Safe)

### 5.1 transfer.json

- class: `Schema__App__Send__Transfer`
- core fields:
  - `transfer_id : Transfer_Id`
  - `status : Safe_Str__Key` (`pending`, `completed`, `expired`, `deleted`)
  - `created_at : Timestamp_Now`
  - `updated_at : Timestamp_Now`
  - `expires_at : Timestamp_Now`
  - `file_size_bytes : Safe_Int`
  - `token_id : Token_Id`
  - `sender_ip_anon : Safe_Str__Key` (anonymised representation)
  - `download_count : Safe_Int`

### 5.2 payload.meta.json

- class: `Schema__App__Send__Transfer__Payload`
- core fields:
  - `content_type : Safe_Str__Key` (`application/octet-stream`)
  - `byte_count : Safe_Int`
  - `upload_mode : Safe_Str__Key` (`presigned`, `api-bytes`)
  - `checksum_sha256 : Safe_Str__Hash` (optional if available)

### 5.3 events/{event_id}.json

- class: `Schema__App__Send__Event`
- core fields:
  - `event_id : Event_Id`
  - `transfer_id : Transfer_Id`
  - `event_type : Safe_Str__Key`
  - `timestamp : Timestamp_Now`
  - `ip_anon : Safe_Str__Key`
  - `user_agent_hash : Safe_Str__Hash` (optional)
  - `details : dict`

### 5.4 actions/{action_id}.json

- class: `Schema__App__Send__Action`
- core fields:
  - `action_id : Obj_Id`
  - `transfer_id : Transfer_Id`
  - `action_name : Safe_Str__Key`
  - `timestamp : Timestamp_Now`
  - `result : Safe_Str__Key`
  - `error_code : Safe_Str__Key` (optional)

### 5.5 requests/{request_id}.json

- class: `Schema__App__Send__Request`
- core fields:
  - `request_id : Obj_Id`
  - `transfer_id : Transfer_Id` (optional for non-transfer routes)
  - `route : Safe_Str__Key`
  - `http_method : Safe_Str__Key`
  - `timestamp : Timestamp_Now`
  - `duration_ms : Safe_Int`
  - `status_code : Safe_Int`
  - `ip_anon : Safe_Str__Key`

### 5.6 tokens/{token_id}.json

- class: `Schema__App__Send__Token`
- core fields:
  - `token_id : Token_Id`
  - `status : Safe_Str__Key` (`active`, `revoked`, `expired`)
  - `created_at : Timestamp_Now`
  - `expires_at : Timestamp_Now`
  - `revoked_at : Timestamp_Now` (optional)
  - `usage_count : Safe_Int`

## 6. Anonymisation mode

### 6.1 Objective

Allow stats and diagnostics without storing identifiable raw IP values.

### 6.2 Proposed behavior

1. `privacy.json` contains mode and strategy:
   - `ip_mode = anonymized | raw-disabled`
2. `ip_anon` value created via deterministic transform with project salt.
3. UI and logs use anonymised value for all non-admin views.

## 7. Implementation notes

1. Keep one schema per file.
2. Keep all timestamps as int values.
3. Keep ids as Obj_Id-derived types.
4. Use append-only records for events/actions/requests.
5. Keep transfer folder as full source of truth for transfer-level observability.

